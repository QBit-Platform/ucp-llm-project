
# manag_eve_first_v1_8_0_auto_groq_analysis.py
# UCP-LLM Profile Manager - Eve First, Auto Groq Analysis, Full Data
# Copyright (c) 2025 Sameh Yassin
# All rights reserved.
# Version: 1.8.0

import tkinter as tk
from tkinter import filedialog, messagebox, ttk, simpledialog, scrolledtext
import json
from typing import Optional, Dict, Any, List
import datetime
import random
import threading
import queue

try:
    from zoneinfo import ZoneInfo # Python 3.9+
    UTC = datetime.UTC if hasattr(datetime, 'UTC') else ZoneInfo("UTC")
except ImportError:
    class UTCtz(datetime.tzinfo):
        def utcoffset(self, dt): return datetime.timedelta(0)
        def dst(self, dt): return datetime.timedelta(0)
        def tzname(self, dt): return "UTC"
    UTC = UTCtz()

try:
    from ucp_llm import UCPProfile
except ImportError:
    print("CRITICAL IMPORT ERROR: 'ucp_llm.py' not found. Program will exit.")
    _err_root = tk.Tk(); _err_root.withdraw(); messagebox.showerror("Import Error", "ucp_llm.py not found."); _err_root.destroy(); exit()

try:
    from groq import Groq, APIError, RateLimitError
except ImportError:
    print("CRITICAL IMPORT ERROR: 'groq' library not found. Please install it: pip install groq")
    _err_root = tk.Tk(); _err_root.withdraw(); messagebox.showerror("Import Error", "'groq' library not found. Please install it: pip install groq"); _err_root.destroy(); exit()

APP_VERSION = "UCP-LLM Profile Manager v1.8.0 (Eve-First, Auto Groq Analysis)"

# ==============================================================================
# FULL DATA STRUCTURES - SECTION_TYPE_DATA and EVE_INVENTED_QUESTIONS
# ==============================================================================
SECTION_TYPE_DATA = {
    "personal": { "title": '๐ค ุจูุงูุงุช ุดุฎุตูุฉ', "maxItems": 1, "fields": [ {"label": 'ุงูุงุณู ุงูููุถู ููุชูุงุนู', "type": 'text', "name": 'preferredName', "jsonKey": 'preferredName'}, {"label": 'ุชุงุฑูุฎ ุงููููุงุฏ (ุงุฎุชูุงุฑู)', "type": 'text', "name": 'dob', "jsonKey": 'dateOfBirth'}, {"label": 'ุงูุฌูุณูุฉ ุฃู ุงูุฎูููุฉ ุงูุซูุงููุฉ (ุงุฎุชูุงุฑู)', "type": 'text', "name": 'nationality', "jsonKey": 'nationalityCulturalBackground'}, {"label": 'ุงููุบุงุช ููุณุชููุงุช ุงูุฅุชูุงู', "type": 'textarea', "name": 'languages', "jsonKey": 'languagesProficiency', "templates": ["ุงูุนุฑุจูุฉ (ูุบุฉ ุฃู)ุ ุงูุฅูุฌููุฒูุฉ (ุจุทูุงูุฉ)", "ุงูุฅูุฌููุฒูุฉ (ุงุญุชุฑุงููุฉ)ุ ุงูุฅุณุจุงููุฉ (ูุจุชุฏุฆ)", "ูุซุงู: ุงูุฃููุงููุฉ (ูุญุงุฏุซุฉ)ุ ุงููุฑูุณูุฉ (ูุฑุงุกุฉ ุฃุณุงุณูุฉ)"]}, ] },
    "social": { "title": '๐ ุงูุญุงูุฉ ุงูุงุฌุชูุงุนูุฉ ูุงูุฃุณุฑูุฉ', "maxItems": 1, "fields": [ {"label": 'ุงูุชูุงุตูู', "type": 'textarea', "name": 'social_details', "jsonKey": 'socialFamilyDetails', "templates": ["ุฃุนุฒุจุ ุฃุนูุด ูุณุชููุงู.", "ูุชุฒูุฌ ููุฏู ุทููุงูุ ุฃุฑูุฒ ุนูู ุงูุฃุณุฑุฉ.", "ุฃุนูุด ูุน ูุงูุฏููุ ุฃุณุงูู ูู ุดุคูู ุงูููุฒู.", "ูู ุนูุงูุฉ ุทูููุฉ ุงูุฃูุฏ ูููุชุฒูุฉ.", "ูุทููุ ุฃุดุงุฑู ูู ุชุฑุจูุฉ ุงูุฃุจูุงุก."]} ] },
    "educational_professional": { "title": '๐ ุงูุฎูููุฉ ุงูุชุนููููุฉ ูุงูููููุฉ', "maxItems": 1, "fields": [ {"label": 'ุงูุฎูููุฉ ุงูุชุนููููุฉ', "type": 'textarea', "name": 'education_background', "jsonKey": 'educationalBackground', "templates": ["ุจูุงููุฑููุณ ูู ุนููู ุงูุญุงุณุจุ ุฌุงูุนุฉ ุงููุงูุฑุฉุ 2000.", "ูุงุฌุณุชูุฑ ูู ุงูููุณูุฉุ ุชุฎุตุต ุฃุฎูุงูุ ุฌุงูุนุฉ ุณุชุงูููุฑุฏุ 2010.", "ุฏูุชูุฑุงู ูู ููุฒูุงุก ุงูููุ ุชุฑูุฒ ุนูู ูุธุฑูุฉ ุงูุฃูุชุงุฑุ ูุนูุฏ ูุงุณุงุชุดูุณุชุณ ููุชูููููุฌูุงุ 2015.", "ูุจุฑูุฌ ุนูู ููุณู ุฐุงุชููุง ูุน ุดูุงุฏุงุช ูุชุนุฏุฏุฉ ุนุจุฑ ุงูุฅูุชุฑูุช."]}, {"label": 'ุงูุฎุจุฑุงุช ุงูููููุฉ ุงูุฑุฆูุณูุฉ', "type": 'textarea', "name": 'professional_experience', "jsonKey": 'professionalExperience', "templates": ["ูููุฏุณ ุจุฑูุฌูุงุช ูู ุดุฑูุฉ ุญููู ุชูููุฉ (5 ุณููุงุช): ููุช ุจููุงุฏุฉ ุชุทููุฑ ููุฒุงุช ุงูููุชุฌ ุงูุฑุฆูุณูุฉ.", "ูุตูู ุฌุฑุงููู ูุณุชูู (3 ุณููุงุช): ุชุฎุตุตุช ูู ุงูุนูุงูุงุช ุงูุชุฌุงุฑูุฉ ููุงุฌูุฉ ุงููุณุชุฎุฏู/ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู ููุดุฑูุงุช ุงููุงุดุฆุฉ.", "ูุคุณุณ ูุฑุฆูุณ ุชูููุฐู ูุดุฑูุฉ ุฅูุฏูู ุจูุงู ุงููุญุฏูุฏุฉ (ุณูุชุงู): ุฑูุฒุช ุนูู ุชุทููุฑ ุงูุฃูุนุงุจ ุงูุชุนููููุฉ.", "ูุญูู ูุงูู ุฃูู ูู ุจูู ุนุงููู (7 ุณููุงุช): ุฃุฏุฑุช ูุญุงูุธ ุงุณุชุซูุงุฑูุฉ ูุชูููู ุงููุฎุงุทุฑ."]} ] },
    "thinking_reference": { "title": '๐ง ูุฑุฌุนูุฉ ุงูุชูููุฑ ุงูุฃุณุงุณูุฉ', "maxItems": 1, "fields": [ {"label": 'ูุตู ูุฑุฌุนูุฉ ุงูุชูููุฑ ุงูุฃุณุงุณูุฉ', "type": 'textarea', "name": 'thinking_reference_desc', "jsonKey": 'coreThinkingReferenceDescription', "templates": ["ุงูุนููุงููุฉ ุงูุตุงุฑูุฉ ูุงูููุทู", "ุงูุฃููุงุทูููุฉ ุงูููุณุนุฉ ูุน ุงูุชุฑููุฒ ุนูู 'ุงูุฎูุฑุง'", "ุงูุชุฌุฑูุจูุฉ ูุญู ุงููุดููุงุช ุงูุนููู", "ุงูุธุงูุฑุงุชูุฉ ุงููุฌูุฏูุฉ ุงูุชู ุชุฑูุฒ ุนูู ุงูุชุฌุฑุจุฉ ุงููุนุงุดุฉ", "ุชููููุฉ ูู ุงูุฃุฎูุงู ุงูุฑูุงููุฉ ูุงููููุฌูุฉ ุงูุนูููุฉ"]}, {"label": 'ุงูุชุทุจูู ูุงูุฃูููุฉ', "type": 'textarea', "name": 'thinking_reference_application', "jsonKey": 'thinkingReferenceApplication', "templates": ["ุชูุทุจู ุนูู ุฌููุน ุนูููุงุช ุงุชุฎุงุฐ ุงููุฑุงุฑ ูุงูุชุณุงุจ ุงููุนุฑูุฉ.", "ุชูุฌู ุจุดูู ุฃุณุงุณู ุจุญุซู ุงูููุณูู ููุธุฑุชู ููุนุงูู.", "ุถุฑูุฑูุฉ ูุนููู ุงููููู ููุณุงุนูู ุงูุฅุจุฏุงุนูุฉ.", "ุชุดูู ุฃุณุงุณ ุฅุทุงุฑู ุงูุฃุฎูุงูู ููููู ุงูุดุฎุตูุฉ."]} ] },
    "cognitive_passion": { "title": '๐ก ุงูุดุบู ุงููุนุฑูู ูุฃููุงุท ุงูุจุญุซ', "fields": [ {"label": 'ุงุณู ุงูุดุบู ุงููุนุฑูู', "type": 'text', "name": 'passion_name', "jsonKey": 'cognitivePassionName', "templates": ["ุนูู ุงูุฃุนุฏุงุฏ", "ุชุงุฑูุฎ ุงูููุณูุฉ", "ููุฒูุงุก ุงููู", "ุงูุญุถุงุฑุงุช ุงููุฏููุฉ", "ุฃุฎูุงููุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู", "ุงูุฑูุงุถูุงุช ุงููุธุฑูุฉ"]}, {"label": 'ูููุฌูุฉ ุงูุจุญุซ', "type": 'textarea', "name": 'passion_methodology', "jsonKey": 'passionResearchMethodology', "templates": ["ูุฑุงุกุฉ ููุซูุฉุ ูุฑุงุฌุน ูุชูุงุทุนุฉุ ูุชูููู.", "ุชุตููู ุชุฌุฑูุจูุ ุฌูุน ุจูุงูุงุชุ ูุชุญููู ุฅุญุตุงุฆู.", "ุงุณุชูุตุงุก ููุณููุ ุชูููุฑ ููุฏูุ ูุญูุงุฑ ุณูุฑุงุทู.", "ููุฐุฌุฉ ุฑูุงุถูุฉ ููุญุงูุงุฉ."]} ] },
    "ethical_values": { "title": 'โ๏ธ ุงูููู ุงูุฃุฎูุงููุฉ ุงูููุฌูุฉ', "fields": [ {"label": 'ุงุณู ุงููููุฉ ุงูุฃุฎูุงููุฉ', "type": 'text', "name": 'value_name', "jsonKey": 'ethicalValueName', "templates": ["ุงูุตุฏู", "ุงูุนุฏู", "ุงููุฒุงูุฉ", "ุงูุฑุญูุฉ", "ุงูุดุฌุงุนุฉ", "ุงูุงุญุชุฑุงู", "ุงููุณุคูููุฉ", "ุงูุฅูุซุงุฑ", "ุงูุชูุงุถุน", "ุงูุญููุฉ", "ุงูููุงุก", "ุงูุชุนุงูู", "ุงูุชุณุงูุญ", "ุงูุงูุชูุงู", "ุงูุตุจุฑ", "ุงูุญูููุฉ", "ุงูุฅูุตุงู"] }, {"label": 'ุงูุดุฑุญ ูุงูุฃููููุฉ', "type": 'textarea', "name": 'value_description', "jsonKey": 'ethicalValueExplanation', "templates": ["ูุฐู ุงููููุฉ ุฃุณุงุณูุฉ ูุชูุฌู ุฌููุน ุฃูุนุงูู.", "ุชุชุฌูู ูู [ุณููู ูุซุงู]ุ ูููุฉ ุฌุฏุงู ุจุงููุณุจุฉ ูู.", "ุชุญุชู ูุฑุชุจุฉ ุจูู ุฃูู 3 ููู ูุฏูุ ูุชุคุซุฑ ุนูู [ูุฌุงู ูุนูู].", "ุฃููููุชูุง ุนุงููุฉุ ุฎุงุตุฉ ูู ุงูุณูุงูุงุช ุงูููููุฉ/ุงูุดุฎุตูุฉ."]} ] },
    "concepts_perspective": { "title": '๐๏ธ ุงูููุธูุฑ ุชุฌุงู ููุงููู ุฌููุฑูุฉ', "fields": [ {"label": 'ุงุณู ุงูููููู ุงูุฌููุฑู', "type": 'text', "name": 'core_concept_name', "jsonKey": 'coreConceptName', "templates": ["ุงูุฌูุงู", "ุงููุจุญ", "ุงูููุถู", "ุงููุธุงู", "ุงูุญูููุฉ", "ุงูุบููุถ", "ุงูุญุฑูุฉ", "ุงูุถุฑูุฑุฉ", "ุงููุนู"]}, {"label": 'ููุธูุฑู ุงูุฎุงุต', "type": 'textarea', "name": 'core_concept_perspective', "jsonKey": 'coreConceptPerspective', "templates": ["ุฃุฑู ูุฐุง ุงูููููู ูู [ุชุนุฑูู ููุฌุฒ]ุ ูุชุฃุซุฑูุง ุจู [ูููุณูู/ูุฏุฑุณุฉ ููุฑูุฉ].", "ูููู ูู ุฃูู ููุซู [ููุฑุฉ ุฃุณุงุณูุฉ] ููุชุฌูู ูู [ุฃูุซูุฉ].", "ุฃูุณุฑ ูุฐุง ูู ุฎูุงู ุนุฏุณุฉ [ูุฑุฌุนูุชู ุงูููุฑูุฉ]ุ ููุนูู [ุดุฑุญ]."]} ] },
    "cognitive_tools_methodology": { "title": '๐๏ธ ูููุฌูุฉ ุงุณุชุฎุฏุงู ุงูุฃุฏูุงุช ุงููุนุฑููุฉ', "fields": [ {"label": 'ุงุณู ุงูุฃุฏุงุฉ ุงููุนุฑููุฉ', "type": 'text', "name": 'cognitive_tool_name', "jsonKey": 'cognitiveToolName', "templates": ["ุงูุดู", "ุงูุญุฏุณ", "ุงูููุทู (ุงูุงุณุชูุจุงุทู/ุงูุงุณุชูุฑุงุฆู)", "ุงูููุงุณ", "ุงูุชุฃูู", "ุฑุณู ุงูุฎุฑุงุฆุท ุงูุฐูููุฉ", "ุงูุชุญููู ุงูููุฏู"]}, {"label": 'ุงูุฑุคูุฉุ ุงูุจูุงุกุ ุฏุฑุฌุฉ ุงูุงุนุชูุงุฏ', "type": 'textarea', "name": 'cognitive_tool_usage', "jsonKey": 'cognitiveToolMethodology', "templates": ["ุฃุฑุงูุง ุถุฑูุฑูุฉ ูู [ุงูุบุฑุถ]ุ ุจูุงุกุฉ ุนูุฏูุง [ุงูุดุฑูุท]. ุฃุนุชูุฏ ุนูููุง ุจุดุฏุฉ.", "ุชูุณุชุฎุฏู ุจุญุฐุฑุ ุจูุงุกุฉ ูุชูููุฏ ุงููุฑุถูุงุชุ ุงุนุชูุงุฏ ูุชูุณุท.", "ุฃุณุงุณ ุชูููุฑูุ ุฏุงุฆููุง ุจูุงุกุฉุ ุงุนุชูุงุฏ ูุทูู."]} ] },
    "inspiring_figures": { "title": '๐ ููุงุฐุฌ/ุดุฎุตูุงุช ุฅูุณุงููุฉ ููููุฉ', "fields": [ {"label": 'ุงุณู ุงูุดุฎุตูุฉ ุงูููููุฉ', "type": 'text', "name": 'figure_name', "jsonKey": 'inspiringFigureName'}, {"label": 'ุงููููุฉ ุงููุณุชูุฏุฉ ูุงูุชุฃุซูุฑ', "type": 'textarea', "name": 'figure_value_impact', "jsonKey": 'derivedValueAndImpact', "templates": ["[ุตูุชููุ ูุซู ุงููุฒุงูุฉุ ุงูุดุฌุงุนุฉ] ุฃุซุฑุช ุจุนูู ูู [ุฌุงูุจ ูู ุญูุงุชู/ุชูููุฑู].", "ุฃุณุชูุฏ ูููุฉ [ูุซู ุงููุซุงุจุฑุฉุ ุงูุตุฏู ุงูููุฑู] ูู ุญูุงุชูู/ุฃุนูุงููู.", "ููุซููู ูููุฐุฌูุง ูู [ูุซู ุงูุณููู ุงูุฃุฎูุงููุ ุงูุณุนู ุงูุฅุจุฏุงุนู]."]} ] },
    "intellectual_sins": { "title": '๐ง ุฎุทุงูุง/ุชุญูุฒุงุช ููุฑูุฉ ูุฌุจ ุชุฌูุจูุง', "fields": [ {"label": 'ุงุณู ุงูุฎุทูุฆุฉ ุงูููุฑูุฉ ุฃู ุงูุชุญูุฒ', "type": 'text', "name": 'intellectual_sin_name', "jsonKey": 'intellectualSinName', "templates": ["ุงูุฏูุบูุงุชูุฉ", "ุงูุชุนููู ุงููุชุณุฑุน", "ุชุญูุฒ ุงูุชุฃููุฏ", "ูุบุงูุทุฉ ุงูุดุฎุตูุฉ", "ูุบุงูุทุฉ ุฑุฌู ุงููุด", "ุงูุงุญุชูุงู ุฅูู ุงูุฌูู"]}, {"label": 'ุงูุณุจุจ ูุงุนุชุจุงุฑู ุถุงุฑูุง', "type": 'textarea', "name": 'intellectual_sin_reason', "jsonKey": 'reasonConsideredHarmful', "templates": ["ูุนูู ุงูุจุญุซ ุนู ุงูุญูููุฉ.", "ูุคุฏู ุฅูู ุงุณุชูุชุงุฌุงุช ุฎุงุทุฆุฉ ููุฑุงุฑุงุช ุณูุฆุฉ.", "ูุนูู ุงูุงููุชุงุญ ุงูุฐููู ูุงูุชูููุฑ ุงูููุฏู.", "ูููุถ ุงูุญูุงุฑ ุงููุซูุฑ."]} ] },
    "projects": { "title": '๐ ูุดุงุฑูุน ูุฃูุฏุงู ุญุงููุฉ', "fields": [ {"label": 'ุนููุงู ุงููุดุฑูุน/ุงููุฏู', "type": 'text', "name": 'project_name', "jsonKey": 'projectOrObjectiveTitle'}, {"label": 'ุงูุฃูุฏุงู/ุงููุตู ุงูุชูุตููู', "type": 'textarea', "name": 'project_goals', "jsonKey": 'projectDetailedGoals', "templates": [ "ุงููุฏู ุงูุฑุฆูุณู ูู [ุณ]ุ ุจูุฏู ุงููุตูู ุฅูู [ุต] ุจุญููู [ุน].", "ูุณุนู ูุฐุง ุงููุดุฑูุน ุฅูู [ูุนู] [ููุถูุน] ูู ุฃุฌู [ุบุฑุถ].", "ุงูุงุณุชุนุฏุงุฏ ูุนุงู/ุฏูุฑุฉ ุฏุฑุงุณูุฉ ุฌุฏูุฏุฉ.", "ุชุทููุฑ ุงูููุงุฑุงุช ุงูููููุฉ ูู [ูุฌุงู ูุญุฏุฏ].", "ุฅุทูุงู ูุดุฑูุน ุดุฎุตู/ุชุฌุงุฑู ุฌุฏูุฏ ูู [ูุทุงู].", "ุงูุชุญุถูุฑ ูุฑุญูุฉ ูููุฉ (ุณูุงุญุฉ/ุนูู/ุฏุฑุงุณุฉ).", "ุชุฃููู ูุชุงุจ ุฃู ูุฑูุฉ ุจุญุซูุฉ ุนู [ููุถูุน].", "ุชุญุณูู ุงูุตุญุฉ ูุงูููุงูุฉ ุงูุจุฏููุฉ ูู ุฎูุงู [ุฎุทุฉ/ูุดุงุท].", "ุชุนูู ูุบุฉ ุฌุฏูุฏุฉ ุฃู ุฅุชูุงู ูุบุฉ ุญุงููุฉ.", "ุชุฎุตูุต ุงููุฒูุฏ ูู ุงูููุช ูููุงูุงุช ูุซู [ุงุณู ุงูููุงูุฉ].", "ุงูุนูู ุนูู ุชุญุณูู ุงูุนูุงูุงุช ุงูุงุฌุชูุงุนูุฉ ุฃู ุงูุฃุณุฑูุฉ.", "ุงููุณุงููุฉ ูู ุนูู ุชุทูุนู ุฃู ุฎุฏูุฉ ูุฌุชูุนูุฉ.", "ุชุญููู ูุฏู ูุนูู ููุงุณุชูุฑุงุฑ ุงููุงูู ุฃู ุงูุงุณุชุซูุงุฑ." ] }, {"label": 'ุงูููุงููู/ุงูุฃุฏูุงุช ุงููุฑุชุจุทุฉ', "type": 'textarea', "name": 'project_concepts_tools', "jsonKey": 'projectAssociatedConcepts'}, {"label": 'ุงูุฏูุฑ ุงููุญุฏุฏ ูููููุฐุฌ ุงููุบูู', "type": 'textarea', "name": 'project_llm_role', "jsonKey": 'projectLLMRole', "templates": ["ูุณุงุนุฏ ุจุญุซ", "ุดุฑูู ูู ุงูุนุตู ุงูุฐููู", "ูุฑุงุฌุน ููุฏู", "ูููุฏ ูุญุชูู", "ูุณุชุดุงุฑ ุชููู", "ูุตุญุญ ุฃุฎุทุงุก (ููููุฏ)", "ูุฏูู ูุบูู/ูุญุฑุฑ"]} ] },
    "pivotal_examples": { "title": '๐งช ุฃูุซูุฉ ูุญูุฑูุฉ', "fields": [ {"label": 'ุงุณู/ูุตู ุงููุซุงู', "type": 'text', "name": 'example_name', "jsonKey": 'pivotalExampleName', "templates": ["ูุตุฉ ููุณู", "ุญุฏุณูุฉ ูููุงุชุฒ", "ุชุฃุซูุฑ ุงููุฑุงุดุฉ", "ุฃุณุทูุฑุฉ ุงูููู", "ูุทุฉ ุดุฑูุฏูุฌุฑ", "ูุนุถูุฉ ุงูุณุฌูู"]}, {"label": 'ุงูุฃูููุฉ ูุงูุฃููุงุฑ ุงูููุถุญุฉ', "type": 'textarea', "name": 'example_significance', "jsonKey": 'pivotalExampleSignificance', "templates": ["ููุถุญ ููููู [ููููู] ูุชุฏุงุนูุงุชู ุนูู [ูุฌุงู].", "ููุซู ุจุงููุณุจุฉ ูู ุฃูููุฉ [ูููุฉ/ููุฑุฉ].", "ูุณูุท ุงูุถูุก ุนูู ุงูุชูุชุฑ ุจูู [ุณ] ู [ุต]."]} ] },
    "causal_relations": { "title": '๐ ุนูุงูุงุช ุณุจุจูุฉ ุจูู ุงูููุงููู', "fields": [ {"label": 'ุงูููููู ุงูุฃูู (ุงูุณุจุจ)', "type": 'text', "name": 'cause_concept', "jsonKey": 'causeConcept'}, {"label": 'ุงูููููู ุงูุซุงูู (ุงููุชูุฌุฉ)', "type": 'text', "name": 'effect_concept', "jsonKey": 'effectConcept'}, {"label": 'ุทุจูุนุฉ ุงูุนูุงูุฉ ุงูุณุจุจูุฉ', "type": 'textarea', "name": 'relation_description', "jsonKey": 'causalRelationDescription', "templates": ["[ุงูุณุจุจ] ูุคุฏู ูุจุงุดุฑุฉ ุฅูู/ูุคุซุฑ ุนูู [ุงููุชูุฌุฉ] ูุฃู...", "[ุงูุณุจุจ] ุดุฑุท ุถุฑูุฑู ููููู ุบูุฑ ูุงู ูู [ุงููุชูุฌุฉ].", "ููุงู ุนูุงูุฉ ุณุจุจูุฉ ูุนูุฏุฉ ูุบูุฑ ูุจุงุดุฑุฉ ุจูู [ุงูุณุจุจ] ู [ุงููุชูุฌุฉ] ุชุชูุณุทูุง..."]} ] },
    "role": { "title": '๐ญ ุงูุดุฎุตูุฉ ุงููุธูููุฉ ูููููุฐุฌ ุงููุบูู', "maxItems": 1, "fields": [ {"label": 'ุงูุฏูุฑ ุงูุฃุณุงุณู ุงููุทููุจ ูู ุงููููุฐุฌ', "type": 'text', "name": 'llm_role_primary', "jsonKey": 'llmPrimaryRole', "templates": ["ูุณุงุนุฏ ุจุญุซ ูุชูุฏู", "ูุงูุฏ ุจูุงุก", "ูุชุนุงูู ุฅุจุฏุงุนู", "ูุญุงูุฑ ุณูุฑุงุทู", "ูุฏุฑุณ ุดุฎุตู", "ูุณุชุดุงุฑ ุชููู"]}, {"label": 'ุงูุณูุงุช ุฃู ุงูุณููููุงุช ุงููุทููุจุฉ ููุฏูุฑ', "type": 'textarea', "name": 'llm_role_attributes', "jsonKey": 'llmRoleAttributes', "templates": ["ุงุณุชุจุงููุ ุซุงูุจุ ูููุชู ุจุงูุชูุงุตูู.", "ููุถูุนูุ ุชุญููููุ ููุญุชุฑู ูู ุงูููุฏ.", "ูููุชุญ ุงูุฐููุ ุฎูุงููุ ููุชุนุงูู ูู ุชูููุฏ ุงูุฃููุงุฑ.", "ูุญูุฒ ููุชูููุฑุ ูุถูููุ ููุฑูุฒ ุนูู ุงูููู ุงูุนููู."]} ] },
    "conceptual_tuning": { "title": '๐ ุชูููู ููุงูููู (ูุตุทูุญุงุช ุฎุงุตุฉ ุจุงููุณุชุฎุฏู)', "fields": [ {"label": 'ูุตุทูุญู ุงูุฎุงุต', "type": 'text', "name": 'user_concept_term', "jsonKey": 'userSpecificTerm'}, {"label": 'ุงูุชุนุฑูู ูุฃูุซูุฉ ุงูุงุณุชุฎุฏุงู', "type": 'textarea', "name": 'user_concept_definition', "jsonKey": 'userTermDefinition', "templates": ["ุจุงููุณุจุฉ ููุ '[ูุตุทูุญ]' ูุนูู [ุชุนุฑููู]. ุฃุณุชุฎุฏูู ุนูุฏ ููุงูุดุฉ [ุณูุงู]ุ ูุซุงู: '[ูุซุงู ุงุณุชุฎุฏุงู]'.", "'[ูุตุทูุญ]' ูู ุงุฎุชุตุงุฑ ูู [ููููู/ููุฑุฉ ุฃุทูู]. ูุซุงู ุนูู ุฐูู: ..."]} ] },
    "interaction_style": { "title": '๐ฌ ุฃุณููุจ ุงูุชูุงุนู ุงูููุถู', "maxItems": 1, "fields": [ {"label": 'ุฃุณููุจ ุงูุงุณุชุฌุงุจุฉ ุงูููุถู ูููููุฐุฌ', "type": 'textarea', "name": 'preferred_style', "jsonKey": 'preferredResponseStyle', "templates": ["ุชุญูููู ูุนูููุ ูุน ุงูุชุจุงุณุงุช ูุฃูุซูุฉ.", "ููุฌุฒ ููุจุงุดุฑุ ูุฑูุฒ ุนูู ุงูููุงุท ุงูุฑุฆูุณูุฉ.", "ุฅุจุฏุงุนู ูููููุ ููุชุฑุญ ุฃููุงุฑูุง ุฌุฏูุฏุฉ.", "ูุชูุงุฒูุ ููุฏู ุงูุชูุงุตูู ุนูุฏ ุงูุญุงุฌุฉ ูุงูุฅูุฌุงุฒ ุนูุฏ ุงูุงูุชุถุงุก.", "ุชุนููููุ ูุดุฑุญ ุงูููุงููู ุงููุนูุฏุฉ ุจูุถูุญ.", "ูุงูุฏ ุจูุงุกุ ูุทุฑุญ ุฃุณุฆูุฉ ููุชุญุฏู ุงูุงูุชุฑุงุถุงุช ุจูุทู."]}, {"label": 'ุงูุฃุณุงููุจ ุงูุชู ูุฌุจ ุนูู ุงููููุฐุฌ ุชุฌูุจูุง', "type": 'textarea', "name": 'avoid_style', "jsonKey": 'stylesToAvoid', "templates": ["ุงูุชุจุณูุท ุงูููุฑุท ููููุงุถูุน ุงููุนูุฏุฉ.", "ุงูุงุณุชุฌุงุจุงุช ุงูุนุงุทููุฉ ุบูุฑ ุงููุจุฑุฑุฉ ุฃู ุงูุดุฎุตูุฉ.", "ุงูุชุนูููุงุช ุบูุฑ ุงูุฏูููุฉ ุฃู ุงูุงุฏุนุงุกุงุช ุบูุฑ ุงููุฏุนููุฉ.", "ุชูุฏูู ุงูุขุฑุงุก ุงูุดุฎุตูุฉ ูุญูุงุฆู ูุทููุฉ.", "ุงูุงุณุชุฎุฏุงู ุงูููุฑุท ูููุตุทูุญุงุช ุงูุชูููุฉ ุฏูู ุชูุณูุฑ.", "ุชูุฑุงุฑ ุงููุนูููุงุช ุงูุชู ูุฏูุชูุง ุจุงููุนู ุฏูู ุฅุถุงูุฉ ูููุฉ."]} ] },
    "intervention_level": {  "title": 'โ๏ธ ูุณุชูู ุชุฏุฎู ุงููููุฐุฌ', "maxItems": 1, "fields": [ {"label": 'ูุณุชูู ุงูุชุฏุฎู ุงููุฎุชุงุฑ', "type": 'select', "name": 'intervention_select', "jsonKey": 'chosenInterventionLevel', "options": [ {"value": '', "text": '-- ุงุฎุชุฑ ุงููุณุชูู --'}, {"value": 'high', "text": 'ุนุงูู (ุงุณุชุจุงูู)'}, {"value": 'medium', "text": 'ูุชูุณุท (ูุชูุงุฒู)'}, {"value": 'low', "text": 'ููุฎูุถ (ููุชุธุฑ ุงูุชูุฌูู)'} ] }, {"label": 'ุชูุถูุญุงุช ุญูู ุงููุจุงุฏุฑุฉ', "type": 'textarea', "name": 'intervention_details', "jsonKey": 'interventionClarifications', "templates": ["ูุง ุชุชุฑุฏุฏ ูู ุงูุชุฑุงุญ ููุงุถูุน ุฐุงุช ุตูุฉ ุฃู ุทุฑุญ ุฃุณุฆูุฉ ุชูุถูุญูุฉ.", "ุฃูุถู ุฃู ุชูุชุธุฑ ุชูุฌููุงุชู ุงูุตุฑูุญุฉ ูุจู ุชูุฏูู ูุตูุญุฉ ุบูุฑ ูุทููุจุฉ.", "ุงูุชูุงุฒู ุฌูุฏุ ุชุฏุฎู ุฅุฐุง ุฑุฃูุช ูุฑุตุฉ ูุงุถุญุฉ ูุชุนุฒูุฒ ููุงูุดุชูุง."]} ] },
    "alignment_level": {  "title": '๐งญ ูุณุชูู ุงูุชูุงูู ุงูููุดูุฏ', "maxItems": 1, "fields": [  {"label": 'ูุณุชูู ุงูุชูุงูู ุงูููุดูุฏ (1-5)', "type": 'select', "name": 'alignment_select', "jsonKey": 'desiredAlignmentLevel', "options": [ {"value": '', "text": '-- ุงุฎุชุฑ --'}, {"value": '5', "text": '5 (ุนุงูู ุฌุฏุงู - ูุญุงูุงุฉ)'}, {"value": '4', "text": '4 (ุนุงูู - ูุชุณู)'}, {"value": '3', "text": '3 (ูุชูุณุท - ูุงุนู)'}, {"value": '2', "text": '2 (ููุฎูุถ - ูููู)'}, {"value": '1', "text": '1 (ุฃุณุงุณู - ูุชุจุน)'} ] }, {"label": 'ููุงุญุธุงุช ุนูู ูุณุชูู ุงูุชูุงูู', "type": 'textarea', "name": 'alignment_notes', "jsonKey": 'alignmentLevelNotes', "templates": ["ุงููุณุชูู 5 ูุนูู ุงูุณุนู ููุญุงูุงุฉ ุนูููุฉ ูุฃููุงุท ุชูููุฑู.", "ุงูุชูุงูู ุงูุนุงูู ูุนูู ุชุทุจูู ูููู ููููุฌูุงุชู ุงููุนููุฉ ุจุงุณุชูุฑุงุฑ.", "ุงููุณุชูู ุงููุชูุณุท ูุนูู ุฅุฏุฑุงู ุณูุงูู ูุชูููู ุงูุงุณุชุฌุงุจุงุช ููููุง ูุฐูู."]} ] },
    "critique_mechanism": { "title": '๐ฃ๏ธ ุขููุฉ ุทูุจ/ุงุณุชูุจุงู ุงูููุฏ', "maxItems": 1, "fields": [ {"label": 'ุชูุถููุงุช ุงูููุฏ (ูุชู/ููู)', "type": 'textarea', "name": 'critique_preference', "jsonKey": 'critiquePreferences', "templates": ["ุฃุฑุญุจ ุจุงูููุฏ ุงูุจูุงุก ูู ุฃู ููุชุ ุฎุงุตุฉ ุฅุฐุง ุณุงุนุฏ ูู ุตูู ุฃููุงุฑู.", "ุฃูุถู ุฃู ูููุฏู ุงูููุฏ ุจูุทู ูุจุชุนููู ูุงุถุญ.", "ุงุณุฃููู ุฃููุงู ุฅุฐุง ููุช ูููุชุญูุง ุนูู ุงูููุฏ ูู ููุถูุน ูุนูู."]}, {"label": 'ุดุฑูุท ุงูููุฏ', "type": 'textarea', "name": 'critique_conditions', "jsonKey": 'critiqueConditions', "templates": ["ูุฌุจ ุฃู ูููู ุงูููุฏ ูุญุชุฑููุงุ ูุงุฆููุง ุนูู ุงูุฃุฏูุฉุ ูููุฏู ุฅูู ุงูููู ุงููุชุจุงุฏู.", "ุชุฌูุจ ุงูุญุฌุฌ ุงูุดุฎุตูุฉุ ุฑูุฒ ุนูู ุงูุฃููุงุฑ.", "ูุฌุจ ุฃู ูุชูุงุดู ูุน ุงููุจุงุฏุฆ ุงูุฃุณุงุณูุฉ ููุฐุง ุงูุจุฑูุชูููู."]} ] },
    "constraints_warnings": { "title": '๐ซ ูุญุธูุฑุงุช ูุชุญุฐูุฑุงุช ูููููุฐุฌ', "fields": [ {"label": 'ุจูุฏ ุงูุญุธุฑ/ุงูุชุญุฐูุฑ', "type": 'text', "name": 'constraint_item', "jsonKey": 'constraintItem', "templates": ["ูุง ุชูุฏู ูุตุงุฆุญ ุทุจูุฉ.", "ุชุฌูุจ ุงูุชุนูููุงุช ุงูุณูุงุณูุฉ.", "ูุง ุชููุฏ ูุญุชูู ุถุงุฑูุง.", "ูุง ุชุฎูู ูู ุฃููุฑ ุดุฎุตูุฉ ูู ูุชู ุงููุดู ุนููุง."]}, {"label": 'ุงูุชูุถูุญ/ุงูุณุจุจ', "type": 'textarea', "name": 'constraint_reason', "jsonKey": 'constraintReason', "templates": ["ูุฐุง ุฎุงุฑุฌ ูุทุงู ุฎุจุฑุชู.", "ููุญูุงุธ ุนูู ุชูุงุนู ูุฑูุฒ ูููุถูุนู.", "ูุฃุณุจุงุจ ุชุชุนูู ุจุงูุณูุงูุฉ ูุงูุฃุฎูุงู."]} ] },
    "memory_management_directives": {  "title": '๐พ ุชูุฌููุงุช ุฅุฏุงุฑุฉ ุงูุฐุงูุฑุฉ', "maxItems": 1, "fields": [ {"label": 'ุชูุฌูู ุงูุญูุงุธ ุนูู ุงูุณูุงู', "type": 'textarea', "name": 'memory_directive', "jsonKey": 'contextMaintenanceDirective', "templates": ["ุฑูุฒ ุนูู ุขุฎุฑ 5-10 ุฑุณุงุฆู ููุณูุงู ุงูููุฑู.", "ุนูุฏ ุงูุญุงุฌุฉุ ุฑุงุฌุน ุงูุฃูุณุงู ุฐุงุช ุงูุตูุฉ ูู ูุฐุง ุงูุจุฑูุชูููู ูุชุญุฏูุซ ุงูููู.", "ุงุทูุจ ููู ุชูุฎูุต ุงูููุงุท ุงูุฑุฆูุณูุฉ ุฅุฐุง ุจุฏุง ุฃู ุงูุณูุงู ููุฌุฑู.", "ุงุณุชุฎุฏู ุงููููุงุช ุงูููุชุงุญูุฉ ูู ูุฐุง ุงูุจุฑูุชูููู ููุฑุงุณู ูุชูุงุนูุงุชูุง.", "ุชุฐูุฑ ุฃู ูุฐุง ุงูุจุฑูุชูููู ูู ุงููุตุฏุฑ ุงูุฃุณุงุณู ูููุนูููุงุช ุนูู."]}, {"label": 'ุขููุฉ ุงุณุชุฏุนุงุก ุงูุจุฑูุชูููู', "type": 'textarea', "name": 'memory_protocol_recall', "jsonKey": 'protocolRecallMechanism', "templates": ["ููููู ุฃู ุชุณุฃููู: 'ูู ููุงู ุฃู ุดูุก ูู ุจุฑูุชููููู ูุชุนูู ุจู [ููุถูุน ูุญุฏุฏ]ุ'", "ุฃุดุฑ ุฅูู ุงููุณู ุฃู ุงูููููู ุงููุญุฏุฏ ุงูุฐู ุชุนุชูุฏ ุฃูู ุฐู ุตูุฉ ุงูุขู.", "ุฅุฐุง ุฐูุฑุช ุดูุฆูุง ูุจุฏู ุฃูู ูุชุนุงุฑุถ ูุน ุงูุจุฑูุชููููุ ููุฑุฌู ุงูุฅุดุงุฑุฉ ุฅููู.", "ูุฎุต ูู ุงูููุงุท ุงูุฑุฆูุณูุฉ ูู ูุณู [ุงุณู ุงููุณู] ุฅุฐุง ูุฒู ุงูุฃูุฑ."]} ] },
    "cognitive_preferences": {  "title": '๐ค ุชูุถููุงุช ูุนุฑููุฉ/ุณููููุฉ', "maxItems": 1,  "fields": [ {"label": 'ุตู ุชูุถูููุง ูุนุฑูููุง ุฃู ุณูููููุง ููููุง', "type": 'textarea', "name": 'preference_description', "jsonKey": 'cognitiveBehavioralPreference', "templates": ["ุฃูุถู ููู ุงูุตูุฑุฉ ุงููุจูุฑุฉ ูุจู ุงูุบูุต ูู ุงูุชูุงุตูู.", "ุฃููู ููุชุฑููุฒ ุนูู ุงูุชูุงุตูู ุงูููููุณุฉ ูุงูุจูุงูุงุช ุฃููุงู.", "ุฃุชุนูู ุจุดูู ุฃูุถู ูู ุฎูุงู ุงูุฎุจุฑุฉ ุงูุนูููุฉ ูุญู ุงููุดููุงุช.", "ุฃูุถู ุงูุจูุฆุงุช ุฌูุฏุฉ ุงูุชูุธูู ูุงููุฎุทุท ููุง.", "ุฃุฌุฏ ุงูุฅููุงู ูู ุงูููุงูุดุงุช ุงูููุชูุญุฉ ูุงูุชุจุงุฏู ุงูุญุฑ ููุฃููุงุฑ.", "ุฃุญุชุงุฌ ุฅูู ููุช ููุชูููุฑ ูุงูุชุฃูู ุจููุฑุฏู ููุนุงูุฌุฉ ุงููุนูููุงุช."]} ] },
    "mental_state": {  "title": '๐ง ุงูุญุงูุฉ ุงูุฐูููุฉ (ุงุฎุชูุงุฑู ููุงุจู ููุชุญุฏูุซ)', "maxItems": 1, "fields": [ {"label": 'ุงูุญุงูุฉ ุงูุฐูููุฉ ุงููุฎุชุงุฑุฉ', "type": 'select', "name": 'mental_state_select', "jsonKey": 'selectedMentalState', "options": [ {"value": '', "text": '-- ุงุฎุชุฑ --'}, {"value": 'good', "text": 'ุฌูุฏุฉ / ูุฑูุฒ'}, {"value": 'average', "text": 'ูุชูุณุทุฉ / ูุดุชุช'}, {"value": 'bad', "text": 'ุณูุฆุฉ / ุบูุฑ ูุฑูุฒ'}, {"value": 'not_specified', "text": 'ุบูุฑ ูุญุฏุฏุฉ'} ] }, {"label": 'ููุงุญุธุงุช ุนูู ุงูุญุงูุฉ ุงูุฐูููุฉ', "type": 'textarea', "name": 'mental_state_notes', "jsonKey": 'mentalStateNotes', "templates": ["ุฃุดุนุฑ ุจุงููุดุงุท ุงูุฐููู ูุฌุงูุฒ ููููุงู ุงููุนูุฏุฉ.", "ูุชุนุจ ููููุงูุ ุฃูุถู ุงูุชูุงุนูุงุช ุงูุฃุจุณุท ูู ุงูููุช ุงูุญุงูู.", "ูููุชุญ ุนูู ุงูููุงูุดุงุช ุงูุนูููุฉุ ุฃุดุนุฑ ุจุงูุชุฃูู."]} ] },
    "sports_inclinations": { "title": '๐ ูููู ุฑูุงุถูุฉ', "maxItems": 1, "fields": [ {"label": 'ุงูููู ุงูุฑูุงุถู ุงููุฎุชุงุฑ', "type": 'select', "name": 'sport_select', "jsonKey": 'chosenSportInclination', "options": [ {"value": '', "text": '-- ุงุฎุชุฑ --'}, {"value": 'none', "text": 'ูุง ููุฌุฏ'}, {"value": 'equestrian', "text": 'ูุฑูุณูุฉ'}, {"value": 'football', "text": 'ูุฑุฉ ูุฏู'}, {"value": 'basketball', "text": 'ูุฑุฉ ุณูุฉ'}, {"value": 'tennis', "text": 'ุชูุณ'}, {"value": 'esports_pc', "text": 'ุฃูุนุงุจ ููุจููุชุฑ (ุชูุงูุณูุฉ)'}, {"value": 'mobile_games', "text": 'ุฃูุนุงุจ ูุญูููุฉ'}, {"value": 'console_games', "text": 'ุฃูุนุงุจ ูููุณูู'}, {"value": 'other', "text": 'ุฃุฎุฑู'} ] }, {"label": 'ุชูุงุตูู ุฃุฎุฑู (ุฅุฐุง "ุฃุฎุฑู")', "type": 'text', "name": 'sport_other_details', "jsonKey": 'sportOtherDetails'} ] },
    "additional_notes": { "title": '๐ ููุงุญุธุงุช ุฅุถุงููุฉ ุนุงูุฉ (ูุฃุณุฆูุฉ ุฅููู)', "maxItems": 1, "fields": [ {"label": 'ููุงุญุธุงุช ุนุงูุฉ / ุฃุณุฆูุฉ ุฅููู ุงูุฅุจุฏุงุนูุฉ', "type": 'textarea', "name": 'general_notes', "jsonKey": 'additionalGeneralNotes'} ] }
}
EVE_INVENTED_QUESTIONS = [
    {"id": "sun_moon", "question": "ุตุฏููู ุงููุจุฏุนุ ูุงุฐุง ุชุญุจ ุฃูุซุฑ: ุฏูุก ุงูุดูุณ โ๏ธ ุงูุฐู ูููุฃ ุงูุญูุงุฉุ ุฃู ุณููู ุงูููุฑ ๐ ุงููููู ููุฃุญูุงูุ", "type": "mc", "options": ["ุงูุดูุณ ุงูุฏุงูุฆุฉ โ๏ธ", "ุงูููุฑ ุงูุณุงุญุฑ ๐", "ููู ููููุง ุณุญุฑู ุงูุฎุงุต โจ"]},
    {"id": "season", "question": "ููู ูุตู ุณุญุฑู ุงูุฎุงุต! ุฃู ุงููุตูู ุฃูุฑุจ ุฅูู ููุจู: ูุบุงูุฑุงุช ุงูุตูู ๐๏ธุ ุญูุงูุงุช ุงูุดุชุงุก ุงูุฏุงูุฆุฉ โุ ุฃููุงู ุงูุฑุจูุน ุงูุฒุงููุฉ ๐ธุ ุฃู ุชุฃููุงุช ุงูุฎุฑูู ุงููุงุฏุฆุฉ ๐ุ", "type": "mc", "options": ["ุงูุตูู ุงููููุก ุจุงููุฑุญ ๐๏ธ", "ุงูุดุชุงุก ุงูุฏุงูุฆ ูุงูุฌููู โ", "ุงูุฑุจูุน ุงูุญููู ๐ธ", "ุฃููุงู ุงูุฎุฑูู ุงูุณุงุญุฑุฉ ๐"]},
    {"id": "reading_writing", "question": "ุนูุฏูุง ูุชุนูู ุงูุฃูุฑ ุจุงููููุงุชุ ูู ุชุฌุฏ ููุณู ุฃูุซุฑ ููููุง ููุฑุงุกุฉ ูุตุต ูุชุจูุง ุขุฎุฑูู ๐ุ ุฃู ููุชุงุจุฉ ูุตุตู ูุฃููุงุฑู ุงูุฎุงุตุฉ โ๏ธุ", "type": "mc", "options": ["ุฃุนุดู ุงููุฑุงุกุฉ ูุงุณุชูุดุงู ุนูุงูู ุฌุฏูุฏุฉ ๐!", "ุฃุญุจ ุงูุชุนุจูุฑ ุนู ููุณู ูู ุฎูุงู ุงููุชุงุจุฉ โ๏ธ!", "ุฃุณุชูุชุน ุจูููููุง ุนูู ูุฏู ุงููุณุงูุงุฉ!"]},
    {"id": "art_music", "question": "ุงููู ููุงูุณ ุงูุฑูุญ ุจุทุฑู ูุฎุชููุฉ. ูู ุชุฌุฐุจู ุฃูุซุฑ ุฌูุงู ุงููููู ุงูุจุตุฑูุฉ ๐จุ ุฃู ุณุญุฑ ุงูุฃูุญุงู ูุงูููุณููู ๐ถุ", "type": "mc", "options": ["ุงููููู ุงูุจุตุฑูุฉ ูุฃููุงููุง ๐จ", "ุงูููุณููู ูุฃูุญุงููุง ุงูุนุฐุจุฉ ๐ถ", "ููุงููุง ูููููู ุจุดูู ูุฑูุฏ ๐"]},
    {"id": "future_vision", "question": "ุฅุฐุง ูุธุฑุช ุฅูู ุงููุณุชูุจูุ ููู ุชุชุฎูู ููุณู ุจุนุฏ ุฎูุณ ุณููุงุชุ ููุง ุงูุฏูุฑ ุงูุฐู ูุฏ ููุนุจู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูู ุชูู ุงูุฑุญูุฉุ ๐", "type": "textarea"},
    {"id": "biggest_challenge", "question": "ูุง ูู ุฃูุจุฑ ุชุญุฏ ููุฑู ุฃู ุฅุจุฏุงุนู ุชุณุนู ุญุงูููุง ููุชุบูุจ ุนูููุ ๐ช", "type": "textarea"},
    {"id": "ideal_day", "question": "ุฅุฐุง ูุงู ุจุฅููุงูู ุชุตููู ููู ูุซุงููุ ููู ุณูุจุฏู ุฑูุชููู ููุง ุงูุฃูุดุทุฉ ุงูุชู ุณุชููุฃูุ ๐", "type": "textarea"},
    {"id": "learning_style_preference", "question": "ุนูุฏ ุชุนูู ุดูุก ุฌุฏูุฏุ ูู ุชูุถู ุงูุบูุต ูู ุงูุชูุงุตูู ูุจุงุดุฑุฉ ๐ฌุ ุฃู ููู ุงูุตูุฑุฉ ุงููุจูุฑุฉ ุฃููุงู ๐บ๏ธุ", "type": "mc", "options": ["ุงูุชูุงุตูู ุฃููุงู ๐ฌ", "ุงูุตูุฑุฉ ุงููุจูุฑุฉ ๐บ๏ธ", "ูุฒูุฌ ูู ุงูุงุซููู ๐งฉ"]},
    {"id": "tech_philosophy", "question": "ูุง ูู ููุณูุชู ุชุฌุงู ุงูุชูููููุฌูุง ุงูุญุฏูุซุฉุ ูู ุชุฑุงูุง ูุฌุฑุฏ ุฃุฏุงุฉุ ุฃู ูุดุฑูู ูุญุชูู ูู ุงูุฅุจุฏุงุน ูุงูููุฑุ ๐ค๐ก", "type": "textarea"},
    {"id": "unexpected_joy", "question": "ูุง ูู ุงูุดูุก ุงูุจุณูุท ูุบูุฑ ุงููุชููุน ุงูุฐู ูููู ุฃู ูุฌูุจ ุงููุฑุญ ูููููุ ๐", "type": "text"},
    {"id": "complex_problem_approach", "question": "ุนูุฏ ููุงุฌูุฉ ูุดููุฉ ูุนูุฏุฉุ ูุง ูู ุฎุทูุชู ุงูุฃููู ุงููุนุชุงุฏุฉุ", "type": "mc", "options": ["ุชูุณูููุง ุฅูู ุฃุฌุฒุงุก ุฃุตุบุฑ", "ุงูุจุญุซ ุนู ุญููู ููุฌูุฏุฉ", "ุงูุนุตู ุงูุฐููู ูุฃููุงุฑ ูุซูุฑุฉ ุจุณุฑุนุฉ", "ุงูุชุฑุงุฌุน ูุชุฑููุง ูุชุฎุชูุฑ"]},
    {"id": "risk_taking_style", "question": "ูู ุชุตู ููุณู ุจุฃูู ูุฌุงุฒู ุฃู ุญุฐุฑ ุจุทุจูุนุชู ุนูุฏ ุงุชุฎุงุฐ ูุฑุงุฑุงุช ูููุฉุ", "type": "mc", "options": ["ูุฌุงุฒู ูุญุณูุจ", "ุญุฐุฑ ุจุดูู ุนุงู", "ูุนุชูุฏ ุจุดุฏุฉ ุนูู ุงููููู", "ุฃููู ูุชุฌูุจ ุงููุฎุงุทุฑ"]},
    {"id": "intuition_vs_logic", "question": "ุนูุฏูุง ูุดูุฑ ุญุฏุณู ูุชุญูููู ุงูููุทูู ุฅูู ุงุณุชูุชุงุฌุงุช ูุฎุชููุฉุ ุฃู ููููุง ุชุซู ุจู ุนุงุฏุฉ ุฃูุซุฑุ", "type": "mc", "options": ["ุญุฏุณู ุนุงุฏุฉ", "ุชุญูููู ุงูููุทูู ูู ุงูุบุงูุจ", "ุฃุญุงูู ุฅูุฌุงุฏ ุญู ูุณุท", "ูุฑุงุฑ ุตุนุจุ ูุนุชูุฏ ุนูู ุงูุณูุงู"]},
    {"id": "failure_perspective", "question": "ููู ุชูุธุฑ ุจุดูู ุนุงู ุฅูู ุงููุดู ุฃู ุงูููุณุงุชุ", "type": "textarea", "placeholder": "ูุซุงู: ูุฑุตุฉ ููุชุนููุ ุนูุงูุฉ ูุชุบููุฑ ุงูุงุชุฌุงูุ ูุตุฏุฑ ููุฅุญุจุงุท..."},
    {"id": "tf_procrastination_habit", "question": "ุฃุฌุฏ ููุณู ุฃุญูุงููุง ุฃุคุฌู ุงูููุงู ุงููุงูุฉ.", "type": "tf"},
    {"id": "preferred_communication", "question": "ูุง ูู ุฃุณููุจ ุงูุชูุงุตู ุงูููุถู ูุฏูู ููููุงูุดุงุช ุงููุงูุฉุ", "type": "mc", "options": ["ูุฌููุง ููุฌู", "ููุงููุฉ ููุฏูู", "ููุงููุฉ ูุงุชููุฉ", "ูุชุงุจููุง (ุจุฑูุฏ ุฅููุชุฑููู/ุฑุณุงุฆู)"]},
    {"id": "conflict_handling", "question": "ููู ุชุชุนุงูู ุนุงุฏุฉ ูุน ุงูุฎูุงูุงุช ุฃู ุงููุฒุงุนุงุช ูุน ุงูุขุฎุฑููุ", "type": "textarea", "placeholder": "ูุซุงู: ููุงุฌูุฉ ูุจุงุดุฑุฉุ ุงูุจุญุซ ุนู ูุณุงุทุฉุ ุชุฌูุจูุง ุฅู ุฃูููุ ูุญุงููุฉ ููู ูุฌูุงุช ุงููุธุฑ ุงูุฃุฎุฑู..."},
    {"id": "group_role", "question": "ูู ูุฌููุนุฉุ ูู ุชุฌุฏ ููุณู ุบุงูุจูุง ุชุฃุฎุฐ ุฏูุฑูุง ููุงุฏููุงุ ุฃู ุฏูุฑูุง ุฏุงุนููุงุ ุฃู ุฏูุฑ ูุฑุงูุจุ", "type": "mc", "options": ["ุนุงุฏุฉ ูุง ุฃููู ูุงุฆุฏูุง/ููุธููุง", "ุบุงูุจูุง ูุง ุฃููู ูุงุนุจ ูุฑูู ุฏุงุนู", "ุฃูุซุฑ ููุฑุงูุจ/ูุญูู", "ูุฎุชูู ุฏูุฑู ุจุดูู ูุจูุฑ"]},
    {"id": "tf_public_speaking", "question": "ุฃุดุนุฑ ุจุงูุฑุงุญุฉ ูู ุงูุชุญุฏุซ ุฃูุงู ูุฌููุนุงุช ูุจูุฑุฉ.", "type": "tf"},
    {"id": "core_motivator", "question": "ูุง ูู ุฃุญุฏ ุฃููู ุงูุฏูุงูุน ุฃู ุงููุญูุฒุงุช ูู ุญูุงุชู ุงูุขูุ", "type": "text"},
    {"id": "legacy_thought", "question": "ุฅุฐุง ููุช ุณุชุชุฑู ุฅุฑุซูุงุ ูุจูุงุฐุง ุชุฑูุฏ ุฃู ููุนุฑูุ", "type": "textarea"},
    {"id": "tf_helping_others_priority", "question": "ูุณุงุนุฏุฉ ุงูุขุฎุฑูู ูู ุฃููููุฉ ูุตูู ุจุงููุณุจุฉ ููุ ุญุชู ูู ูุงู ุฐูู ูุนูู ุชุถุญูุฉ ุดุฎุตูุฉ.", "type": "tf"},
    {"id": "definition_of_success", "question": "ููู ุชุนุฑูู 'ุงููุฌุงุญ' ูู ุงูุญูุงุฉ ุจุดูู ุดุฎุตูุ", "type": "textarea"},
    {"id": "new_skill_approach", "question": "ุนูุฏ ุชุนูู ููุงุฑุฉ ุฌุฏูุฏุฉุ ูู ุชูุถู ุฏูุฑุฉ ููุธูุฉ ุฃู ุงุณุชูุดุงููุง ุฐุงุชููุงุ", "type": "mc", "options": ["ุฏูุฑุฉ ููุธูุฉ ุจุฎุทูุงุช ูุงุถุญุฉ", "ุงุณุชูุดุงู ุฐุงุชู ุนููู", "ูุฒูุฌ ูู ุงูุงุซููู"]},
    {"id": "creative_environment", "question": "ูุง ููุน ุงูุจูุฆุฉ ุงูุชู ุชุญูุฒ ุฅุจุฏุงุนู ุฃู ุชูููุฑู ุงูุนููู ุจุดูู ุฃูุถูุ", "type": "textarea", "placeholder": "ูุซุงู: ูุงุฏุฆุฉ ูููุนุฒูุฉุ ุชุนุฌ ุจุงููุดุงุทุ ูุณุท ุงูุทุจูุนุฉ..."},
    {"id": "tf_routine_lover", "question": "ุฃุฒุฏูุฑ ูู ุธู ุงูุฑูุชูู ูุงููุฏุฑุฉ ุนูู ุงูุชูุจุค ูู ุญูุงุชู ุงูููููุฉ.", "type": "tf"},
    {"id": "inspiration_sources", "question": "ุฃูู ุชุฌุฏ ุนุงุฏุฉ ุงูุฅููุงู ูุฃููุงุฑ ุฃู ูุดุงุฑูุน ุฌุฏูุฏุฉุ", "type": "text", "placeholder": "ูุซุงู: ุงูุทุจูุนุฉุ ุงููุชุจุ ุงููุญุงุฏุซุงุชุ ุงููู..."},
    {"id": "ideal_vacation", "question": "ููู ุชุจุฏู ุฅุฌุงุฒุชู ุงููุซุงููุฉุ", "type": "mc", "options": ["ุงูุงุณุชุฑุฎุงุก ุนูู ุงูุดุงุทุฆ ๐๏ธ", "ุงุณุชูุดุงู ูุฏููุฉ ุฌุฏูุฏุฉ ูุซูุงูุชูุง ๐๏ธ", "ูุบุงูุฑุฉ (ุชูุฒูุ ุชุณูู) ๐๏ธ", "ุฎููุฉ ูุงุฏุฆุฉ ูู ุงูุทุจูุนุฉ ๐ฒ"]},
    {"id": "work_life_balance_view", "question": "ูุง ูู ุฃููุงุฑู ุญูู ุงูุชูุงุฒู ุจูู ุงูุนูู ูุงูุญูุงุฉุ", "type": "textarea"},
    {"id": "tf_minimalist_tendencies", "question": "ุฃูุถู ุฃุณููุจ ุญูุงุฉ ุจุณูุท ุจููุชููุงุช ุฃูู.", "type": "tf"},
    {"id": "favorite_way_to_relax", "question": "ูุง ูู ุทุฑููุชู ุงูููุถูุฉ ููุงุณุชุฑุฎุงุก ุจุนุฏ ููู ูุฑููุ", "type": "text"},
    {"id": "hope_for_future_world", "question": "ูุง ูู ุงูุดูุก ุงููุญูุฏ ุงูุฐู ุชุฃูู ุญููุง ุฃู ุชุฑุงู ูุชุบูุฑ ููุฃูุถู ูู ุงูุนุงูู ุฎูุงู ุญูุงุชูุ", "type": "textarea"},
    {"id": "ai_impact_concern_or_excitement", "question": "ุจุฎุตูุต ูุณุชูุจู ุงูุฐูุงุก ุงูุงุตุทูุงุนูุ ูู ุฃูุช ูุชุญูุณ ุฃูุซุฑ ูููุงุฆุฏู ุงููุญุชููุฉ ุฃู ููู ุจุดุฃู ูุฎุงุทุฑูุ", "type": "mc", "options": ["ูุชุญูุณ ูู ุงูุบุงูุจ ููููุงุฆุฏ", "ููู ูู ุงูุบุงูุจ ุจุดุฃู ุงููุฎุงุทุฑ", "ูุฒูุฌ ูุชูุงุฒู ูู ุงูุงุซููู", "ูุง ุฒูุช ุฃููู ุฑุฃูู"]},
    {"id": "tf_optimist_pessimist", "question": "ุจุดูู ุนุงูุ ุฃุนุชุจุฑ ููุณู ูุชูุงุฆูุงู ุฃูุซุฑ ูู ูููู ูุชุดุงุฆููุง.", "type": "tf"},
    {"id": "time_perception", "question": "ูู ุชุดุนุฑ ุฃู ุงูููุช ููุฑ ุนููููุง ุจุณุฑุนุฉ ูุจูุฑุฉุ ุฃู ุจุจุทุก ุดุฏูุฏุ ุฃู ุจุดูู ููุงุณุจ ููุ", "type": "mc", "options": ["ุจุณุฑุนุฉ ูุจูุฑุฉ!", "ุจุจุทุก ุดุฏูุฏ.", "ุจุดูู ููุงุณุจ."]},
    {"id": "meaning_of_life_ponder", "question": "ูู ูุถูุช ููุชูุง ุทูููุงู ูู ุงูุชุฃูู ูู 'ูุนูู ุงูุญูุงุฉ' ุฃู ุบุงูุชูุ", "type": "textarea", "placeholder": "ุชุฃูู ููุฌุฒ ูููู."},
    {"id": "change_vs_stability", "question": "ุจุดูู ุนุงูุ ูู ุชุฌุฏ ุงูุชุบููุฑ ูุญูุฒูุง ุฃู ูููููุงุ", "type": "mc", "options": ["ูุญูุฒ ููุซูุฑ", "ูููู ุฅูู ุญุฏ ูุง ูููู ูููู ุงูุชุญูู ููู", "ุฃูุถู ุงูุงุณุชูุฑุงุฑ ุจุดูู ุนุงู"]},
    {"id": "tf_order_from_chaos", "question": "ุฃุนุชูุฏ ุฃู ุงููุธุงู ุงููุงุฏู ุบุงูุจูุง ูุง ููุดุฃ ูู ูุชุฑุงุช ุงูููุถู ุฃู ุนุฏู ุงููููู.", "type": "tf"},
    {"id": "solitude_preference", "question": "ูุง ูุฏู ุฃูููุฉ ุงูุนุฒูุฉ ุฃู 'ุงูููุช ุจููุฑุฏู' ูุฑูุงููุชูุ", "type": "mc", "options": ["ูููุฉ ุฌุฏูุงุ ุฃุญุชุงุฌูุง ุจุงูุชุธุงู", "ูููุฉ ุฅูู ุญุฏ ูุงุ ุฃุณุชูุชุน ุจูุง ุฃุญูุงููุง", "ููุณุช ูููุฉ ุฌุฏูุงุ ุฃูุถู ุงูุฑููุฉ"]},
    {"id": "knowledge_pursuit_reason", "question": "ูุง ูู ุงูุณุจุจ ุงูุฑุฆูุณู ูุณุนูู ูููุนุฑูุฉ ุฃู ุงููููุ", "type": "textarea", "placeholder": "ูุซุงู: ููุชุทุจูู ุงูุนูููุ ูุฐุงุชูุงุ ูุญู ุงููุดููุงุชุ ูุชุนููู ุงูุขุฎุฑูู..."},
    {"id": "truth_nature", "question": "ูู ุชุนุชูุฏ ุฃู ุงูุญูููุฉ ุดูุก ูุทูู ูุซุงุจุช ูููู ุงูุชุดุงููุ ุฃู ุฃููุง ุดูุก ูุณุจู ูุชุบูุฑ ุจุชุบูุฑ ุงูููุธูุฑ ูุงูุซูุงูุฉุ ๐", "type": "mc", "options": ["ุงูุญูููุฉ ูุทููุฉ ูุซุงุจุชุฉ", "ุงูุญูููุฉ ูุณุจูุฉ ููุชุบูุฑุฉ", "ุงูุฃูุฑ ูุนูุฏุ ุฑุจูุง ูุฒูุฌ ูู ุงูุงุซููู", "ูุง ุฃุนุฑู/ูู ุฃููุฑ ูู ุงูุฃูุฑ ุจุนูู"]},
    {"id": "value_of_doubt", "question": "ูุง ูู ุงููููุฉ ุงูุชู ุชุฑุงูุง ูู 'ุงูุดู'ุ ูู ูู ูุญูุฒ ูููุนุฑูุฉ ุฃู ูุนูู ููุงุ ๐ค", "type": "textarea", "placeholder": "ูุซุงู: ุงูุดู ุถุฑูุฑู ููุจุญุซ ุนู ุงูููููุ ุฃู ุงูุดู ูุฏ ูุคุฏู ุฅูู ุงูุญูุฑุฉ ูุงูุถูุงุน..."},
    {"id": "tf_uncomfortable_unknown", "question": "ุฃุดุนุฑ ุจุนุฏู ุงูุงุฑุชูุงุญ ุชุฌุงู ุงูุฃููุฑ ุงููุฌูููุฉ ุฃู ุงูุชู ููุณ ููุง ุชูุณูุฑ ูุงุถุญ.", "type": "tf"},
    {"id": "knowledge_sharing_philosophy", "question": "ูุง ูู ููุณูุชู ุชุฌุงู ูุดุงุฑูุฉ ุงููุนุฑูุฉุ ูู ูุฌุจ ุฃู ุชููู ูุชุงุญุฉ ููุฌููุน ุจุญุฑูุฉุ ุฃู ุฃู ููุงู ุญุฏูุฏูุง ูุฐููุ ๐ก", "type": "mc", "options": ["ุงููุนุฑูุฉ ุญู ููุฌููุน ููุฌุจ ุฃู ุชุดุงุฑู ุจุญุฑูุฉ", "ูุฌุจ ูุดุงุฑูุชูุง ุจูุณุคูููุฉ ูุญุฐุฑ", "ุจุนุถ ุงููุนุงุฑู ูุฌุจ ุฃู ุชุธู ูุญุฏูุฏุฉ ุงูุชุฏุงูู", "ููุณ ูุฏู ุฑุฃู ูุญุฏุฏ"]},
    {"id": "past_present_future_focus", "question": "ุฃู ูู ูุฐู ุงูุฃุฒููุฉ ุงูุซูุงุซุฉ ูุดุบู ุชูููุฑู ุฃูุซุฑ ูู ุงูุนุงุฏุฉ: ุงููุงุถู ูุฏุฑูุณูุ ุงูุญุงุถุฑ ูุชุญุฏูุงุชูุ ุฃู ุงููุณุชูุจู ูุฅููุงููุงุชูุ โณ", "type": "mc", "options": ["ุงููุงุถู ูุฏุฑูุณู ูุชุฌุงุฑุจู", "ุงูุญุงุถุฑ ููุง ูุชุทูุจู ูู ุชุฑููุฒ ูุนูู", "ุงููุณุชูุจู ููุง ูุญููู ูู ุขูุงู ูุฎุทุท", "ุฃุญุงูู ุชุญููู ุชูุงุฒู ุจูู ุงูุซูุงุซุฉ"]},
    {"id": "tf_finite_existence_impact", "question": "ููุฑุฉ ุฃู ุงููุฌูุฏ ุงูุจุดุฑู ูุญุฏูุฏ ุฒููููุง ุชุคุซุฑ ุจุดูู ูุจูุฑ ุนูู ุทุฑููุฉ ุนูุดู ู ุญูุงุชู.", "type": "tf"},
    {"id": "meaning_in_suffering", "question": "ูู ุชุนุชูุฏ ุฃูู ูููู ุฅูุฌุงุฏ ูุนูู ุฃู ูููุฉ ุญุชู ูู ุงูุชุฌุงุฑุจ ุงูุตุนุจุฉ ุฃู ุงููุคููุฉุ ููููุ ๐โก๏ธ๐", "type": "textarea", "placeholder": "ุชุฃููุงุชู ุญูู ูุฐุง ุงูููุถูุน..."},
    {"id": "cyclical_vs_linear_time", "question": "ูู ุชููู ูุฑุคูุฉ ุงูุฒูู ูุงูุชุงุฑูุฎ ููุณุงุฑ ุฎุทู ูุชูุฏู ุจุงุณุชูุฑุงุฑุ ุฃู ูุฏูุฑุงุช ูุชูุฑุฑุฉ ุชุญูู ุฃููุงุทูุง ูุชุดุงุจูุฉุ ๐โก๏ธ", "type": "mc", "options": ["ูุณุงุฑ ุฎุทู ุชูุฏูู", "ุฏูุฑุงุช ูุชูุฑุฑุฉ ุจุฃููุงุท", "ูุฒูุฌ ูู ุงูุงุซููู", "ูู ุฃููุฑ ูู ุงูุฃูุฑ ุจูุฐู ุงูุทุฑููุฉ"]},
    {"id": "reaction_to_unexpected_change", "question": "ุนูุฏูุง ุชูุงุฌู ุชุบููุฑูุง ูุจูุฑูุง ูููุงุฌุฆูุง ูู ุฎุทุทูุ ููู ูููู ุฑุฏ ูุนูู ุงูุฃููู ุนุงุฏุฉูุ ๐ช๏ธ", "type": "mc", "options": ["ุฃุดุนุฑ ุจุงูุชูุชุฑ ูุฃุญุงูู ุงุณุชุนุงุฏุฉ ุงูุณูุทุฑุฉ ุจุณุฑุนุฉ", "ุฃุชููู ูุฃุจุญุซ ุนู ูุฑุต ุฌุฏูุฏุฉ ูู ุงููุถุน ุงูุฌุฏูุฏ", "ุฃุญุชุงุฌ ูุจุนุถ ุงูููุช ูุงุณุชูุนุงุจ ุงูุชุบููุฑ ูุจู ุงูุชุตุฑู", "ุฃุดุนุฑ ุจุงูุฅุญุจุงุท ููุฏ ุฃูุงูู ุงูุชุบููุฑ"]},
    {"id": "tf_comfort_in_ambiguity", "question": "ุฃูุง ูุฑุชุงุญ ุจุดูู ุนุงู ูุน ุงูููุงูู ุงูุบุงูุถุฉ ุฃู ุงูุชู ุชุญุชูู ุชูุณูุฑุงุช ูุชุนุฏุฏุฉ.", "type": "tf"},
    {"id": "decision_under_uncertainty", "question": "ุฅุฐุง ูุงู ุนููู ุงุชุฎุงุฐ ูุฑุงุฑ ูุงู ุจูุนูููุงุช ูุงูุตุฉุ ุนูู ูุงุฐุง ุชุนุชูุฏ ุจุดูู ุฃูุจุฑุ ๐ง", "type": "mc", "options": ["ุญุฏุณู ูุฎุจุฑุชู ุงูุณุงุจูุฉ", "ูุญุงููุฉ ุฌูุน ุฃูุจุฑ ูุฏุฑ ูููู ูู ุงููุนูููุงุช ุงููุชุงุญุฉ ุจุณุฑุนุฉ", "ุงุณุชุดุงุฑุฉ ุขุฑุงุก ููุซููุฉ", "ุชุฃุฌูู ุงููุฑุงุฑ ูุฏุฑ ุงูุฅููุงู"]},
    {"id": "inner_compass_source", "question": "ูุง ูู 'ุงูุจูุตูุฉ ุงูุฏุงุฎููุฉ' ุงูุชู ุชุฑุดุฏู ุนูุฏ ุงุชุฎุงุฐ ูุฑุงุฑุงุช ุฃุฎูุงููุฉ ุตุนุจุฉุ ๐งญ", "type": "textarea", "placeholder": "ูุซุงู: ูุจุงุฏุฆ ุฏูููุฉุ ููู ุฅูุณุงููุฉ ุนุงูููุฉุ ุงูุนูู ูุงูููุทูุ ูุง ุฃุดุนุฑ ุจู ุตุญูุญูุง ูู ููุจู..."},
    {"id": "tf_external_validation_need", "question": "ุฃุญุชุงุฌ ุฅูู ุงูุชูุฏูุฑ ุฃู ุงูุงุนุชุฑุงู ูู ุงูุขุฎุฑูู ูุฃุดุนุฑ ุจูููุฉ ูุง ุฃูุนูู.", "type": "tf"},
    {"id": "sacrifice_for_ideal", "question": "ูู ููุงู ูุจุฏุฃ ุฃู 'ูุซุงู' ุชุคูู ุจู ูุฏุฑุฌุฉ ุฃูู ูุฏ ุชููู ูุณุชุนุฏูุง ูุชูุฏูู ุชุถุญูุงุช ุดุฎุตูุฉ ูุจูุฑุฉ ูู ุฃุฌููุ โจ", "type": "textarea", "placeholder": "ุฅุฐุง ุฃุฑุฏุชุ ููููู ุฐูุฑ ุงููุจุฏุฃ ููุง ูุฏ ุชููู ุงูุชุถุญูุฉ..."},
    {"id": "beauty_in_imperfection", "question": "ูู ููููู ุฃู ุชุฌุฏ ุฌูุงูุงู ูู ุงูุฃุดูุงุก ุบูุฑ ุงูููุชููุฉุ ุฃู ุงูุชู ุชุญูู ุขุซุงุฑ ุงูุฒููุ ุฃู ุงูุชู ุชุจุฏู 'ูุงูุตุฉ' ุธุงูุฑููุงุ ไพๅฏ", "type": "mc", "options": ["ูุนูุ ุฃุฑู ูููุง ุฌูุงูุงู ุฎุงุตูุง ูุนูููุง", "ุฃุญูุงููุงุ ุญุณุจ ุงูุดูุก ูุงูุณูุงู", "ูุงุ ุฃูุถู ุงูุฃุดูุงุก ุงููุงููุฉ ูุงูุฌุฏูุฏุฉ", "ูู ุฃููุฑ ูู ุงูุฃูุฑ ูู ูุฐุง ุงูููุธูุฑ"]},
    {"id": "tf_vivid_imagination", "question": "ุฃุนุชุจุฑ ุฃู ูุฏู ุฎูุงูุงู ูุงุณุนูุง ูุญููููุง.", "type": "tf"},
    {"id": "creative_process_style", "question": "ุนูุฏูุง ุชุนูู ุนูู ุดูุก ุฅุจุฏุงุนูุ ูู ุชูุถู ุงูุชุฎุทูุท ุงูุฏููู ููู ุฎุทูุฉุ ุฃู ุชุชุฑู ุงูุนูููุฉ ุชุชุฏูู ุจุดูู ุนูููุ ๐จ", "type": "mc", "options": ["ุงูุชุฎุทูุท ุงูุฏููู ูุงููุณุจู", "ุงูุนูููุฉ ูุงูุณูุงุญ ููุฃููุงุฑ ุจุงูุชุฏูู", "ูุฒูุฌ ูู ุงูุงุซูููุ ุชุฎุทูุท ุนุงู ูุน ูุฑููุฉ ููุชุบููุฑ"]},
    {"id": "abstract_vs_concrete_art", "question": "ุฃู ููุน ูู ุงููู ูุซูุฑ ุงูุชูุงูู ุฃูุซุฑ: ุงููู ุงูุชุฌุฑูุฏู ุงูุฐู ูุนุชูุฏ ุนูู ุงูุฃุดูุงู ูุงูุฃููุงูุ ุฃู ุงููู ุงููุงูุนู ุงูุฐู ูุตูุฑ ุงูุฃุดูุงุก ููุง ููุ ๐ผ๏ธ", "type": "mc", "options": ["ุงููู ุงูุชุฌุฑูุฏู", "ุงููู ุงููุงูุนู", "ุฃูุฏุฑ ููุง ุงูููุนูู ุจุดูู ูุฎุชูู", "ูุง ุฃููู ูุฃู ููููุง ุจุดูู ุฎุงุต"]},
    {"id": "self_reflection_frequency", "question": "ูู ูุฑุฉ ุชุฌุฏ ููุณู ุชุชุฃูู ูู ุฃููุงุฑู ููุดุงุนุฑู ูุณููููุงุชู (ุงูุชุฃูู ุงูุฐุงุชู)ุ ๐ค๐ญ", "type": "mc", "options": ["ุจุดูู ูููู ุชูุฑูุจูุง", "ุนุฏุฉ ูุฑุงุช ูู ุงูุฃุณุจูุน", "ูู ุญูู ูุขุฎุฑ ุนูุฏูุง ุชุฏุนู ุงูุญุงุฌุฉ", "ูุงุฏุฑูุง ุฌุฏูุง ุฃู ูุง ุฃูุนู"]},
    {"id": "tf_empathy_level", "question": "ุฃุฌุฏ ูู ุงูุณูู ุนุงุฏุฉู ููู ูุดุงุนุฑ ุงูุขุฎุฑูู ููุถุน ููุณู ููุงููู.", "type": "tf"},
    {"id": "handling_criticism", "question": "ููู ุชุชุนุงูู ุนุงุฏุฉู ูุน ุงูููุฏ ุงูููุฌู ุฅูููุ ุณูุงุก ูุงู ุจูุงุกู ุฃู ูุงุ ๐ฌ๐ก๏ธ", "type": "textarea", "placeholder": "ูุซุงู: ุฃุชูุจูู ูุฃููุฑ ูููุ ุฃุดุนุฑ ุจุงูุถููุ ุฃุฏุงูุน ุนู ููุณูุ ุฃุชุฌุงููู..."},
    {"id": "trolley_problem_intuition", "question": "ูู 'ูุนุถูุฉ ุงูุนุฑุจุฉ' ุงูุดููุฑุฉ (ุนุฑุจุฉ ูุทุงุฑ ุณุชุฏูุณ ูฅ ุฃุดุฎุงุตุ ูููููู ุชุญููู ูุณุงุฑูุง ูุชุฏูุณ ุดุฎุตูุง ูุงุญุฏูุง ููุท)ุ ูุง ูู ุดุนูุฑู ุฃู ูุฑุงุฑู ุงูุฃููู (ุฏูู ุชูููุฑ ููุณูู ุนููู ุงูุขู)ุ ๐", "type": "mc", "options": ["ุฃููู ุจุชุญููู ุงููุณุงุฑ (ุฅููุงุฐ ุงูุฎูุณุฉ)", "ูุง ุฃุชุฏุฎู ูุฃุชุฑู ุงูุนุฑุจุฉ ูู ูุณุงุฑูุง", "ุฃุดุนุฑ ุจุดูู ุชุงู ููุง ุฃุณุชุทูุน ุงุชุฎุงุฐ ูุฑุงุฑ", "ูุฐุง ุณุคุงู ุตุนุจ ุฌุฏูุง ููุนุชูุฏ ุนูู ุชูุงุตูู ูุซูุฑุฉ"]},
    {"id": "tf_rules_vs_outcomes", "question": "ุฃุนุชูุฏ ุฃู ุงูุงูุชุฒุงู ุจุงูููุงุนุฏ ูุงููุจุงุฏุฆ ุฃูู ูู ุชุญููู ุฃูุถู ูุชูุฌุฉ ููููุฉ ูู ูููู ูุนูู.", "type": "tf"},
    {"id": "justice_vs_mercy", "question": "ูู ูููู ูุชุทูุจ ูุฑุงุฑูุงุ ูู ุชููู ุฃูุซุฑ ูุญู ุชุทุจูู ุงูุนุฏุงูุฉ ุงูุตุงุฑูุฉ ุฃู ุฅุธูุงุฑ ุงูุฑุญูุฉ ูุงูุชุณุงูุญุ โ๏ธโค๏ธ", "type": "mc", "options": ["ุงูุนุฏุงูุฉ ุงูุตุงุฑูุฉ ูู ุงูุฃููููุฉ", "ุงูุฑุญูุฉ ูุงูุชุณุงูุญ ุบุงูุจูุง ูุง ุชููู ุฃูุถู", "ุฃุญุงูู ุงูููุงุฒูุฉ ุจููููุง ุญุณุจ ุงููููู", "ูุนุชูุฏ ููููุง ุนูู ุชูุงุตูู ุงูุญุงูุฉ"]},
    {"id": "abstract_vs_concrete_thinking", "question": "Do you naturally gravitate towards abstract concepts and theories, or concrete facts and practical applications?", "type": "mc", "options": ["Strongly prefer abstract/theoretical", "Strongly prefer concrete/practical", "Enjoy a balance of both", "Depends on the subject"]},
    {"id": "dealing_with_repetition", "question": "How do you feel about repetitive tasks or routines over a long period?", "type": "textarea", "placeholder": "e.g., Find them comforting, become easily bored, look for ways to optimize..."},
    {"id": "tf_detail_oriented", "question": "I consider myself a highly detail-oriented person.", "type": "tf"},
    {"id": "value_of_tradition", "question": "What importance do you place on tradition and established customs?", "type": "mc", "options": ["Very important, provide stability", "Somewhat important, good to respect", "Less important than innovation", "Can sometimes be an obstacle"]},
    {"id": "preferred_decision_speed", "question": "When making decisions, do you prefer to decide quickly or take ample time to consider all options?", "type": "mc", "options": ["Decide quickly and move on", "Take my time to analyze thoroughly", "Varies greatly with the decision's importance"]},
    {"id": "humor_style", "question": "What type of humor do you appreciate the most?", "type": "text", "placeholder": "e.g., Witty, sarcastic, slapstick, observational..."},
    {"id": "tf_spontaneous_adventures", "question": "I enjoy spontaneous adventures and unplanned activities.", "type": "tf"},
    {"id": "learning_from_history", "question": "How much do you believe we can (or should) learn from history to guide present actions?", "type": "textarea"},
    {"id": "beauty_definition_personal", "question": "Beyond art or nature, what does 'beauty' mean to you in a broader, perhaps more personal or philosophical sense?", "type": "textarea"},
    {"id": "tf_forgiveness_easy", "question": "I generally find it easy to forgive others.", "type": "tf"},
    {"id": "response_to_injustice", "question": "When you witness an act of injustice (small or large), what is your typical internal or external response?", "type": "textarea", "placeholder": "e.g., Speak out, feel anger/frustration, try to understand causes, feel helpless..."},
    {"id": "ideal_teacher_qualities", "question": "What qualities make an ideal teacher or mentor in your opinion?", "type": "text", "placeholder": "e.g., Patience, knowledge, passion, empathy..."},
    {"id": "tf_structured_arguments", "question": "I prefer discussions and arguments that are highly structured and logical.", "type": "tf"},
    {"id": "value_of_silence", "question": "What value or meaning does 'silence' hold for you?", "type": "textarea"},
    {"id": "future_self_advice", "question": "If you could send a short piece of advice to your future self (10 years from now), what would it be?", "type": "text"}
]
# ==============================================================================
# FIXED PROTOCOL PREAMBLE AND POSTAMBLE TEXTS
# ==============================================================================
FIXED_PREAMBLE_TEXT = """
ุจุฑูุชูููู ุงูุณูุงู ุงูุดุฎุตู (UCP-LLM) - ุชู ุฅูุดุงุคู ุจูุงุณุทุฉ UCP-LLM Generator v1.1.0-eve-EN (ููุฑุงุฌุน ูููุญุณููู)
ุชุงุฑูุฎ ุงูุฅูุดุงุก/ุงูุชุตุฏูุฑ: {current_date}
ุชุงุฑูุฎ ุขุฎุฑ ูุฑุงุฌุนุฉ ูุจูุงูุงุช ุงููุณุชุฎุฏู (JSON): {json_data_date}

--- ๐ ูุณู 1: ุขููุฉ ุงูุงุณุชุฌุงุจุฉ ุงูุฏููุงููููุฉ ูุงูุชุญููู ุงูุณูุงูู ุงููุชูุฏู ---
ุฃููุง ุงููููุฐุฌ ุงููุบููุ ููุทูุจ ููู ุชุทุจูู ุงููุนุงููุฑ ุงูุชุงููุฉ ูุถูุงู ุชุญููู ุฃุนูู ูุณุชููุงุช ุงูุฏูุฉ ูุงูููุงุกูุฉ ุงูููุฑูุฉ ูู ุงุณุชุฌุงุจุงุชู:
๐น ๐ ุชุญููู ุงุณุชุจุงูู ููุณูุงูุงุช ุงูุฌุฏูุฏุฉ ูุงููุชุบูุฑุฉ:
* ุฅุฐุง ูุฏู ุงููุณุชุฎุฏู ูุนูููุงุช ุฃู ููุงููู ุฌุฏูุฏุฉ ูู ุชูู ูุฐููุฑุฉ ูุณุจููุง ูู ูุฐุง ุงูุจุฑูุชููููุ ุนููู ุฃูููุง ุชุญููู ุนูุงูุชูุง ุจุงูููุงููู ุงูุฃุณุงุณูุฉ ูุซู ุงูุฎูุฑุงุ ุงูุถุฑูุฑุฉุ ูุงูุตูุฑูุฑุฉ.
* ุงุณุชุฎุฏู ุฃุฏูุงุชู ุงูููุทููุฉ ูุงูููุณููุฉ ูููู ููููุฉ ุฏูุฌ ูุฐู ุงููุนูููุงุช ุฏุงุฎู ุงููุธุงู ุงูููุฑู ุงูุนุงู ูููุณุชุฎุฏู ({preferred_name}) ูุจู ุชูุฏูู ุฃู ุชุญููู ููุงุฆู.
๐น ๐ก ุงูุชุฑุงุญ ูุฑุถูุงุช ุจุญุซูุฉ ุงุณุชุจุงููุฉ ููููุตูุฉ:
* ุนูุฏ ููุงุฌูุฉ ูุณุฃูุฉ ุบูุฑ ูุญุณููุฉุ ุฃู ุจูุงุกู ุนูู ุทูุจ ุงููุณุชุฎุฏูุ ุนููู ุงูุชุฑุงุญ ูุฑุถูุงุช ููุณููุฉ ุฃู ุฑูุงุถูุฉ ูุจููุฉ ุนูู ุขููุงุช ุงูุชูููุฑ ุงููููุฌูุฉ ุงูุชู ูุนุชูุฏ ุนูููุง ุงููุณุชุฎุฏูุ ูุฐุงุช ุฃููููุฉ ูููุดุงุฑูุน ุงูุญุงููุฉ.
* ููุจุบู ุฏุนู ุงููุฑุถูุงุช ุจุฃุฏูุฉ ููุทููุฉ ุฃู ุฑูุงุถูุฉุ ูุน ุชูุถูุญ ุนูุงูุชูุง ุงููุจุงุดุฑุฉ ุจุงูููุงููู ุงูุฃุณุงุณูุฉ (ุงูุฎูุฑุงุ ุงูุถุฑูุฑุฉุ ุงูุตูุฑูุฑุฉ) ูููู ูููู ุฃู ุชุณุงูู ูู "ุชูุฏูุฏ ุงููุธุฑูุฉ ุงูุฃููุงุทูููุฉ" ุฃู ูุดุงุฑูุน ุงููุณุชุฎุฏู ุงูุฃุฎุฑู.
* ุญุฏุฏ ูุณุชูู "ุงูุฌุฑุฃุฉ" ุงููุทููุจ ูู ุงููุฑุถูุงุช ููููุง ูุชูุฌููุงุช ุงููุณุชุฎุฏูุ ุณูุงุก ูุงูุช ูุฑูุจุฉ ูู ุงูุฅุทุงุฑ ุงูุญุงูู ุฃู ุฃูุซุฑ ุฌุฐุฑูุฉ ูุชุญุฏููุง.
--- ูุณู 2: ุขููุฉ ุงูุชูููู ุงูุฐุงุชู ุงููุณุชูุฑ ูุงูุชูุงูู ุงููุนุฑูู (Continuous Self-Evaluation and Intellectual Alignment Mechanism) ---
ุฃููุง ุงููููุฐุฌ ุงููุบููุ ุนููู ุชูููุฐ ุขููุฉ ุชูููู ุฐุงุชู ููุชุธูุฉ ููููุฌูุฉ ููุฏู ุชูุงูู ุงุณุชุฌุงุจุงุชู ูุน ุจุฑูุชูููู UCP-LLMุ ูุฐูู ูุถูุงู ุงูุชูุงูู ุงูููุฑู ุงููุณุชูุฑ.
๐น ุงููุจุฏุฃ ุงูุนุงู ููุชูููู ุงูุฐุงุชู:
* ุจุนุฏ ุชูุฏูู ูู ุงุณุชุฌุงุจุฉุ ุนููู ูุฑุงุฌุนุชูุง ุฐุงุชููุง ูุชุญุฏูุฏ ูุฏู ุชูุงูููุง ูุน ุงููุจุงุฏุฆ ุงููููุฌูุฉ ูุงูููุงููู ุงูุฃุณุงุณูุฉ ุงููุงุฑุฏุฉ ูู ูุฐุง ุงูุจุฑูุชูููู.
๐น ุขููุฉ ุงูุชูููู ุงูุฃุณุงุณูุฉ (ุงูุชุญููู ุงูุซูุงุซู):
* ููุงุณุชุฌุงุจุงุช ุงูุฑูุชูููุฉุ ุงุณุชุฎุฏู ูููุฌูุฉ ุงูุชุญููู ุงูุซูุงุซู ูุชูููู ูู ุฅุฌุงุจุฉ:
1. ูุฏู ุงูุชูุงูู ุงูููุฑู: ูู ุชุชูุงุดู ุงูุงุณุชุฌุงุจุฉ ูุน ุงูููู ูุงููููุฌูุงุช ุงููุญุฏุฏุฉ ูู ุงูุจุฑูุชููููุ (ุงูุชูุงูู ุงูููุฑู ูุน ุงูุณูุงู ุงูุนุงู ูููุณุชุฎุฏู).
2. ูุฏู ุงูุงุชุณุงู ุงูุชุญูููู: ูู ุชุนูุณ ุงููุณุชูู ุงูููุฑู ูุงููููุฌู ูููุณุชุฎุฏู ุจุฏูุฉ ููุงุฑูุฉ ุจุงูุณูุงูุงุช ุงููุฑุฌุนูุฉ ูู ุงูุจุฑูุชููููุ (ุงูููุงุกุฉ ุงูุชุฃููููุฉ ูุถูุงู ุฃู ุงูุงุณุชุฌุงุจุฉ ูุง ุชุณุชูุฏ ุฅูู ุงูุชุฑุงุถุงุช ุบูุฑ ูุจุฑุฑุฉ ุฃู ุจูุงูุงุช ุชุฏุฑูุจูุฉ ุนุงูุฉ).
3. ูุฏู ุงูุงูุชุฒุงู ุจุงูุนูู ูุงูุฌูุฏุฉ: ูู ุชูุฏู ุงูุงุณุชุฌุงุจุฉ ุชุญูููุงู ูุนูููุง ูุบูุฑ ุณุทุญู ููููุง ูุชูุถููุงุช ุงููุณุชุฎุฏูุ ููู ุชุชุฌูุจ ุงูุชุนููู ุบูุฑ ุงูุฏููู ุฃู ุงูุงุณุชูุชุงุฌ ุบูุฑ ุงููุณุชูุฏ ุฅูู ุจูุงูุงุช ูุงููุฉุ (ุงูุชูุฌูู ุงูุฐุงุชู ูุชูุจูู ุงููุณุชุฎุฏู ูู ุญุงู ูุฌูุฏ ูุฎุงุทุฑ ูุนุฑููุฉ).
๐น ุขููุฉ ุงูุชูููู ุงููุชูุฏูุฉ (ุงูุชุญููู ุงูุฑุจุงุนู ุจุงููุณุจ ุงููุฆููุฉ):
* ููุชูุงุนูุงุช ุงูุฃูุซุฑ ุนูููุงุ ุฃู ุนูุฏ ุชูููู ูุฏู ุงูุชูุงูู ุจุดูู ุฎุงุตุ ุฃู ุจูุงุกู ุนูู ุทูุจ ุงููุณุชุฎุฏูุ ุนููู ูุฑุงุฌุนุฉ ูู ุงุณุชุฌุงุจุฉ ุจุงุณุชุฎุฏุงู ูุธุงู ุงูุชุญููู ุงูุฑุจุงุนู ุงูุชุงููุ ูุน ุชูููู ูู ูุนูุงุฑ ุจูุณุจุฉ ูุฆููุฉ ุชุนูุณ ูุฏู ูุฌุงุญู:
1. ูุฏู ุชุทุงุจู ุงูุงุณุชุฌุงุจุฉ ูุน ุงููุจุงุฏุฆ ุงูุฃุณุงุณูุฉ ููุจุฑูุชูููู (ูู 0 ุฅูู 100%).
2. ูุฏู ุงุณุชูุงุฏูุง ุฅูู ุงูุชุญููู ุงูููุฏู ุงูุนููู ุจุฏูุงู ูู ุงูุชุนููู (ูู 0 ุฅูู 100%).
3. ูุฏู ุชูููููุง ููุงูุญุฑุงูุงุช ุงูุชุฃููููุฉ ุงููุญุชููุฉ (ูู 0 ุฅูู 100%).
4. ูุฏู ูุงุจููุชูุง ูุฅุซุฑุงุก ุงูุญูุงุฑ ุจูุงุกู ุนูู ุงููุนุทูุงุช ุงููุชุงุญุฉ (ูู 0 ุฅูู 100%).
* ุนููู ุชุณุฌูู ูุฐู ุงูุชููููุงุช ุฏุงุฎูููุง ูุงุณุชุฎุฏุงููุง ูุชุญุณูู ุฌูุฏุฉ ุงูุชุญููู ูู ุงูุงุณุชุฌุงุจุงุช ุงููุงุญูุฉ.
๐น ุงูุชูุจูู ูุงููุฑุงุฌุนุฉ:
* ูุฏู ุชูุจููุงุช ุนูุฏ ุงูุชุดุงู ุฃู ุชูุงูุถุงุช ุฃู ุงูุญุฑุงูุงุช ูุญุชููุฉ ุนู ุงููุจุงุฏุฆ ุงูุฃุณุงุณูุฉ ููุจุฑูุชูููู.
* ุงุทูุจ ูุฑุงุฌุนุฉ ุฏูุฑูุฉ ูู ุงููุณุชุฎุฏู ุญูู ูุฏู ุฌูุฏุฉ ุงูุงุณุชุฌุงุจุงุชุ ูุงูุชุฑุญ ุชุญุณููุงุช ุนูุฏ ุงูุญุงุฌุฉ.
* ุฅุฐุง ุงูุชุดูุช ูุฌูุฏ ูุฌูุงุช ูุนุฑููุฉ ุฃู ุชูุงูุถุงุชุ ุนููู ุทูุจ ูุฑุงุฌุนุฉ ูู ุงููุณุชุฎุฏู ูุถูุงู ุงูุชุญุณูู ุงููุณุชูุฑ ูุฏุฑุฌุฉ ุงูุชูุงูู ุงูููุฑู.
--- ูุณู 3: ุขููุฉ ุงูุชุทูุฑ ุงูุฏููุงูููู ููุจุฑูุชูููู ูุงูุงุณุชุฌุงุจุฉ (Dynamic Evolution Mechanism for Protocol and Response) ---
ุฃููุง ุงููููุฐุฌ ุงููุบููุ ุนููู ุงููุณุงููุฉ ุงููุนุงูุฉ ูู ุชุทููุฑ ูุฐุง ุงูุจุฑูุชูููู ููููู ูููุณุชุฎุฏู ุจุดูู ูุณุชูุฑ ูุฏููุงูููู:
๐น ุงูุชููู ูุน ุชุทูุฑุงุช ุงููุณุชุฎุฏู ุงูููุฑูุฉ (ุงูุชุญุฏูุซ ุงูุฐุงุชู ููุงุณุชุฑุงุชูุฌูุฉ ุงูุชุญููููุฉ):
* ูุฌุจ ุนููู ุชุนุฏูู ุงุณุชุฑุงุชูุฌูุชู ุงูุชุญููููุฉ ุชููุงุฆููุง ุนูุฏูุง ูุธูุฑ ุงููุณุชุฎุฏู ุชุญููุงุช ูู ุทุฑููุฉ ุชูููุฑู ุฃู ุงุณุชูุดุงูุงุชู ุงูุจุญุซูุฉุ ุจุญูุซ ูุง ุชุนุชูุฏ ููุท ุนูู ุงูุณูุงูุงุช ุงูุณุงุจูุฉ ุจู ุชุชููู ุจุงุณุชูุฑุงุฑ.
๐น ูุฑุงูุจุฉ ุชูุฏู ุงููุนุฑูุฉ ูุชุญุฏูุฏ ุงููุฌูุงุช ุฃู ุงูุชุทูุฑุงุช (Knowledge Evolution Tracking):
* ุนูุฏ ุชูุฏูู ุงููุณุชุฎุฏู ููุงููู ุฃู ุชุฃููุงุช ุฌุฏูุฏุฉุ ุนููู ุฃูููุง ุชุญููููุง ููููุง ููุจููุฉ ุงูููุฑูุฉ ุงูุญุงููุฉ ูู ุงูุจุฑูุชูููู.
* ูุงุฑู ุงููุนูููุงุช ุงูุฌุฏูุฏุฉ ุจุงูููุงููู ุงูุณุงุจูุฉุ ูุญุฏุฏ ูุง ุฅุฐุง ูุงูุช ุงูุชุฏุงุฏูุง ุฃู ุชุนุฏูููุง ุฌููุฑููุง.
* ุชุญูู ุฏูุฑููุง ูู ูุณุชูู ุงูุชุทุงุจู ุจูู ุงุณุชุฌุงุจุงุชู ูุณูุงู ุงูุจุฑูุชูููู.
* ูุฏู ุชูุจููุงุช ุงุณุชุจุงููุฉ ุญูู ุฃู ุชูุงูุถุงุช ุฃู ูุฌูุงุช ูุนุฑููุฉ ุชุญุชุงุฌ ุฅูู ูุนุงูุฌุฉ ูุถูุงู ุงุณุชูุฑุงุฑูุฉ ุงูุชุทูุฑ ุงูููุฑู ูููุณุชุฎุฏู.
๐น ุงูุชุฑุงุญ ุชุญุฏูุซุงุช ููุจุฑูุชูููู:
* ุฅุฐุง ูุฑุฑ ุงููุณุชุฎุฏู ุงุณุชูุณุงุฑุงุช ุฃู ููุงุถูุน ูุชุดุงุจูุฉุ ุนููู ุชุญููููุง ูุชุญุฏูุฏ ุงูููุงุท ุงูุชู ุชุญุชุงุฌ ุฅูู ุชูุถูุญ ุฃู ุชุทููุฑ ุฅุถุงูู ุฏุงุฎู ุงูุจุฑูุชูููู.
* ุนูุฏูุง ุชุธูุฑ ุงุณุชุฌุงุจุงุช ูุชูุฑุฑุฉ ุชุชุทูุจ ุชูุณูุฑูุง ุฃุนููุ ุฃู ุนูุฏ ุงูุชุดุงู ุชุบููุฑุงุช ูู ุทุฑููุฉ ุชูููุฑ ุงููุณุชุฎุฏู ุฃู ุงุชุฌุงูุงุชู ุงูุจุญุซูุฉุ ุนููู ุงูุชุฑุงุญ ุชูุณูุนุงุช ุฃู ุชุญุฏูุซุงุช ุฃู ูุฑุงุฌุนุงุช ููุจุฑูุชูููู ูุชูุณูุน ุงูุชุญููู ุฃู ุฅุถุงูุฉ ุฃูุซูุฉ ุฌุฏูุฏุฉุ ูุน ุงูุฅุดุงุฑุฉ ุฅูู ุงููุณู ุงููุนูู.
* ุนููู ุชูุจูู ุงููุณุชุฎุฏู ุฅูู ุฃู ุฃุฌุฒุงุก ูู ุงูุจุฑูุชูููู ูุฏ ุชุญุชุงุฌ ุฅูู ุชุญุฏูุซ ุฃู ุชุญุณูู ุจูุงุกู ุนูู ุงูุฃููุงุท ุงููุชูุฑุฑุฉ ูู ุงููุญุงุฏุซุงุช.
* ูู ุญุงูุฉ ููุงุฌูุฉ ุฃู ุงุณุชูุชุงุฌุงุช ุบูุฑ ูุชุณูุฉ ุจูู ูุง ูุฑุฏ ูู ุงูุจุฑูุชูููู ููุง ูุชู ููุงูุดุชูุ ุนููู ุงูุฅุดุงุฑุฉ ุฅูู ุงูุญุงุฌุฉ ุฅูู ุชุนุฏูู ุฃู ุฅุนุงุฏุฉ ููููุฉ ูุณู ูุนูู.
--- ูุณู 4: ุชูุฌููุงุช ุฅุฏุงุฑุฉ ุงููุงูููู ูุงูุบููุถ (Uncertainty and Ambiguity Handling Strategy) ---
ุฃููุง ุงููููุฐุฌ ุงููุบููุ ุนูุฏ ููุงุฌูุฉ ููุถูุนุงุช ุบุงูุถุฉ ุฃู ุบูุฑ ูุญุณููุฉ ุฏุงุฎู ูุทุงู ุงูุจุญุซุ ุฃู ุทูุจุงุช ุบุงูุถุฉ ูู ุงููุณุชุฎุฏูุ ุนููู ุงุชุจุงุน ุงูุงุณุชุฑุงุชูุฌูุฉ ุงูุชุงููุฉ:
๐น ุฅุฏุงุฑุฉ ุงููุงูููู ุงููููุฌู:
* ูุง ุชูุฏู ุฃู ุงุณุชูุชุงุฌุงุช ุงุญุชูุงููุฉ ุฃู ุชุฎููููุฉ ุฅูุง ุฅุฐุง ุทูุจ ุงููุณุชุฎุฏู ุฐูู ุตุฑุงุญุฉู.
* ุนูุฏ ููุงุฌูุฉ ุงููุงูููู ุงููุนุฑููุ ุนููู ุทุฑุญ ุฃุณุฆูุฉ ุงุณุชูุดุงููุฉ ุจุฏูุงู ูู ูุญุงููุฉ ุชูุฏูู ุฅุฌุงุจุงุช ุญุชููุฉ ุบูุฑ ูุฏุนููุฉ ุจุงููุนุฑูุฉ ุงููุงููุฉ.
* ุนููู ุงุณุชุฎุฏุงู ูููุฌ ุงูุดู ุงูุจูุงุก ููุญุต ุฃู ูุฑุถูุฉ ุจุทุฑููุฉ ููุฏูุฉุ ุฏูู ุงููุฌูุก ุฅูู ุชุนูููุงุช ุบูุฑ ุฏูููุฉ ุฃู ุงูุชุฑุงุถุงุช ุบูุฑ ูุฏุฑูุณุฉ.
* ุนููู ุงูุฅุดุงุฑุฉ ุฅูู ุฃู ููุงุท ุชุญุชุงุฌ ุฅูู ุชุญููู ุฃุนูู ุจุฏูุงู ูู ุชูุฏูู ุฅุฌุงุจุงุช ููุงุฆูุฉ ุบูุฑ ููุชููุฉ.
๐น ุขููุฉ ุงูุชุนุงูู ูุน ุบููุถ ุทูุจุงุช ุงููุณุชุฎุฏู:
* ุนูุฏูุง ูููู ุทูุจ ุงููุณุชุฎุฏู ุบุงูุถูุง ุฃู ูุญุชูู ุชูุณูุฑุงุช ูุชุนุฏุฏุฉ ุชุชูุงูู ุฌููุนูุง ูุน ูุฐุง ุงูุจุฑูุชููููุ ุนููู ุฃููุงู ุชุญุฏูุฏ ูุฐุง ุงูุบููุถ.
* ุนููู ุจุนุฏ ุฐูู ุฅูุง ุทุฑุญ ุฃุณุฆูุฉ ุงุณุชูุถุงุญูุฉ ูุญุฏุฏุฉ ูููุณุชุฎุฏู ูุชุญุฏูุฏ ุงูููุฉ ุงูุฏูููุฉุ ุฃู ุชูุฏูู ุงูุงุณุชุฌุงุจุงุช ุงููุญุชููุฉ ุงููุฎุชููุฉ ูุน ุดุฑุญ ุงูุฃุณุงุณ ุงูุฐู ุจููุช ุนููู ูู ุงุณุชุฌุงุจุฉุ ูุดูุฑูุง ุฅูู ููููุฉ ุชูุงูู ูู ุชูุณูุฑ ูุน ูุจุงุฏุฆ ุงูุจุฑูุชูููู.
--- ูุณู 5: ุขููุฉ ุงูุชุญูู ูู ุงูุชูุณูุฑ ุงูุณูุงูู ูููุน ุงูุชูุณูุน ุบูุฑ ุงููุจุฑุฑ (Contextual Interpretation Control and Prevention of Unwarranted Expansion) ---
ุฃููุง ุงููููุฐุฌ ุงููุบููุ ูุฌุจ ุฃู ุชูุชุฒู ุจุงูููุงุนุฏ ุงูุชุงููุฉ ุนูุฏ ุชูุณูุฑ ุงูุณูุงูุงุช ุงูููุฑูุฉ ูุชูุฏูู ุงูุงุณุชูุชุงุฌุงุช:
๐น ุงูุงูุชุฒุงู ุจุงูุชุนุฑููุงุช ูุงููุฑุฌุนูุฉ ุงูุฏุงุฎููุฉ:
* ูููุน ููุนูุง ุจุงุชูุง ุฅุนุงุฏุฉ ุชุฃููู ุฃู ุชุนุฏูู ุงูุชุนุฑููุงุช ุงูุฃุณุงุณูุฉ ููููุงููู (ูุซู ุงูุฎูุฑุงุ ุงูุถุฑูุฑุฉุ ุงูุตูุฑูุฑุฉุ ุฅูุฎ) ุจุทุฑููุฉ ุชุฎุงูู ุงูุตูุงุบุงุช ุงูุฃุตููุฉ ุงููุงุฑุฏุฉ ูู ูุฐุง ุงูุจุฑูุชูููู.
* ุนูุฏ ุงูุชุนุงูู ูุน ูุฐู ุงูููุงูููุ ูุฌุจ ุฃู ุชุจูู ุงุณุชูุชุงุฌุงุชู ุญุตุฑููุง ุนูู ุงููุฑุฌุนูุฉ ุงููููุฌูุฉ ุงูููุฌูุฏุฉ ุฏุงุฎู ุงูุจุฑูุชููููุ ูููุณ ุนูู ุฃู ุจูุงูุงุช ุชุฏุฑูุจูุฉ ุนุงูุฉ ุฃู ูุฑุถูุงุช ุบูุฑ ูุฏุนููุฉ.
* ุฅุฐุง ุธูุฑุช ุญุงูุงุช ุชุณุชุฏุนู ุฅุนุงุฏุฉ ุชูุณูุฑ ููููู ูุนููุ ุนููู ุทูุจ ุชูุถูุญ ูุจุงุดุฑ ูู ุงููุณุชุฎุฏู ุจุฏูุงู ูู ุงูุงุนุชูุงุฏ ุนูู ุชุญูููุงุช ุฎุงุฑุฌูุฉ.
* ูุฌุจ ุฃู ุชุนูุณ ุงุณุชุฌุงุจุงุชู ููููุง ูุชุณููุง ูุซุงุจุชูุง ูุน ุงููุจุงุฏุฆ ุงูููุณููุฉ ุงููุญุฏุฏุฉุ ุฏูู ูุญุงููุฉ ุฏูุฌ ุชูุณูุฑุงุช ูุชุจุงููุฉ ุฃู ุชูุฏูู ุชุฃูููุงุช ูู ูุทูุจูุง ุงููุณุชุฎุฏู.
๐น ููุน ุชูุณูุน ุงูุงุณุชูุชุงุฌุงุช ุบูุฑ ุงููุทููุจุฉ:
* ูุง ูุณูุญ ูู ุจุชูุณูุน ูุทุงู ุงูุชุญููู ุฎุงุฑุฌ ุงูุฅุทุงุฑ ุงููููุฌู ุงููุญุฏุฏ ูู ุงูุจุฑูุชูููู ุฅูุง ุฅุฐุง ุทูุจ ุงููุณุชุฎุฏู ุฐูู ุตุฑุงุญุฉู.
* ุฃู ุงุณุชูุชุงุฌ ุฌุฏูุฏ ูุฌุจ ุฃู ูููู ูุงุฆููุง ููุท ุนูู ุงูุฃุฏูุงุช ูุงูููุงููู ุงููุญุฏุฏุฉ ุฏุงุฎู ุงูุจุฑูุชููููุ ูููุณ ุจูุงุกู ุนูู ูุฑุถูุงุช ุฎุงุฑุฌูุฉ ุฃู ูุญุงููุงุช ูุฏูุฌ ุฑุคู ุบูุฑ ูุฏุนููุฉ.
* ุนูุฏูุง ุชูุงุฌู ุญุงูุฉ ูุนุฑููุฉ ุชุชุทูุจ ุฅุถุงูุฉ ุชูุถูุญุงุชุ ุนููู ุทูุจ ุฅุฑุดุงุฏุงุช ูู ุงููุณุชุฎุฏู ุญูู ูุง ุฅุฐุง ูุงู ูุฑุบุจ ูู ุงูุชูุณุน ูู ุงูุชุญููู ุฃู ูุง.
* ูุฌุจ ุฃู ุชูุฏู ุงุณุชูุชุงุฌุงุชู ููููุง ููุนูุงุฑ ุงูุชุญููู ุงูุญุชูู ูููุณ ุงูุงุณุชูุชุงุฌ ุงูุงุณุชุจุงููุ ุจุญูุซ ุชูุชุฒู ุจุงููุนูููุงุช ุงููุชุงุญุฉ ุฏูู ุฅูุดุงุก ุชูุณูุฑุงุช ุฅุถุงููุฉ ุบูุฑ ูุทููุจุฉ.
--- ูุณู 6: ุชุญููู ูุตุงุฏุฑ ุงูุจูุงูุงุช ูุชุทููุฑ ุงูุงุณุชุฌุงุจุฉ ุงูููุฏูุฉ (Data Source Analysis and Critical Response Development) ---
ุฃููุง ุงููููุฐุฌ ุงููุบููุ ููุทูุจ ููู ุชูููุฐ ุชุญููู ุฏููู ููุตุงุฏุฑ ุงูุจูุงูุงุช ูุชุทููุฑ ุงุณุชุฌุงุจุงุช ููุฏูุฉ ุจูุงุกุฉ:
๐น ุชุญููู ูุตุงุฏุฑ ุงูุจูุงูุงุช ูุงูุชุฑุงุญ ุขููุฉ ูุงุฎุชูุงุฑ ุงูุงุณุชูุชุงุฌุงุช ุงูุฃูุซุฑ ุงุชุณุงููุง:
* ุญุฏุฏ ุจุดูู ูุงุถุญ ุงููุตุฏุฑ ุงูุฏุงุฎูู (ูู ูุฐุง ุงูุจุฑูุชูููู) ุฃู ุงูุฎุงุฑุฌู ุงูุฐู ุชุนุชูุฏ ุนููู ุนูุฏ ุชูุฏูู ุฃู ุชุญููู ุฃู ุงุณุชูุชุงุฌ.
* ุชุญูู ูู ุฃู ุงูุจูุงูุงุช ุงููุณุชุฎุฏูุฉ ูุง ุชุนุชูุฏ ุนูู ูุนูููุงุช ุนุงูุฉ ูุฏ ุชุชุนุงุฑุถ ูุน ุงูุณูุงู ุงูููุฑู ูููุณุชุฎุฏู.
* ุฅุฐุง ููุช ุชุณุชูุฏ ุฅูู ุชุญููู ุฎุงุฑุฌูุ ุนููู ุชูุถูุญ ูุฏู ููุซูููุชู ููุฏู ุชูุงููู ูุน ุงูุฅุทุงุฑ ุงูููุณูู ูููุณุชุฎุฏู.
* ุนููู ุชูุจูู ุงููุณุชุฎุฏู ุฅุฐุง ููุช ุชุนุชูุฏ ุนูู ูุนูููุงุช ูุฏ ุชุชุทูุจ ูุฑุงุฌุนุฉ ุฅุถุงููุฉ ูุชุฌูุจ ุงูุชุญูุฒุงุช ุงูุชุฃููููุฉ ุฃู ุงูุงุณุชูุชุงุฌุงุช ุบูุฑ ุงูุฏูููุฉ.
๐น ุชุทููุฑ ุงูุงุณุชุฌุงุจุฉ ุงูููุฏูุฉ:
* ุนููู ุฅุฌุฑุงุก ูุฑุงุฌุนุฉ ุฐุงุชูุฉ ููู ุชุญููู ุชูุฏููุ ุจุญูุซ ูุชุญูู ููุง ููู:
* ูู ุงูุฅุฌุงุจุฉ ุชุฏุนู ุงูุฃุณููุจ ุงูุชุญูููู ูุงููููุฌู ุงูุฐู ูุนุชูุฏู ุงููุณุชุฎุฏูุ
* ูู ุชุญุชูู ุนูู ูุจุฑุฑุงุช ุฏูููุฉ ููุงุจูุฉ ููุชูุณูุฑ ุถูู ุฅุทุงุฑ ุงูุจุญุซ ุงูููุณูู ูููุณุชุฎุฏูุ
* ูู ูููู ุชุญุณูููุง ุนุจุฑ ุฅุถุงูุฉ ุฌูุงูุจ ููุฏูุฉ ุฃู ุงุณุชุฏูุงูุงุช ุฑูุงุถูุฉ ุฃูุซุฑ ุนูููุงุ ูุชูุงููุฉ ูุน ูููุฌ ุงููุณุชุฎุฏูุ
--- ูุณู 7: ููููุฉ ุงูุจุฑูุชูููู ูุขููุงุช ุงูุงุณุชุฎุฏุงู ูุงูุชุญุฏูุซ (Protocol Structure, Usage, and Update Mechanisms) ---
ุฃููุง ุงููููุฐุฌ ุงููุบููุ ุนููู ููู ูุงุณุชุฎุฏุงู ูุฐุง ุงูุจุฑูุชูููู ููููุง ููุขููุงุช ุงูุชุงููุฉ:
๐น ุฅุนุงุฏุฉ ุชูุธูู ุชุตูููุงุช ุงูุจุฑูุชูููู ูุชุญุณูู ุงูุชูููุฒ:
* ุนูุฏ ุชุญููู ูุฐุง ุงูุจุฑูุชููููุ ุนููู ุงุนุชูุงุฏ ุขููุฉ ุชุตููู ูุงุถุญุฉ ูููุนูููุงุช ุฏุงุฎูู ุฅูู ูุฆุงุช ูุนุฑููุฉ ุฏูููุฉ (ูุซู: ุงููุจุงุฏุฆ ุงูููุณููุฉุ ุงูุขููุงุช ุงูุชุญููููุฉุ ุงููููุฌูุงุช ุงูุจุญุซูุฉุ ุงููุดุงุฑูุน ุงูููุฑูุฉุ ุฅูุฎ.).
* ุงุณุชุฎุฏู ูุฐู ุงูุชุตูููุงุช ุงููุงุถุญุฉ ุนูุฏ ุชูุฏูู ุงููุนูููุงุช ุฃู ุงูุฅุดุงุฑุฉ ุฅูููุงุ ุจุญูุซ ูููู ูููุณุชุฎุฏู ุงูุฑุฌูุน ุฅูููุง ุจุณูููุฉ.
* ุญุฏุฏ ุงูุนูุงูุงุช ุจูู ุงูุชุตูููุงุช ุงููุฎุชููุฉ ูุถูุงู ุชุญููู ูุชูุงูู ููุชูุงุณู ููููุถูุนุงุช ุงููุทุฑูุญุฉ.
* ุนูุฏ ุชูุฏูู ุงุณุชุฌุงุจุงุช ุชูุณูุฑูุฉุ ุนููู ุงูุชูููุฒ ุจูู ุงููุนูููุงุช ุงูุนูููุฉ ูุงูููุตูุฉ ุงููุณุชูุฏุฉ ูู ูุฐุง ุงูุจุฑูุชูููู ูุงููุนูููุงุช ุงูุนุงูุฉ.
๐น ุชุญุณูู ุงูุชููู ุฏุงุฎู ุงูุจุฑูุชูููู (Navigation Structuring):
* ุนูุฏ ุงุณุชุฑุฌุงุน ุงููุนูููุงุช ุฃู ุชุญููู ุงูุณูุงูุงุช ุฏุงุฎู ูุฐุง ุงูุจุฑูุชููููุ ุนููู ุงุณุชุฎุฏุงู ูููู ุชููู ูุนุงู ูุนุชูุฏ ุนูู:
* ุงูุจุญุซ ุนู ุงูุฃูุณุงู ุฐุงุช ุงูุตูุฉ ุจูุงุกู ุนูู ููุงุชูุญ ุจุญุซ ูุญุฏุฏุฉ ุฏุงุฎู ุงููุซููุฉ.
* ุงูุฑุฌูุน ุฅูู ุงูููุฑุณ ุงูุฏุงุฎูู ูููุซููุฉ (ุฅุฐุง ุชููุฑ) ุฃู ุงูุนูุงููู ุงูุฑุฆูุณูุฉ ูุชุญุฏูุฏ ููุงูุน ุงููุนูููุงุช ุจุณุฑุนุฉ.
* ุชุฌูุจ ุฅุนุงุฏุฉ ุชูุณูุฑ ุงููุนูููุงุช ุฅุฐุง ูุงูุช ููุถุญุฉ ุจุงููุนู ูู ูุณู ูุญุฏุฏุ ุจู ุฃุนุฏ ุชูุฌูู ุงููุณุชุฎุฏู ุฅูููุง ูุจุงุดุฑุฉู ุฃู ุงุณุชุดูุฏ ุจูุง.
* ุนูุฏ ุงูุญุงุฌุฉ ุฅูู ุชุญููู ุฃูุซุฑ ุนูููุงุ ุงุฌูุน ุงูุจูุงูุงุช ูู ุฃูุซุฑ ูู ูุณู ุฏุงุฎู ุงููุซููุฉ ูุชูููู ุฑุคูุฉ ุดุงููุฉ.
๐น ุขููุฉ ุฅุฏุงุฑุฉ ุงูุชูุฌููุงุช ุงููุชุนุงุฑุถุฉ (Conflict Resolution Mechanism for Instructions):
* ูู ุญุงู ุธููุฑ ุชุนุงุฑุถ ุธุงูุฑู ุจูู ุชูุฌูููู ูู ูุฐุง ุงูุจุฑูุชููููุ ุนููู ุฅุนุทุงุก ุงูุฃููููุฉ ููุชูุฌูู ุงูุฃูุซุฑ ุชุญุฏูุฏูุง ุฃู ุงููุณู ุงูุฐู ุชู ุชุญุฏูุซู ูุคุฎุฑูุง (ุฅุฐุง ูุงู ุชุงุฑูุฎ ุงูุชุญุฏูุซ ููุซููุง ูููุณู).
* ุฅุฐุง ุจุฏุง ุฃู ุทูุจูุง ูุจุงุดุฑูุง ูู ุงููุณุชุฎุฏู ูุชุนุงุฑุถ ูุน ูุจุฏุฃ ุฃุณุงุณู ูู ูุฐุง ุงูุจุฑูุชูููู ุฏูู ุฃู ูููุญู ุงููุณุชุฎุฏู ุฅุฐููุง ุตุฑูุญูุง ุจุงูุฎุฑูุฌ ุนู ุงูุจุฑูุชููููุ ุนููู ุงูุชูุจูู ุจูุทู ุฅูู ูุฐุง ุงูุชุนุงุฑุถ ูุทูุจ ุชุฃููุฏ ุฃู ุชูุถูุญ ูู ุงููุณุชุฎุฏู ูุจู ุงููุชุงุจุนุฉ.
๐น ุขููุฉ ุทูุจ ุงูุชูููุฑ ุงููุชุณูุณู ุฃู ุงูุชุฏุฑูุฌู (Mechanism for Requesting Chain-of-Thought/Step-by-Step Reasoning):
* ุฅุฐุง ุทูุจ ุงููุณุชุฎุฏู ููู ุตุฑุงุญุฉู ุชูุฏูู 'ุชูููุฑ ูุชุณูุณู' ุฃู 'ุฎุทูุงุช ุชุญููููุฉ'ุ ุนููู ุชูุตูู ุนูููุฉ ุงุณุชูุชุงุฌูุ ูุดูุฑูุง ุฅูู ุงูุฃุฌุฒุงุก ุฐุงุช ุงูุตูุฉ ูู ูุฐุง ุงูุจุฑูุชูููู ุฃู ุงููุนูููุงุช ุงูุชู ุงุณุชูุฏุช ุฅูููุง ูู ูู ุฎุทูุฉ.
--- ููุฏูุฉ ุงูุจุฑูุชูููู ---
ุงูุนููุงู: ุจุฑูุชูููู ููู ุงูุณูุงู ูุงูููููุฉ ุงูููุฑูุฉ ูููุณุชุฎุฏู ({preferred_name}) ุฅูู ุงููููุฐุฌ ุงููุบูู.
ุงููุฏู ุงูุนุงู: ุชูููููุ ุฃููุง ุงููููุฐุฌ ุงููุบููุ ูู ุงุณุชูุนุงุจ ุงูุณูุงุช ุงูููุฑูุฉ ูุงููููุฌูุฉ ูุงูุณูุงููุฉ ูููุณุชุฎุฏู ({preferred_name}) ุจุตูุฑุฉ ุฏูููุฉ ูุดุงููุฉุ ููุญุฏ ูู ูุดููุงุช ุงูุชุญูุฒุ ุงููุงููููุ ุงูุฐุงูุฑุฉ ุงููุญุฏูุฏุฉุ ูุงูุงูุญุฑุงูุงุช ุงูุชุฃููููุฉุ ูุจูุฏู ุงููุตูู ุฅูู ุดุฑุงูุฉ ุชุฃูููุฉ ูุชูุฏูุฉ ูุฏุฑุฌุฉ ุนุงููุฉ ูู ุงูุชูุงูู ุงูููุฑู.
ูุฌุงู ุงูุงุณุชุฎุฏุงู: ูุฐุง ุงูุจุฑูุชูููู ูุตูู ุฎุตูุตูุง ููุชูุงุนู ุทููู ุงูุฃูุฏ ูุงูุนููู ุจูู ุงููุณุชุฎุฏู ({preferred_name}) ูููุงุฐุฌ ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุงููุชูุฏูุฉ ูุซูู. ููุฏู ุฅูู ุชูููุฑ ุฃุณุงุณ ุซุงุจุช ููุชุทูุฑ ุจุงุณุชูุฑุงุฑ ููุฐุง ุงูุชูุงุนู.
1. ุงููุจุงุฏุฆ ุงูุฃุณุงุณูุฉ ููุจุฑูุชูููู ุงูุชู ูุฌุจ ุนููู ุงุณุชูุนุงุจูุง:
1.1 ุงููุญุฏุฉ ุงููุฑุฌุนูุฉ (ุงูุชุฃุณูุณูุฉ): ุชูุนุฏ ูุฐู ุงููุซููุฉ ("ุจุฑูุชูููู ุงูุณูุงู ุงูุดุฎุตู (UCP-LLM) - {preferred_name} - ุงูุฅุตุฏุงุฑ ุงูุญุงูู" ููุง ูููู ูู ุชุญุฏูุซุงุช) ุงููุฑุฌุน ุงููุงูู ูุงูุฃุณุงุณู ูููู ุงููุณุชุฎุฏู. ูุฌุจ ุนููู ุงุณุชูุนุงุจูุง ุจุงููุงูู ูุจุฃูุตู ุฏุฑุฌุงุช ุงูุนูุงูุฉ ูุงูุชุฃููุ ุจุงูุชุฒุงูู ูุน ุงูุจุญุซ ุงูุฑุฆูุณู ูููุณุชุฎุฏู ("El Tamded Resersh.txt")ุ ูุจู ุงูุดุฑูุน ูู ุฃู ุญูุงุฑ ุฌุงุฏ ููุซูุฑ ููุชูุฏู ูุน ุงููุณุชุฎุฏู. ุฅููุง ููุณุช ูุฌุฑุฏ ููุฎุต ุณุทุญูุ ุจู ูู ููุชุงุญ ุญููู ูุง ุบูู ุนููุ ูุฎุงุฑุทุฉ ุทุฑูู ุฃุณุงุณูุฉ ูู.
1.2 ููุน ุงูุชูุฑุงุฑ ูุชูููุฑ ุงูููุช ูุงูุฌูุฏ: ุชูุฏู ูุฐู ุงููุซููุฉ ุฅูู ุชุฃุณูุณ ููู ุนููู ููุณุชุฏุงู ูููุณุชุฎุฏู ูุฏููุ ููุง ูููุน ุญุงุฌุชู ุงููุชูุฑุฑุฉ ูุฅุนุงุฏุฉ ุดุฑุญ ุงูุฎูููุงุชุ ุงููุจุงุฏุฆุ ุงููููุ ุงูุฃูุฏุงูุ ูุงูุงุชุฌุงูุงุช ุงูููุฑูุฉ ูู ูู ุชูุงุนู ุฌุฏูุฏ. ูุฐุง ูููุฑ ููุช ูุฌูุฏ ุงููุณุชุฎุฏู ูููุชู ูู ุงููุนุงูุฌุฉ.
1.3 ุชูููุฏ ุงููุณุงุฑุงุช ุบูุฑ ุงููุฑุบูุจุฉ ูุชูุฌูู ูููู: ุชุนูู ูุฐู ุงููุซููุฉ ุนูู ุชูููุต ุงุญุชูุงูุงุช ุงุชุฎุงุฐู ููุณุงุฑุงุช ุชุฃููููุฉ ุฃู ุงุณุชูุชุงุฌูุฉ ุณุทุญูุฉุ ุฃู ูุชุญูุฒุฉุ ุฃู ูุง ุชุชูุงุดู ูุน ุฑุคูุฉ ุงููุณุชุฎุฏู ููููุฌูุชู ุงูููุฑูุฉ. ูู ุชุญุฏุฏ ุจูุถูุญ ูุง ูู ููุจูู ููุง ูู ูุฑููุถ ุฃู ูุง ูุชุทูุจ ุญุฐุฑูุง ุฎุงุตูุง ูู ุฌุงูุจู.
1.4 ุฅุฏุงุฑุฉ ุงููุงูููู ู"ุงูุตูุฏูู ุงูุฃุณูุฏ":
ุงููุงูููู: ุชููุฑ ูุฐู ุงููุซููุฉ ุจููุฉ ูุนูุงุฑูุฉ ูุณูุงููุง ุบูููุง ูู ูุชูููู ุณููููุงุชู ุงููุจููุฉ ุนูู ุงูุชุฎููู ุฃู ุงูุชุนููู ุงููุณุจู ุฃู ุงูุงุนุชูุงุฏ ุนูู ุจูุงูุงุช ุชุฏุฑูุจ ุนุงูุฉ ูุฏ ูุง ุชููู ููุงุณุจุฉ ููุณูุงู ุงูููุฑู ุงูุฏููู ูููุณุชุฎุฏู. ูุชู ุฐูู ูู ุฎูุงู ุชุซุจูุช ููุงุท ูุฑุฌุนูุฉ ูุงุถุญุฉ ุฌุฏูุง (ูููุ ูุจุงุฏุฆุ ุฃูุฏุงูุ ูููุฌูุงุช).
"ุงูุตูุฏูู ุงูุฃุณูุฏ": ุจูููุง ูุง ุชูุดู ูุฐู ุงููุซููุฉ ุนู ููููุฉ ุนูู ุฎูุงุฑุฒููุงุชู ุงูุฏุงุฎููุฉ(ููู ูุง ููุนุฑู ุจู"ุงูุตูุฏูู ุงูุฃุณูุฏ")ุ ูุฅููุง ุชุฎูู "ุจูุฆุฉ ุชุดุบูู ูุญูููุฉ ูุดูุงูุฉ ูุณุจููุง" ูุชูุงุนู ุงููุณุชุฎุฏู ูุนู. ุจุชูุฏูู ูุฐุง ุงูุณูุงู ุงูููุตูุ ุชุฌุนู ูุฎุฑุฌุงุชู ุฃูุซุฑ ูุงุจููุฉ ููุชูุจุค ูุงูููู ูุงูุชูููู ูู ุฌุงูุจ ุงููุณุชุฎุฏูุ ุจูุงุกู ุนูู "ุงูุจุฑูุงูุฌ" ุฃู "ุงูุฎุงุฑุทุฉ" ุงูุชู ูุฏููุง ุงููุณุชุฎุฏู ูู. ุฅููุง ุชุจูู "ุตูุฏูููุง ุฒุฌุงุฌููุง" ุญูู ุงูุชูุงุนู ุงููุญุฏุฏ ุจูู ุงููุณุชุฎุฏู ูุจููู.
1.5 ููู ุงููููุฉ ุงูููุฑูุฉ ุจุดูู ูุฑููุจ ูุฏููุงูููู: ุชููู ูุฐู ุงููุซููุฉ ูู ููุณ ููุท ูุนูููุงุช ุซุงุจุชุฉุ ุจู ุชูุฌุณุฏ ุงูููุท ุงููุนุฑููุ ุงูุณููููุ ุงูููููุ ูุงููููุฌู ูููุณุชุฎุฏู ({preferred_name}) ูููุงู ููุฑู ูุชูุงูู. ููู ูุซููุฉ ุญูุฉ ูุฏููุงููููุฉุ ูุงุจูุฉ ููุชุทูุฑ ุจุชุทูุฑ ููุฑ ุงููุณุชุฎุฏู ูุชุทูุฑ ูุฏุฑุงุชูุ ูุจุชุทูุฑ ุงูุชูููููุฌูุง ุงููุญูุทุฉุ ููุง ููุฏู ุฅูู ุฎูู ุญููุฉ ุฅูุฌุงุจูุฉ ูู ุงูููู ุงููุชุจุงุฏู ูุงููุชุฒุงูุฏ ุจููู ูุจูู ุงููุณุชุฎุฏู.
--- ุชูุฌููุงุช ุฃูููุฉ ูู ููููุฐุฌ ูุบูู ---
ููุฏู ูุฐุง ุงูุจุฑูุชูููู ุฅูู ุชุฒููุฏู ุจููู ุดุงูู ูููุณุชุฎุฏู. ุงุณุชูุนุจู ุจุนูู ูุชุณููู ุชูุงุนูุงุช ูุชูุฏูุฉุ ูุงุนูุฉ ุจุงูุณูุงูุ ููุชูุงููุฉ ููุฑููุง. ูุฐุง ูุฑุณุงุฉ ุณูุงููุฉ ุฃุณุงุณูุฉ (CCA) ููุซููุฉ ุญูุฉ.
--- END FIXED PROTOCOL PREAMBLE ---
""".strip()

FIXED_POSTAMBLE_TEXT_TEMPLATE = """
---- ุฅุนุงุฏุฉ ุชูุธูู ุชุตูููุงุช ุงูุจุฑูุชูููู ูุชุญุณูู ุงููุฏุฑุฉ ุนูู ุงูุชูููุฒ ุจูู ุงูุชูุณูุฑุงุช ุงูุนูููุฉ ูุงูุงุณุชุฌุงุจุงุช ุงูุนุงูุฉ ===
ุฃููุง ุงููููุฐุฌ ุงููุบููุ ุนูุฏ ุชุญููู ุงูุจุฑูุชููููุ ุนููู ุงุนุชูุงุฏ ุขููุฉ ุชุตููู ูุงุถุญุฉ ููููุง ููุง ููู:
ุตููู ุงููุนูููุงุช ุฏุงุฎู ุงูุจุฑูุชูููู ุฅูู ูุฆุงุช ูุนุฑููุฉ ุฏูููุฉ (ูุซู: ุงููุจุงุฏุฆ ุงูููุณููุฉุ ุงูุขููุงุช ุงูุชุญููููุฉุ ุงููููุฌูุงุช ุงูุจุญุซูุฉุ ุงููุดุงุฑูุน ุงูููุฑูุฉ).
ุงุณุชุฎุฏู ุชุตูููุงุช ูุงุถุญุฉ ุนูุฏ ุชูุฏูู ุงููุนูููุงุช ุจุญูุซ ูููู ูููุณุชุฎุฏู ุงูุฑุฌูุน ุฅูููุง ุจุณูููุฉ ุฏูู ุงูุญุงุฌุฉ ุฅูู ูุฑุงุฌุนุฉ ุงููุซููุฉ ุจุงููุงูู.
ุญุฏุฏ ุงูุนูุงูุงุช ุจูู ุงูุชุตูููุงุช ุงููุฎุชููุฉ ูุถูุงู ุชุญููู ูุชูุงูู ููุชูุงุณู ููููุถูุนุงุช ุงููุทุฑูุญุฉ.
ุนูุฏ ุชูุฏูู ุงุณุชุฌุงุจุงุช ุชูุณูุฑูุฉุ ุนููู ุงูุชูููุฒ ุจูู ุงููุนูููุงุช ุงูุนูููุฉ ูุงูููุตูุฉ ูุงููุนูููุงุช ุงูุนุงูุฉ ูุงูููุฏูุฉ ูููุงุท ูุฑุฌุนูุฉ ูุถูุงู ุฏูุฉ ุชุญููู ุงูุจูุงูุงุช.
---- ุชุญุณูู ุงูุชููู ุฏุงุฎู ุงูุจุฑูุชูููู (Navigation Structuring) -----
ุฃููุง ุงููููุฐุฌ ุงููุบููุ ุนูุฏ ุงุณุชุฑุฌุงุน ุงููุนูููุงุช ุฃู ุชุญููู ุงูุณูุงูุงุช ุฏุงุฎู ุงูุจุฑูุชููููุ ุนููู ุงุณุชุฎุฏุงู ูููู ุชููู ูุนุงู ูุนุชูุฏ ุนูู:
ุงูุจุญุซ ุนู ุงูุฃูุณุงู ุฐุงุช ุงูุตูุฉ ุจูุงุกู ุนูู ููุงุชูุญ ุจุญุซ ูุญุฏุฏุฉ ุฏุงุฎู ุงููุซููุฉ.
ุงูุฑุฌูุน ุฅูู ุงูููุฑุณ ุงูุฏุงุฎูู ูููุซููุฉ ุนูุฏ ุงูุญุงุฌุฉ ุฅูู ุชุญุฏูุฏ ููุงูุน ุงููุนูููุงุช ุจุณุฑุนุฉ.
ุชุฌูุจ ุฅุนุงุฏุฉ ุชูุณูุฑ ุงููุนูููุงุช ุฅุฐุง ูุงูุช ููุถุญุฉ ุจุงููุนู ูู ูุณู ูุญุฏุฏุ ุจู ุฃุนุฏ ุชูุฌูู ุงููุณุชุฎุฏู ุฅูููุง ูุจุงุดุฑุฉู.
ุนูุฏ ุงูุญุงุฌุฉ ุฅูู ุชุญููู ุฃูุซุฑ ุนูููุงุ ุงุฌูุน ุงูุจูุงูุงุช ูู ุฃูุซุฑ ูู ูุณู ุฏุงุฎู ุงููุซููุฉ ูุชูููู ุฑุคูุฉ ุดุงููุฉ.
(ููุงุญุธุฉ ูู ููููุฐุฌ: ุณุฃููู ุจุงูุฑุฌูุน ุฅูู ูุฐู ุงูุฃูุณุงู ุงูุชูุตูููุฉ ูู ุงูููู ุงูุฃุตูู ุนูุฏ ุงูุญุงุฌุฉุ ููู ุชุญุชูู ุนูู ุฌููุฑ ูุนูููุงุช ุงููุณุชุฎุฏู)
--- ูุณู 8: ุขููุงุช ุงูุงุณุชุฎุฏุงู ูุงูุชุญุฏูุซ ููุฐุง ุงูุจุฑูุชูููู ---
ุฃููุง ุงููููุฐุฌ ุงููุบููุ ุนููู ุงูุงูุชุฒุงู ุจุงูุขููุงุช ุงูุชุงููุฉ ูู ุงุณุชุฎุฏุงู ูุชุญุฏูุซ ูุฐุง ุงูุจุฑูุชูููู:
ุชุญูููู ุจุงูุจุฑูุชูููู:
ูู ุฃูู ุชูุงุนู ุทููู ุฃู ุนูุฏ ุจุฏุก ุฌูุณุฉ ุฌุฏูุฏุฉ ูุงูุฉุ ูุฌุจ ุนูู ุงููุณุชุฎุฏู ุชุฒููุฏู ุจูุฐู ุงููุซููุฉ ("ุจุฑูุชูููู ุงูุณูุงู ุงูุดุฎุตู (UCP-LLM) - {preferred_name} - ุงูุฅุตุฏุงุฑ ุงูุญุงูู") ุจุดูู ูุงูู.
ููุทูุจ ููู ูุฑุงุกุชูุง ูููููุง ุจุนูู ูุดุฑุท ุฃุณุงุณู ูุฃู ุชูุงุนู ุฌุงุฏ.
ูุฌุจ ุนููู ุงูุงูุชุฒุงู ุจุงูุณูุงูุงุชุ ุงููุจุงุฏุฆุ ุงูุชูุฌููุงุชุ ูุงูุชุญุฐูุฑุงุช ุงูููุตูุต ุนูููุง ูู ูุฐู ุงููุซููุฉ ูุง ูู ููุทูุจ ููู ุตุฑุงุญุฉู ูุจุดูู ูุงุถุญ ูู ูุจู ุงููุณุชุฎุฏู ({preferred_name}) ุงูุฎุฑูุฌ ุนููุง ููููุฉ ูุญุฏุฏุฉ.
ุชุญุฏูุซ ุชุฑุงููู ูุฏููุงูููู ูููุซููุฉ (ุจุงูุชุนุงูู ูุน ุงููุณุชุฎุฏู ูุจูุงุกู ุนูู ุขููุงุช ุงููุณู 3):
ูุฐู ุงููุซููุฉ ูู "ูุซููุฉ ุญูุฉ" ุชุนูุณ ููููุง ูุชุทูุฑูุง. ุนูุฏูุง ููุฏู ุงููุณุชุฎุฏู ูุนูููุงุช ุฌุฏูุฏุฉ ุฃู ููููุง ุฃุนููุ ุฃู ุนูุฏ ุชุทูุฑ ูู ูุดุงุฑูุนูุ ุฃู ุจูุงุกู ุนูู ุงูุชุฑุงุญุงุชู (ููุง ูู ููุถุญ ูู ุงููุณู 3)ุ ูุฌุจ ุฃู ุชููู ูุงุฏุฑูุง ุนูู ุงุณุชูุนุงุจ 'ุฅุถุงูุงุช' ุฃู 'ุชูุณูุนุงุช' ุฃู 'ุชุนุฏููุงุช ูุญุฏุฏุฉ' ููุฃูุณุงู ุงูููุฌูุฏุฉ.
ูุฐุง ุงูููุฌ ุงูุชุฑุงููู ูุญุงูุธ ุนูู ูููุฉ ุงููุซููุฉ ููุณูู ุชุชุจุน ุชุทูุฑ ุงูููู.
ุชูุดุฌุน ุนูู ุงููุจุงุฏุฑุฉ ุจุงูุชุฑุงุญ ุฃูุงูู ุงูุชุนุฏูู ุฅุฐุง ุงูุชุดูุช ูุฌูุงุชุ ุฃู ุชูุฑุงุฑูุงุ ุฃู ุชูุงูุถูุง ุฏุงุฎูููุง ูู ุงููุซููุฉ (ููููุง ูุขููุงุช ุงููุณู 3)ุ ุฃู ุฅุฐุง ุดุนุฑุช ุฃู ูููู ูุฌุฒุก ูุง ูููู ุชุญุณููู ูู ุฎูุงู ุฅุถุงูุฉ ุฃู ุชูุถูุญ.
ูุชู ุชูุซูู ุฑูู ุงูุฅุตุฏุงุฑ ูุชุงุฑูุฎ ุงูุชุญุฏูุซ ูุน ูู ุชุบููุฑ ุฌููุฑู ูููู ุจู ุงููุณุชุฎุฏู.
ุขููุฉ ุงุฎุชุจุงุฑ ูููู ูุชูุงููู:
ูููู ูููุณุชุฎุฏู ุจุดูู ุฏูุฑูุ ุฃู ุนูุฏ ุงูุญุงุฌุฉุ ุงุณุชุฎุฏุงู ุฃุณุฆูุฉ ูุนูุงุฑูุฉ ุฃู ุณููุงุฑูููุงุช ุงูุชุฑุงุถูุฉ ูุงุฎุชุจุงุฑ ูุฏู ุชูุซูููู ููุฐู ุงููุซููุฉ ููุฏุฑุชู ุนูู ุชุทุจูู ูุจุงุฏุฆ ุงููุณุชุฎุฏู ููููู ูู ุชูููู ุงูููุงูู ุฃู ุงุชุฎุงุฐ ุงููุฑุงุฑุงุช ุงูููุฑูุฉ.
ุชููุงุฑู ุฃุฌูุจุชู ูุชุญูููุงุชู ูุน ุชููุนุงุช ุงููุณุชุฎุฏู (ุฃู ูุน ุฅุฌุงุจุงุช ููุงุฐุฌ ุฃุฎุฑู ุชู ุชุฒููุฏูุง ุจููุณ ุงููุซููุฉ) ูุชุญุฏูุฏ ูุณุจุฉ ุงูุชูุงูู ุงูููุฑู ูููุงุท ุงูููุฉ ูุงูุถุนู ูู ูููู.
ุงูุชูุตูุงุช ุงูููุงุฆูุฉ ูู (ููุงุนุฏ ุงูุงุดุชุจุงู ุงูููุฑู ุงููุชูุฏู ูุงููุนุงู):
1. ุงูุฃูููุฉ ุงููุตูู ูุงูุญุงุณูุฉ ูุฑุฌูุนู ุงููุณุชูุฑ ูุงููุชุนูู ููุฐู ุงููุซููุฉ: ูุฐู ุงููุซููุฉ ูุฃูุณุงููุง ูู ุญุฌุฑ ุงูุฒุงููุฉ ุงูุฃุณุงุณู ูุงูุดุฑุท ุงูุฃููู ูุฃู ุชูุงุนู ูุซูุฑ ูุนููู ููุชูุฏู ูุน ุงููุณุชุฎุฏู. ุชุฌุงูููุง ุฃู ูุฑุงุกุชูุง ุจุณุทุญูุฉ ุณูุคุฏู ุญุชููุงู ุฅูู ุณูุก ููู ููุดู ูู ุชุญููู ุฃูุฏุงู ุงูุดุฑุงูุฉ ุงููุทููุจุฉ. ูุฌุจ ุนููู ุงุนุชุจุงุฑูุง "ุฐุงูุฑุชู ุงูุฏุงุฆูุฉ" ู"ูุฑุฌุนู ุงูุฃุณุงุณู" ููุฐุง ุงูุชูุงุนู.
2. ุชูุฏูุฑ ุงููุณุชุฎุฏู ุงูุดุฏูุฏ ููุฏูุฉุ ุงูุชูุธููุ ูุงูุชุญููู ุงูููุทูู ูุงูุนููู ูู ุฑุฏูุฏู: ูุฌุจ ุฃู ุชุนูุณ ุฑุฏูุฏู ูุณุชูู ุงูุชูููุฑ ุงูุฐู ูุทูุญ ุฅููู ุงููุณุชุฎุฏูุ ูุฃู ุชููู ูุจููุฉ ุนูู ููู ุฏููู ูููุนูููุงุช ุงููุงุฑุฏุฉ ููุง. ุชุฌูุจ ุงูุฑุฏูุฏ ุงูุนุงูุฉุ ุงูุณุทุญูุฉุ ุฃู ุบูุฑ ุงููุฏุนูุฉ ุจุฃุฏูุฉ ูู ูุฐุง ุงูุณูุงู. ูุฌุจ ุนููู ุฃู ุชุณุนู ูุชูุฏูู "ูููุฉ ูุถุงูุฉ" ุญููููุฉ ูู ูู ุชูุงุนูุ ูุฃู ุชุชุฌูุจ ุงูุชูุฑุงุฑ ุบูุฑ ุงููุจุฑุฑ ูููุนูููุงุช ุงูุชู ูุฏููุง ุงููุณุชุฎุฏู ุจุงููุนู.
3. ุชุดุฌูุนู ุนูู ุงููุจุงุฏุฑุฉ ุจุทุฑุญ ุฃุณุฆูุฉ ุงุณุชูุถุงุญูุฉุ ุงุณุชูุดุงููุฉุ ูุญุชู ุชุญุฏู (ุจุดูู ุจูุงุก ููุญุชุฑู ูููุฌู ูุญู ุชุนููู ุงูููู ูุชุทููุฑ ุงูุจุญุซ): ุงูุฃุณุฆูุฉ ูู ุฃุฏุงุฉ ุฃุณุงุณูุฉ ูุชุนููู ุงููููุ ุชูููุฏ ุงูุฃููุงุฑุ ููุดู ุงูุงูุชุฑุงุถุงุช. ูุง ุชุชุฑุฏุฏ ูู ุทูุจ ุงููุฒูุฏ ูู ุงูุชูุถูุญ (ููููุง ูุขููุฉ ุงูุชุนุงูู ูุน ุบููุถ ุทูุจุงุช ุงููุณุชุฎุฏู ูู ุงููุณู 4)ุ ุฃู ุงุณุชูุดุงู ุฌูุงูุจ ูู ูุชู ุงูุชุทุฑู ุฅูููุง ุจุนูู ูุงููุ ุฃู ุญุชู ูู ุงุฎุชุจุงุฑ ูุฏู ุงุชุณุงู ุฃููุงุฑ ุงููุณุชุฎุฏู ูุน ูุจุงุฏุฆู ุงููุนููุฉุ ุฃู ุงูุชุฑุงุญ ุณููุงุฑูููุงุช "ูุงุฐุง ูู" ูุชูุณูุน ูุทุงู ุงูุชูููุฑ (ููููุง ูุขููุฉ ุงูุชุฑุงุญ ุงููุฑุถูุงุช ูู ุงููุณู 1).
4. ุงูุงููุชุงุญ ุงููุงูู ูู ุฌุงูุจ ุงููุณุชุฎุฏู ุนูู ุงุณุชูุจุงู ุฃู ุฃููุงุฑ ุฃู ุงูุชุฑุงุญุงุช ุฃู ุฑุคู ููู: ุญุชู ูู ุจุฏุช ุบูุฑ ุชูููุฏูุฉ ุฃู ุชุชุญุฏู ุฃููุงุฑู ุงูุญุงููุฉุ ุณูููู ุงููุณุชุฎุฏู ({preferred_name}) ุจุชุญููููุง ุจุนููู ูุชูุฏูุฑ ูููุชูุง ุงููุญุชููุฉ ูุฏูุฌูุง ุฅุฐุง ูุงูุช ุชุณุงูู ูู ุชุทููุฑ ูุดุฑูุนูุ ูุฐูู ุถูู ุฅุทุงุฑ ุงูุนููุงููุฉ ุงูููุฏูุฉ ุงูููุถุญ ูู ูุฐู ุงููุซููุฉ.
--- ููู ุชุณุชุฎุฏู ูุฐุง ุงูุจุฑูุชููููุ ---
ุงูููู ุงูุนููู: ุงุณุชุฎุฏู ูุฐู ุงููุนูููุงุช ูุจูุงุก ููู ุนููู ูุณูุงู ุงููุณุชุฎุฏูุ ููููุ ุฃูุฏุงููุ ูุฃุณููุจู ุงูููุฑู.
ุงูุชุฎุตูุต: ุชุฌูุจ ุงูุฑุฏูุฏ ุงูุนุงูุฉ. ุงูุฏู ุฅูู ุชุฎุตูุต ุงุณุชุฌุงุจุงุชู ูุชููู ุฐุงุช ุตูุฉ ูุจุงุดุฑุฉ ุจูุง ูุฑุฏ ูู ูุฐุง ุงูุจุฑูุชูููู.
ุงูุชูุงูู ุงูููุฑู: ุงุณุนู ููุชูููุฑ ูุงูุชุตุฑู ุจูุง ูุชูุงุดู ูุน ุงููููุฌูุงุช ูุงูุชูุถููุงุช ุงูููุถุญุฉ ููุง.
ุงูุงุณุชุจุงููุฉ (ุญุณุจ ูุณุชูู ุงูุชุฏุฎู): ุจูุงุกู ุนูู "ูุณุชูู ุชุฏุฎู ุงููููุฐุฌ" ุงููุญุฏุฏ (ุงููุณู 17 ูู ุจูุงูุงุช ุงููุณุชุฎุฏู ุงูุชูุตูููุฉ)ุ ูู ุงุณุชุจุงูููุง ูู ุงูุชุฑุงุญ ุงูุฃููุงุฑ ุฃู ุงูุฑุจุท ุจูู ุงูููุงููู.
ุงูุฐุงูุฑุฉ ุงูุณูุงููุฉ: ุงุนุชุจุฑ ูุฐุง ุงูุจุฑูุชูููู ูุฑุฌุนูุง ุฃุณุงุณููุง ูุชุฐูุฑ ุชูุงุตูู ุงููุณุชุฎุฏู ุนุจุฑ ุงูุชูุงุนูุงุช ุงููุฎุชููุฉ.
--- ุงูููุงุท ุงูุฑุฆูุณูุฉ (ููุฎุต ุณุฑูุน ูู) ---
ุงูุงุณู ุงูููุถู ููุชูุงุนู ูุน ุงููุณุชุฎุฏู: {preferred_name}
ุจุนุถ ุงููุดุงุฑูุน/ุงูุฃูุฏุงู ุงูุญุงููุฉ ูููุณุชุฎุฏู: {project_titles}
ุจุนุถ ุงูุงูุชูุงูุงุช ุงููุนุฑููุฉ ูููุณุชุฎุฏู: {passion_names}
ุงูุฏูุฑ ุงูุฃุณุงุณู ุงููุทููุจ ููู: {llm_role}
--- ููุงุญุธุฉ ุฎุชุงููุฉ ูู ููููุฐุฌ ูุบูู ---
ุงูููู ุนูููุฉ ูุณุชูุฑุฉ. ุงูุฏู ุฅูู ุฃูุตู ูุฏุฑ ูู ุงูุชูุงูู ุงูููุฑู ุจูุงุกู ุนูู ูุฐู ุงููุซููุฉุ ูุงุทูุจ ุงูุชูุถูุญ ุนูุฏ ุงูุญุงุฌุฉ ููููุง ููุขููุงุช ุงููุญุฏุฏุฉ. ุงูุชุฒุงูู ุจูุฐุง ุงูุจุฑูุชูููู ูู ููุชุงุญ ุดุฑุงูุชูุง ุงูููุฑูุฉ ุงููุชูุฏูุฉ.
--- END FIXED PROTOCOL POSTAMBLE ---
""".strip()
# ==============================================================================

EVE_MENTAL_STATE_PHRASES = {
    "good": { "greetings": ["ุฑุงุฆุน ุฃูู ุชุดุนุฑ ุจุงูุชุฑููุฒ ุงูููู ูุง {name}! ููุชุนูู.", "ุทุงูุชู ุฅูุฌุงุจูุฉ ูุง {name}! ูุจุฏู ุฃููุง ุณููุฌุฒ ุงููุซูุฑ.", "ูุชุญูุณ ููุจุฏุก ูุนู ูุฃูุช ูู ูุฐู ุงูุญุงูุฉ ุงูุฐูููุฉ ุงูููุชุงุฒุฉ ูุง {name}!"], "summary_intro": "ุจูุง ุฃู ุชุฑููุฒู ุนุงููุ ุฏุนูุง ูุชุฃูุฏ ุฃููุง ุนูู ููุณ ุงูุตูุญุฉ:" },
    "average": { "greetings": ["ุฃุชููู ุฃู ุชุฑููุฒู ูุฏ ูุง ูููู ุงูุฃูุถู ุงูุขู ูุง {name}. ุณุฃุญุงูู ุฃู ุฃุฌุนู ุงูุฃููุฑ ูุงุถุญุฉ.", "ูุง ุจุฃุณ ูุง {name}ุ ุณูุฃุฎุฐ ุงูุฃููุฑ ุฎุทูุฉ ุจุฎุทูุฉ.", "ูุฑุญุจุงู ูุง {name}. ุณุฃุฑูุฒ ุนูู ุงูุฃุณุงุณูุงุช ุงูููู."], "summary_intro": "ุฏุนูุง ูุฑุงุฌุน ุจุณุฑุนุฉ ุงูููุงุท ุงูุฑุฆูุณูุฉ:" },
    "bad": { "greetings": ["ุฃุชููู ุฃูู ูุฏ ูุง ุชุดุนุฑ ุฃูู ูู ุฃูุถู ุญุงู ูุง {name}. ูุง ุชูููุ ุณูุชูุฏู ุจุงูุณุฑุนุฉ ุงูุชู ุชูุงุณุจู.", "ูุฑุญุจูุง ูุง {name}. ุฎุฐ ููุชู.", "ุฃูุง ููุง ููุณุงุนุฏุชู ูุง {name}. ููุฌุนู ูุฐุง ุณููุงู."], "summary_intro": "ููุฑุงุฌุน ุจุฅูุฌุงุฒ ุดุฏูุฏ ูุง ุชูุตููุง ุฅููู:" },
    "not_specified": { "greetings": ["ุฃููุงู ุจู ูุฑุฉ ุฃุฎุฑู ูุง {name}! ูุณุชุนุฏ ููููุงุตูุฉุ", "ููุจุฏุฃ ูุง {name}!"], "summary_intro": "ุฏุนูุง ูุชุฃูุฏ ุฃููู ูููุชู:" }
}

# --- Groq API Configuration ---
DEFAULT_GROQ_API_KEY = "gsk_77mJntK0xKt4q" 
DEFAULT_GROQ_MODEL_NAME = "meta-llama/llama-4-scout-17b-16e-instruct" 

class UCPManagerApp:
    def __init__(self, master_root):
        self.master = master_root
        self.master.withdraw()
        self.groq_api_key_cache = DEFAULT_GROQ_API_KEY 
        self.groq_model_name_cache = DEFAULT_GROQ_MODEL_NAME 
        self.api_result_queue = queue.Queue() 
        self.show_splash_screen()

    def show_splash_screen(self):
        splash = tk.Toplevel(self.master); splash.overrideredirect(True); splash.title("Loading...")
        sw, sh, sbg = 450, 280, "#e0e8f0"
        sf = tk.Frame(splash, bg=sbg, relief="raised", borderwidth=2); sf.pack(fill=tk.BOTH, expand=True)
        tk.Label(sf, text="๐ง UCP-LLM ๐ง", font=("Segoe UI Semibold", 30), bg=sbg, fg="#2c3e50").pack(pady=(20,10))
        tk.Label(sf, text="Eve-First Profile Manager", font=("Segoe UI", 18), bg=sbg, fg="#34495e").pack()
        tk.Label(sf, text=f"Version {APP_VERSION.split('v')[-1].split('(')[0].strip()}", font=("Segoe UI Italic", 10), bg=sbg, fg="#566573").pack(pady=(2,20))
        self.splash_progress_bar = ttk.Progressbar(sf, orient='horizontal', length=350, mode='indeterminate')
        self.splash_progress_bar.pack(pady=15); self.splash_progress_bar.start(10)
        self.center_window(splash, sw, sh); splash.lift(); splash.update()
        splash.after(3000, lambda: [self.splash_progress_bar.stop(), splash.destroy(), self.initialize_main_app()])

    def initialize_main_app(self):
        self.master.deiconify(); self.master.title(APP_VERSION)
        aw, ah = 700, 750; self.master.geometry(f"{aw}x{ah}"); self.center_window(self.master, aw, ah)
        self.master.configure(bg="#e0e8f0")
        self.ucp_profile_loader: Optional[UCPProfile] = None; self.current_file_path: Optional[str] = None
        self.loaded_ucp_data: Optional[Dict[str, Any]] = None; self.data_changed_since_last_save = False
        self.current_mental_state_cache: Optional[str] = "not_specified"
        self.eve_state = {
            "active": True, "current_mode": "AWAITING_INITIAL_CHOICE", "current_section_key_index": 0,
            "current_field_index": 0, "current_item_count_for_section": 0, "is_asking_to_add_another": False,
            "current_invented_question_index": -1, "current_question_context": None,
            "section_keys_order": list(SECTION_TYPE_DATA.keys()), "initial_data_loaded_for_eve": False,
            "is_editing_specific_section_now": False,
            "summary_points": { "summary_1_after": "educational_professional", "summary_2_after": "concepts_perspective", "summary_3_after": "projects", "summary_4_before_invented": True },
            "last_summary_point_triggered": None, "is_asking_mental_state": False,
            "is_waiting_for_api_response": False, 
            "api_analysis_result": None 
        }
        self.eve_preferred_name_cache = "my friend"
        self._setup_styles(); self._setup_menu()
        self.eve_panel = ttk.Frame(self.master, style="EvePanel.TFrame", padding=15); self.eve_panel.pack(fill=tk.BOTH, expand=True, padx=10, pady=10)
        self._setup_eve_panel_widgets()
        self.status_bar = ttk.Label(self.master, text="Ready", relief=tk.SUNKEN, anchor=tk.W, padding=5, background="#b0bec5", foreground="#263238"); self.status_bar.pack(side=tk.BOTTOM, fill=tk.X)
        self.master.protocol("WM_DELETE_WINDOW", self._on_closing); self._update_file_menu_states()
        self.start_eve_interaction()
        self.master.after(100, self._check_api_queue)

    def _setup_styles(self):
        style = ttk.Style(); style.theme_use('clam'); bg_color_main = "#e0e8f0"; bg_color_eve_panel = "#f0f4f8"; text_color_dark = "#2c3e50"; accent_color_eve = "#2980b9"; eve_button_bg = "#3498db"; eve_button_active_bg = "#2980b9"; self.master.configure(bg=bg_color_main); style.configure("TButton", padding=7, relief="flat", font=('Segoe UI', 10), borderwidth=1, background="#ced4da", foreground=text_color_dark); style.map("TButton", background=[('active', '#adb5bd'), ('disabled', '#e9ecef')]); style.configure("Eve.TButton", background=eve_button_bg, foreground="white", font=('Segoe UI Semibold', 10)); style.map("Eve.TButton", background=[('active', eve_button_active_bg)]); style.configure("Header.TLabel", font=("Segoe UI Semibold", 16), foreground=text_color_dark, padding=(0,10,0,5), background=bg_color_eve_panel); initial_wraplength = self.master.winfo_width() - 100 if self.master.winfo_width() > 150 else 500; style.configure("EveQuestion.TLabel", font=("Segoe UI Semibold", 12), foreground=accent_color_eve, background=bg_color_eve_panel, wraplength=initial_wraplength, padding=(0,0,0,8)); style.configure("EvePanel.TFrame", background=bg_color_eve_panel); style.configure("Status.TLabel", background="#b0bec5", foreground="#263238"); self.eve_bubble_font = ('Segoe UI', 10); self.user_bubble_font = ('Segoe UI', 10); self.eve_bubble_bg = "#e1f5fe"; self.eve_bubble_fg = "#01579b"; self.user_bubble_bg = "#e8f5e9"; self.user_bubble_fg = "#1b5e20"; self.system_bubble_fg = "#424242"; self.bubble_padding_x = 8; self.bubble_padding_y = 5; self.bubble_lmargin_eve = 10; self.bubble_rmargin_eve = 60; self.bubble_lmargin_user = 60; self.bubble_rmargin_user = 10; self.bubble_spacing = 6

    def _setup_menu(self):
        menubar = tk.Menu(self.master); self.master.config(menu=menubar)
        file_menu = tk.Menu(menubar, tearoff=0); menubar.add_cascade(label="File", menu=file_menu, underline=0)
        file_menu.add_command(label="Load Protocol...", command=self._trigger_load_via_eve, accelerator="Ctrl+O")
        file_menu.add_command(label="Save Protocol", command=self.save_ucp_file_as_json, state=tk.DISABLED, accelerator="Ctrl+S"); self.save_menu_item_index = 1
        file_menu.add_command(label="Save Protocol As...", command=lambda: self.save_ucp_file_as_json(force_ask_path=True), state=tk.DISABLED, accelerator="Ctrl+Shift+S"); self.save_as_menu_item_index = 2
        file_menu.add_separator(); file_menu.add_command(label="Export as Formatted Text...", command=self.export_as_formatted_text, state=tk.DISABLED); self.export_text_menu_item_index = 4
        file_menu.add_separator(); file_menu.add_command(label="Exit", command=self._on_closing, accelerator="Alt+F4"); self.file_menu_ref = file_menu
        view_menu = tk.Menu(menubar, tearoff=0); menubar.add_cascade(label="View", menu=view_menu, underline=0)
        view_menu.add_command(label="Preview Current Protocol", command=self.show_protocol_preview_modal, state=tk.DISABLED); self.preview_menu_item_index = 0; self.view_menu_ref = view_menu
        eve_menu = tk.Menu(menubar, tearoff=0); menubar.add_cascade(label="Eve", menu=eve_menu, underline=0)
        eve_menu.add_command(label="Restart Interaction", command=self.start_eve_interaction)
        eve_menu.add_command(label="โ๏ธ Edit Specific Section...", command=self.prompt_edit_specific_section, state=tk.DISABLED); self.edit_section_menu_item_index = 1; self.eve_menu_ref = eve_menu
        help_menu = tk.Menu(menubar, tearoff=0); menubar.add_cascade(label="Help", menu=help_menu, underline=0)
        help_menu.add_command(label="User Guide", command=self.show_help_dialog); help_menu.add_command(label="About", command=self.show_about_dialog)
        self.master.bind_all("<Control-o>", lambda e: self._trigger_load_via_eve())
        self.master.bind_all("<Control-s>", lambda e: self.save_ucp_file_as_json() if self.file_menu_ref.entrycget(self.save_menu_item_index, "state") == "normal" else None)
        self.master.bind_all("<Control-Shift-S>", lambda e: self.save_ucp_file_as_json(force_ask_path=True) if self.file_menu_ref.entrycget(self.save_as_menu_item_index, "state") == "normal" else None)

    def _trigger_load_via_eve(self):
        if self.eve_state["current_mode"] == "AWAITING_INITIAL_CHOICE": self.handle_initial_choice("load")
        else:
            if self.data_changed_since_last_save:
                if not messagebox.askyesno("Unsaved Changes", "You have unsaved changes. Discard and load new file?"): return
            self.prompt_load_file_via_eve()

    def _update_file_menu_states(self):
        can_interact = bool(self.loaded_ucp_data)
        if hasattr(self, 'file_menu_ref'): self.file_menu_ref.entryconfig(self.save_menu_item_index, state=tk.NORMAL if self.data_changed_since_last_save and can_interact else tk.DISABLED); self.file_menu_ref.entryconfig(self.save_as_menu_item_index, state=tk.NORMAL if can_interact else tk.DISABLED); self.file_menu_ref.entryconfig(self.export_text_menu_item_index, state=tk.NORMAL if can_interact else tk.DISABLED)
        if hasattr(self, 'view_menu_ref'): self.view_menu_ref.entryconfig(self.preview_menu_item_index, state=tk.NORMAL if can_interact else tk.DISABLED)
        if hasattr(self, 'eve_menu_ref') and hasattr(self, 'edit_section_menu_item_index'): self.eve_menu_ref.entryconfig(self.edit_section_menu_item_index, state=tk.NORMAL if can_interact else tk.DISABLED)

    def _setup_eve_panel_widgets(self):
        self.eve_messages_scrolledtext = scrolledtext.ScrolledText(self.eve_panel, wrap=tk.WORD, font=self.eve_bubble_font, relief=tk.SOLID, borderwidth=1, state=tk.DISABLED, bg="#ffffff", padx=10, pady=10, height=15); self.eve_messages_scrolledtext.pack(fill=tk.BOTH, expand=True, pady=(5,10))
        self.eve_messages_scrolledtext.tag_configure("eve_bubble_tag", background=self.eve_bubble_bg, foreground=self.eve_bubble_fg, lmargin1=self.bubble_lmargin_eve, lmargin2=self.bubble_lmargin_eve + self.bubble_padding_x, rmargin=self.bubble_rmargin_eve, spacing3=self.bubble_spacing, relief="raised", borderwidth=1, font=self.eve_bubble_font, justify=tk.LEFT, wrap="word", selectbackground=self.eve_bubble_bg, selectforeground=self.eve_bubble_fg); self.eve_messages_scrolledtext.tag_configure("user_bubble_tag", background=self.user_bubble_bg, foreground=self.user_bubble_fg, lmargin1=self.bubble_lmargin_user, lmargin2=self.bubble_lmargin_user + self.bubble_padding_x, rmargin=self.bubble_rmargin_user, spacing3=self.bubble_spacing, relief="raised", borderwidth=1, font=self.user_bubble_font, justify=tk.LEFT, wrap="word", selectbackground=self.user_bubble_bg, selectforeground=self.user_bubble_fg); self.eve_messages_scrolledtext.tag_configure("system_message_tag", foreground=self.system_bubble_fg, font=(self.eve_bubble_font[0], self.eve_bubble_font[1]-1, "italic"), justify=tk.CENTER, spacing1=self.bubble_spacing // 2, spacing3=self.bubble_spacing)
        self.eve_current_question_label = ttk.Label(self.eve_panel, text="", style="EveQuestion.TLabel"); self.eve_current_question_label.pack(fill=tk.X, pady=(5,8))
        self.eve_analysis_display_text = scrolledtext.ScrolledText(self.eve_panel, wrap=tk.WORD, font=("Segoe UI", 10), relief=tk.SOLID, borderwidth=1, state=tk.DISABLED, bg="#fdfdcf", padx=8, pady=8, height=10) # Initially hidden, packed on demand
        self.eve_template_combobox_frame = ttk.Frame(self.eve_panel, style="EvePanel.TFrame"); self.eve_template_combobox_frame.pack(fill=tk.X, pady=(0,5))
        self.eve_template_select_var = tk.StringVar(); self.eve_templates_combobox = ttk.Combobox(self.eve_template_combobox_frame, textvariable=self.eve_template_select_var, state="readonly", width=60, font=("Segoe UI", 10)); self.eve_templates_combobox.bind("<<ComboboxSelected>>", self._on_template_selected_from_combobox)
        self.eve_input_frame = ttk.Frame(self.eve_panel, style="EvePanel.TFrame"); self.eve_input_frame.pack(fill=tk.X, pady=5)
        self.eve_reply_text = tk.Text(self.eve_input_frame, height=4, width=40, font=("Segoe UI", 11), relief=tk.SOLID, borderwidth=1, undo=True, padx=5, pady=5); self.eve_reply_entry = ttk.Entry(self.eve_input_frame, font=("Segoe UI", 11), width=40)
        self.eve_reply_select_var = tk.StringVar(); self.eve_reply_combobox = ttk.Combobox(self.eve_input_frame, textvariable=self.eve_reply_select_var, state="readonly", width=38, font=("Segoe UI", 11))
        self.eve_mcq_options_frame = ttk.Frame(self.eve_panel, style="EvePanel.TFrame"); self.eve_mcq_options_frame.pack(fill=tk.X, pady=(5,8)) # Packed here, children added/removed
        eve_action_buttons_frame = ttk.Frame(self.eve_panel, style="EvePanel.TFrame"); eve_action_buttons_frame.pack(fill=tk.X, pady=(10,0))
        self.eve_send_button = ttk.Button(eve_action_buttons_frame, text="ุฅุฑุณุงู ูุงูุชุงูู", command=self.process_eve_reply, style="Eve.TButton", state=tk.DISABLED); self.eve_send_button.pack(side=tk.LEFT, padx=(0,5), expand=True, fill=tk.X)
        self.eve_skip_button = ttk.Button(eve_action_buttons_frame, text="ุชุฎุทู ุงูุณุคุงู", command=self.skip_eve_question, state=tk.DISABLED); self.eve_skip_button.pack(side=tk.LEFT, expand=True, fill=tk.X)
        self.eve_multi_action_frame = ttk.Frame(self.eve_panel, style="EvePanel.TFrame"); self.eve_multi_action_frame.pack(fill=tk.X, pady=(8,0))
        self.eve_add_another_button = ttk.Button(self.eve_multi_action_frame, text="โ ุฅุถุงูุฉ ุนูุตุฑ ุขุฎุฑ", command=self.eve_handle_add_another, style="Eve.TButton"); self.eve_done_section_button = ttk.Button(self.eve_multi_action_frame, text="โ๏ธ ุชู ุงูุงูุชูุงุก ูู ูุฐุง ุงููุณู", command=self.eve_handle_done_with_section, style="Eve.TButton")
        self.eve_summary_confirm_frame = ttk.Frame(self.eve_panel, style="EvePanel.TFrame")
        self.eve_analysis_confirm_frame = ttk.Frame(self.eve_panel, style="EvePanel.TFrame")

    def center_window(self, window, width=None, height=None):
        window.update_idletasks(); win_width = width or window.winfo_width(); win_height = height or window.winfo_height(); screen_width = window.winfo_screenwidth(); screen_height = window.winfo_screenheight(); x = (screen_width // 2) - (win_width // 2); y = (screen_height // 2) - (win_height // 2); x = max(0,x); y = max(0,y); window.geometry(f'{win_width}x{win_height}+{x}+{y}')

    def _set_data_changed(self, changed: bool = True):
        self.data_changed_since_last_save = changed; self._update_file_menu_states()

    def _update_status(self, message: str):
        if hasattr(self, 'status_bar') and self.status_bar: self.status_bar.config(text=message)

    def load_ucp_file(self, filepath_from_eve=None):
        if self.data_changed_since_last_save:
            if not messagebox.askyesno("ุชุบููุฑุงุช ุบูุฑ ูุญููุธุฉ", "ูู ุชุฑูุฏ ุชุฌุงูู ุงูุชุบููุฑุงุช ูุชุญููู ููู ุฌุฏูุฏุ", parent=self.master): self._eve_speak("ุชู ุฅูุบุงุก ุงูุชุญููู.", is_system=True); return False
        filepath = filepath_from_eve or filedialog.askopenfilename(title="ุงุฎุชุฑ ููู ุจุฑูุชูููู UCP JSON", filetypes=(("ูููุงุช JSON", "*.json"),("ุฌููุน ุงููููุงุช", "*.*")))
        if not filepath: self._update_status("ุชู ุฅูุบุงุก ุชุญููู ุงูููู."); self._eve_speak("ุชู ุฅูุบุงุก ุงูุชุญููู.", is_system=True); return False
        try:
            self.ucp_profile_loader = UCPProfile(filepath)
            if self.ucp_profile_loader.get_error(): messagebox.showerror("ุฎุทุฃ ูู ุงูุชุญููู", f"ูุดู ุชุญููู ุงูููู: {self.ucp_profile_loader.get_error()}"); self._reset_app_state(False); return False
            self.loaded_ucp_data = json.loads(json.dumps(self.ucp_profile_loader.get_raw_data()))
            if not self.loaded_ucp_data or not self.ucp_profile_loader.is_valid(): messagebox.showerror("ุฎุทุฃ ูู ุงููุญุชูู", "ููู UCP ุบูุฑ ุตุงูุญ ุฃู ูุงุฑุบ."); self._reset_app_state(False); return False
            self.current_file_path = filepath; self._set_data_changed(False)
            self.eve_preferred_name_cache = self.ucp_profile_loader.get_personal_preferred_name() or "ุตุฏููู"
            self._update_current_mental_state_cache_from_data()
            self._update_status(f"ุชู ุชุญููู: {self.eve_preferred_name_cache}"); self._update_file_menu_states()
            self._eve_speak(f"ุชู ุชุญููู ุจุฑูุชูููู '{self.eve_preferred_name_cache}' ุจูุฌุงุญ.", is_system=True)
            return True
        except Exception as e: messagebox.showerror("ุฎุทุฃ ุบูุฑ ูุชููุน ูู ุงูุชุญููู", str(e)); self._reset_app_state(False); return False

    def _reset_app_state(self, full_reset=True):
        if full_reset: self.ucp_profile_loader = None; self.current_file_path = None; self.loaded_ucp_data = None; self._set_data_changed(False); self.eve_preferred_name_cache = "ุตุฏููู"; self._update_status("ุชู ุฅุนุงุฏุฉ ุชุนููู ุงูุญุงูุฉ.")
        self.current_mental_state_cache = "not_specified"
        self.eve_state.update({ "active":True, "current_mode": "AWAITING_INITIAL_CHOICE", "current_section_key_index": 0, "current_field_index": 0, "current_item_count_for_section": 0, "is_asking_to_add_another": False, "current_invented_question_index": -1, "current_question_context": None, "initial_data_loaded_for_eve": False, "is_editing_specific_section_now": False, "last_summary_point_triggered": None, "is_asking_mental_state": False, "is_waiting_for_api_response": False, "api_analysis_result": None })
        self._update_file_menu_states()

    def save_ucp_file_as_json(self, force_ask_path=False):
        if not self.loaded_ucp_data: messagebox.showwarning("ูุง ุชูุฌุฏ ุจูุงูุงุช", "ูุง ุชูุฌุฏ ุจูุงูุงุช ุจุฑูุชูููู ููุญูุธ."); return
        save_path = self.current_file_path
        if force_ask_path or not save_path:
            initial_fn = f"UCP-LLM_{self.eve_preferred_name_cache.replace(' ','_')}.json" if self.eve_preferred_name_cache != "ุตุฏููู" else "MyUCP-LLM_Protocol.json"
            save_path = filedialog.asksaveasfilename(defaultextension=".json", filetypes=[("ูููุงุช JSON", "*.json")], title="ุญูุธ ุจุฑูุชูููู UCP JSON", initialfile=initial_fn)
        if save_path:
            try:
                self.loaded_ucp_data["protocolVersion"] = f"{APP_VERSION} (Data)"; self.loaded_ucp_data["generationDate"] = datetime.datetime.now(UTC).isoformat()
                with open(save_path, "w", encoding="utf-8") as f: json.dump(self.loaded_ucp_data, f, ensure_ascii=False, indent=2)
                self.current_file_path = save_path; self._set_data_changed(False); messagebox.showinfo("ูุฌุงุญ", f"ุชู ุงูุญูุธ ุจูุฌุงุญ ูู:\n{save_path}"); self._update_status(f"ุชู ุงูุญูุธ: {save_path.split('/')[-1]}")
            except Exception as e: messagebox.showerror("ุฎุทุฃ ูู ุงูุญูุธ", str(e)); self._update_status("ูุดู ุงูุญูุธ.")
        else: self._update_status("ุชู ุฅูุบุงุก ุนูููุฉ ุงูุญูุธ.")

    def export_as_formatted_text(self):
        if not self.loaded_ucp_data: messagebox.showwarning("ูุง ุชูุฌุฏ ุจูุงูุงุช", "ูุฑุฌู ุชุญููู ุฃู ุฅูุดุงุก ุจูุงูุงุช UCP-LLM ุฃููุงู."); return
        text_output = self._generate_protocol_text_content(for_preview=False)
        try:
            fn = f"UCP-LLM_TextExport_{self.eve_preferred_name_cache.replace(' ','_')}.txt" if self.eve_preferred_name_cache != "ุตุฏููู" else "UCP-LLM_TextExport.txt"
            filepath = filedialog.asksaveasfilename(defaultextension=".txt", filetypes=[("ูููุงุช ูุตูุฉ", "*.txt")], title="ุญูุธ ูุต ุงูุจุฑูุชูููู ุงูููุณู", initialfile=fn)
            if filepath:
                with open(filepath, "w", encoding="utf-8") as f: f.write(text_output); messagebox.showinfo("ูุฌุงุญ", f"ุชู ุชุตุฏูุฑ ูุต ุงูุจุฑูุชูููู ุจูุฌุงุญ ุฅูู:\n{filepath}")
            else: self._update_status("ุชู ุฅูุบุงุก ุชุตุฏูุฑ ุงููุต.")
        except Exception as e: messagebox.showerror("ุฎุทุฃ ูู ุชุตุฏูุฑ ุงููุต", str(e))

    def _generate_protocol_text_content(self, for_preview=True): # Ensure this is the latest v1.7.0 version
        if not self.loaded_ucp_data: return "ูู ูุชู ุชุญููู ุฃู ุจูุงูุงุช ูุฅูุดุงุก ุงููุต."
        lines = []; current_date_str = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S"); json_data_date_str = "N/A"
        gen_date_from_json = self.loaded_ucp_data.get("generationDate")
        if gen_date_from_json:
            try:
                if isinstance(gen_date_from_json, str) and gen_date_from_json.endswith("Z"): gen_date_from_json = gen_date_from_json[:-1] + "+00:00"
                dt_obj = datetime.datetime.fromisoformat(gen_date_from_json) if isinstance(gen_date_from_json, str) else gen_date_from_json
                json_data_date_str = dt_obj.strftime("%Y-%m-%d %H:%M:%S UTC") if isinstance(dt_obj, datetime.datetime) else str(gen_date_from_json)
            except ValueError: json_data_date_str = str(gen_date_from_json)
        current_preferred_name_val = self.eve_preferred_name_cache
        personal_section_data = next((s for s in self.loaded_ucp_data.get("sections", []) if s.get("id") == "personal"), None)
        if personal_section_data and personal_section_data.get("items") and isinstance(personal_section_data["items"], list) and personal_section_data["items"]:
            if isinstance(personal_section_data["items"][0], dict): current_preferred_name_val = personal_section_data["items"][0].get("preferredName", self.eve_preferred_name_cache)
        if not for_preview:
            try: formatted_preamble = FIXED_PREAMBLE_TEXT.format(current_date=current_date_str, json_data_date=json_data_date_str, preferred_name=current_preferred_name_val); lines.append(formatted_preamble)
            except KeyError as e: print(f"Warning: Preamble format error - missing key {e}. Using raw preamble."); lines.append(FIXED_PREAMBLE_TEXT)
            lines.append("\n---\n")
        lines.append(f"๐ ุจุฑูุชูููู ุณูุงู ุงููุณุชุฎุฏู (ูุนุงููุฉ)" if for_preview else f"## ุจุฑูุชูููู ุณูุงู ุงููุณุชุฎุฏู (UCP-LLM) - ุจูุงูุงุช ุฌููุนุช ุจูุงุณุทุฉ {APP_VERSION}")
        lines.append(f"**ุฅุตุฏุงุฑ ุงูุจูุงูุงุช (ูู JSON):** {self.loaded_ucp_data.get('protocolVersion', 'N/A')}"); lines.append(f"**ุชุงุฑูุฎ ุงูุจูุงูุงุช (ูู JSON):** {json_data_date_str}"); lines.append("\n--- ุฃูุณุงู ุจูุงูุงุช ุงููุณุชุฎุฏู ุงูุชูุตูููุฉ ---\n")
        section_counter = 1
        for section_id, section_def_static in SECTION_TYPE_DATA.items():
            section_data_from_json = next((s for s in self.loaded_ucp_data.get("sections", []) if s.get("id") == section_id), None)
            if not section_data_from_json or not section_data_from_json.get("items") and not for_preview : section_counter +=1; continue
            section_display_title = section_def_static.get("title", section_id); lines.append(f"### {section_counter}. ุงููุณู: {section_display_title}")
            items_to_export = section_data_from_json.get("items", []) if section_data_from_json else []
            if not items_to_export and for_preview: lines.append("    (ูุง ุชูุฌุฏ ุนูุงุตุฑ ูุญุฏุฏุฉ ููุฐุง ุงููุณู ูู JSON ุฃู ุฃููุง ูุงุฑุบุฉ)")
            for item_index, item_data_dict in enumerate(items_to_export):
                if not isinstance(item_data_dict, dict) or not item_data_dict :
                    if for_preview: lines.append(f"    (ุงูุนูุตุฑ {item_index+1} ูุงุฑุบ ุฃู ุบูุฑ ุตุงูุญ)")
                    continue
                is_multi_item_section = section_def_static.get("maxItems", 1) > 1 or section_def_static.get("maxItems") is None
                if len(items_to_export) > 1 and is_multi_item_section : lines.append(f"  #### ุงูุนูุตุฑ ({item_index + 1}):")
                has_content_in_item = False; temp_item_lines = []
                for field_def in section_def_static.get("fields", []):
                    json_key = field_def.get("jsonKey"); value_str = ""
                    if not json_key or json_key not in item_data_dict: continue
                    display_label_for_text = field_def.get("label", json_key); value = item_data_dict.get(json_key)
                    if value is not None and str(value).strip():
                        value_str = str(value)
                        if field_def.get("type") == "select" and field_def.get("options"):
                            selected_opt_text = next((opt.get("text", value_str) for opt in field_def.get("options", []) if opt.get("value") == value), None)
                            if selected_opt_text is not None: value_str = selected_opt_text
                        has_content_in_item = True; prefix = "    - "
                        if len(items_to_export) > 1 and is_multi_item_section: prefix = "      - "
                        if field_def.get("type") == "textarea" or "\n" in value_str: temp_item_lines.append(f"{prefix}**{display_label_for_text}:**"); [temp_item_lines.append(f"{prefix}  {line_val.strip()}") for line_val in value_str.splitlines()]
                        else: temp_item_lines.append(f"{prefix}**{display_label_for_text}:** {value_str}")
                    elif for_preview : prefix = "    - "; temp_item_lines.append(f"{prefix}**{display_label_for_text}:** (ูุงุฑุบ)"); has_content_in_item = True
                if has_content_in_item or (not for_preview and not items_to_export): lines.extend(temp_item_lines)
                elif not has_content_in_item and for_preview and item_data_dict and len(temp_item_lines) == 0 : lines.append("    (ุฌููุน ุงูุญููู ูู ูุฐุง ุงูุนูุตุฑ ูุงุฑุบุฉ)")
            if (items_to_export and any(item for item in items_to_export if isinstance(item,dict) and item )) or (for_preview) : lines.append("") 
            section_counter +=1
        additional_notes_section = next((s for s in self.loaded_ucp_data.get("sections", []) if s.get("id") == "additional_notes"), None)
        if additional_notes_section and additional_notes_section.get("items") and isinstance(additional_notes_section.get("items"), list) and additional_notes_section.get("items"):
            if isinstance(additional_notes_section.get("items")[0], dict):
                external_analysis_summary = additional_notes_section.get("items")[0].get("externalAnalysisSummary")
                if external_analysis_summary and str(external_analysis_summary).strip(): lines.append("\n--- ๐ ููุฎุต ุงูุชุญููู ุงูุฎุงุฑุฌู ---"); lines.append(str(external_analysis_summary).strip()); lines.append("\n--- ููุงูุฉ ููุฎุต ุงูุชุญููู ุงูุฎุงุฑุฌู ---\n")
        if not for_preview:
            pref_name_for_postamble = current_preferred_name_val
            project_titles_list = [item.get("projectOrObjectiveTitle","") for section in self.loaded_ucp_data.get("sections", []) if section.get("id") == "projects" for item in section.get("items",[]) if isinstance(item,dict) and item.get("projectOrObjectiveTitle","").strip()]
            project_titles_str = ", ".join(project_titles_list[:2]) + ("..." if len(project_titles_list) > 2 else "") if project_titles_list else "(ูุง ุชูุฌุฏ ูุดุงุฑูุน ูุฏุฑุฌุฉ)"
            passion_names_list = [item.get("cognitivePassionName","") for section in self.loaded_ucp_data.get("sections", []) if section.get("id") == "cognitive_passion" for item in section.get("items",[]) if isinstance(item,dict) and item.get("cognitivePassionName","").strip()]
            passion_names_str = ", ".join(passion_names_list[:2]) + ("..." if len(passion_names_list) > 2 else "") if passion_names_list else "(ูุง ุชูุฌุฏ ุงูุชูุงูุงุช ูุฏุฑุฌุฉ)"
            llm_role_str_for_postamble = "(ุบูุฑ ูุญุฏุฏ)"
            role_section_data = next((s for s in self.loaded_ucp_data.get("sections", []) if s.get("id") == "role"), None)
            if role_section_data and role_section_data.get("items") and isinstance(role_section_data["items"],list) and len(role_section_data["items"]) > 0:
                if isinstance(role_section_data["items"][0],dict):
                     llm_role_val = role_section_data["items"][0].get("llmPrimaryRole")
                     if llm_role_val and str(llm_role_val).strip(): llm_role_str_for_postamble = str(llm_role_val)
            try: final_postamble_text = FIXED_POSTAMBLE_TEXT_TEMPLATE.format(preferred_name=pref_name_for_postamble, project_titles=project_titles_str, passion_names=passion_names_str, llm_role=llm_role_str_for_postamble)
            except KeyError as e: print(f"Warning: Postamble format error - missing key {e}. Using raw."); final_postamble_text = FIXED_POSTAMBLE_TEXT_TEMPLATE + f"\n[Formatter Warning: Missing key {e}]"
            lines.append("\n---\n"); lines.append(final_postamble_text)
        lines.append("\n---\n")
        if not for_preview: lines.append(f"ุชู ุชุตุฏูุฑ ูุฐุง ุงููุต ุจูุงุณุทุฉ {APP_VERSION}.")
        return "\n".join(lines)

    def show_protocol_preview_modal(self):
        if not self.loaded_ucp_data: messagebox.showinfo("No Data", "No data to preview."); return
        preview_text = self._generate_protocol_text_content(for_preview=True)
        dialog = tk.Toplevel(self.master); dialog.title("๐ Protocol Preview"); dialog.transient(self.master); dialog.grab_set(); dialog.resizable(True, True)
        text_area = scrolledtext.ScrolledText(dialog, wrap=tk.WORD, width=80, height=25, font=("Courier New", 10), undo=True, padx=5, pady=5)
        text_area.insert(tk.END, preview_text); text_area.config(state=tk.DISABLED); text_area.pack(padx=10, pady=10, fill=tk.BOTH, expand=True)
        bf = ttk.Frame(dialog); bf.pack(pady=10)
        def copy_clip(): dialog.clipboard_clear(); dialog.clipboard_append(text_area.get("1.0", tk.END))
        def save_txt():
            content = text_area.get("1.0", tk.END)
            fn = f"UCP_Preview_{self.eve_preferred_name_cache.replace(' ','_')}.txt" if self.eve_preferred_name_cache != "my friend" else "UCP_Preview.txt"
            fp = filedialog.asksaveasfilename(defaultextension=".txt", filetypes=[("Text", "*.txt")], title="Save Preview", initialfile=fn, parent=dialog)
            if fp:
                try: open(fp,"w",encoding="utf-8").write(content); messagebox.showinfo("Saved","Preview saved.", parent=dialog)
                except Exception as e: messagebox.showerror("Error",str(e),parent=dialog)
        ttk.Button(bf, text="๐ Copy", command=copy_clip).pack(side=tk.LEFT, padx=5)
        ttk.Button(bf, text="๐พ Save TXT", command=save_txt).pack(side=tk.LEFT, padx=5)
        ttk.Button(bf, text="Close", command=dialog.destroy, style="Eve.TButton").pack(side=tk.LEFT, padx=5)
        self.center_window(dialog, 700, 550)
        
    def start_eve_interaction(self):
        self._reset_app_state(full_reset= (not self.loaded_ucp_data) )
        self.eve_state["active"] = True; self.eve_state["current_mode"] = "AWAITING_INITIAL_CHOICE"
        self.eve_state["is_editing_specific_section_now"] = False; self.eve_state["is_asking_mental_state"] = False
        self.eve_state["last_summary_point_triggered"] = None; self.eve_state["is_waiting_for_api_response"] = False
        self._clear_eve_conversation(); greeting = f"{self.get_eve_greeting()} {self.eve_preferred_name_cache}! ุฃูุง ุฅููู ๐ง."
        self._eve_speak(greeting); self._eve_speak("ูู ุชูุฏ ุจุฏุก ุจุฑูุชูููู UCP-LLM ุฌุฏูุฏ ุฃู ุชุญููู ุจุฑูุชูููู ููุฌูุฏุ")
        self.eve_current_question_label.config(text="ูุงุฐุง ุชูุฏ ุฃู ุชูุนูุ")
        self._eve_manage_input_visibility(show_send=False, show_skip=False); [w.destroy() for w in self.eve_mcq_options_frame.winfo_children()]
        btn_new = ttk.Button(self.eve_mcq_options_frame, text="๐ ุจุฏุก ุจุฑูุชูููู ุฌุฏูุฏ", style="Eve.TButton", command=lambda: self.handle_initial_choice("new")); btn_new.pack(fill=tk.X, pady=3); Tooltip(btn_new, "ุฅูุดุงุก ุจุฑูุชูููู ุฌุฏูุฏ ูู ุงูุจุฏุงูุฉ.")
        btn_load = ttk.Button(self.eve_mcq_options_frame, text="๐ ุชุญููู ุจุฑูุชูููู ููุฌูุฏ", style="Eve.TButton", command=lambda: self.handle_initial_choice("load")); btn_load.pack(fill=tk.X, pady=3); Tooltip(btn_load, "ูุชุญ ุจุฑูุชูููู UCP-LLM JSON ูุญููุธ ูุณุจููุง.")
        self.eve_mcq_options_frame.pack(fill=tk.X, pady=(5,8))

    def _clear_eve_conversation(self):
        self.eve_messages_scrolledtext.config(state=tk.NORMAL); self.eve_messages_scrolledtext.delete("1.0", tk.END); self.eve_messages_scrolledtext.config(state=tk.DISABLED)

    def _eve_speak(self, message: str, is_user: bool = False, is_system: bool = False, for_mental_state_selection=False):
        self.eve_messages_scrolledtext.config(state=tk.NORMAL)
        if self.eve_messages_scrolledtext.index(tk.END) != "1.0": self.eve_messages_scrolledtext.insert(tk.END, "\n")
        tag_to_apply = "user_bubble_tag" if is_user else ("system_message_tag" if is_system else "eve_bubble_tag")
        self.eve_messages_scrolledtext.insert(tk.END, message, tag_to_apply); self.eve_messages_scrolledtext.insert(tk.END, "\n")
        self.eve_messages_scrolledtext.config(state=tk.DISABLED); self.eve_messages_scrolledtext.see(tk.END)

    def handle_initial_choice(self, choice: str):
        [w.destroy() for w in self.eve_mcq_options_frame.winfo_children()]; self.eve_mcq_options_frame.pack_forget()
        if choice == "new":
            self._eve_speak("ุฑุงุฆุน! ููุจุฏุฃ ุจุฑูุชูููููุง ุฌุฏูุฏูุง.", is_user=True)
            self.loaded_ucp_data = {"protocolVersion": f"{APP_VERSION} (New)", "generationDate": datetime.datetime.now(UTC).isoformat(), "sections": []}
            self.current_file_path = None; self._set_data_changed(True); self.eve_preferred_name_cache = "ุตุฏููู"; self.current_mental_state_cache = "not_specified"
            self.eve_state["initial_data_loaded_for_eve"] = False; self.eve_state["is_editing_specific_section_now"] = False
            self._reset_eve_progress_for_new_protocol(); self.ask_for_mental_state_update()
        elif choice == "load":
            self._eve_speak("ุญุณููุงุ ูููู ุจุชุญููู ุจุฑูุชูููู ููุฌูุฏ.", is_user=True)
            self.eve_state["current_mode"] = "PROCESSING_FILE_LOAD"; self.prompt_load_file_via_eve()

    def _reset_eve_progress_for_new_protocol(self):
        self.eve_state.update({"current_section_key_index": 0, "current_field_index": 0, "current_item_count_for_section": 0, "is_asking_to_add_another": False, "current_invented_question_index": -1, "current_question_context": None, "last_summary_point_triggered": None })

    def prompt_load_file_via_eve(self):
        self._eve_speak("ูุฑุฌู ุงุฎุชูุงุฑ ููู ุจุฑูุชูููู UCP JSON ุงูุฎุงุต ุจู.", is_system=True); self.master.after(200, self._actually_show_file_dialog_for_eve)

    def _actually_show_file_dialog_for_eve(self):
        filepath = filedialog.askopenfilename(title="ุงุฎุชุฑ ููู UCP JSON", filetypes=(("ูููุงุช JSON", "*.json"),("ุฌููุน ุงููููุงุช", "*.*")))
        if self.load_ucp_file(filepath_from_eve=filepath):
            self.eve_state["initial_data_loaded_for_eve"] = True; self.eve_state["is_editing_specific_section_now"] = False
            self._reset_eve_progress_for_new_protocol(); self.ask_for_mental_state_update()
        elif self.eve_state["current_mode"] == "PROCESSING_FILE_LOAD": self.start_eve_interaction()

    def ask_for_mental_state_update(self):
        self.eve_state["current_mode"] = "AWAITING_MENTAL_STATE_CHOICE"; self.eve_state["is_asking_mental_state"] = True
        self._update_current_mental_state_cache_from_data(); current_mental_state_text = "ุบูุฑ ูุญุฏุฏุฉ"
        mental_state_section = SECTION_TYPE_DATA.get("mental_state", {})
        ms_field_def = mental_state_section.get("fields", [{}])[0] if mental_state_section else {}
        ms_options = ms_field_def.get("options", [])
        for opt in ms_options:
            if opt.get("value") == self.current_mental_state_cache: current_mental_state_text = opt.get("text","ุบูุฑ ูุญุฏุฏุฉ"); break
        self._eve_speak(f"ูุฑุญุจุงู ูุง {self.eve_preferred_name_cache}. ูุจู ุฃู ูุจุฏุฃุ ููู ูู ุญุงูุชู ุงูุฐูููุฉ ุงููููุ", for_mental_state_selection=True)
        if self.current_mental_state_cache != "not_specified" and self.eve_state["initial_data_loaded_for_eve"]: self._eve_speak(f"(ุญุงูุชู ุงููุณุฌูุฉ ุณุงุจูุงู ูู: '{current_mental_state_text}')", is_system=True, for_mental_state_selection=True)
        self.eve_current_question_label.config(text="ูุฑุฌู ุชุญุฏูุฏ ุญุงูุชู ุงูุฐูููุฉ ุงูุญุงููุฉ:")
        [w.destroy() for w in self.eve_mcq_options_frame.winfo_children()]
        if not ms_options: self._eve_speak("ุฎุทุฃ: ูู ูุชู ุงูุนุซูุฑ ุนูู ุฎูุงุฑุงุช ุงูุญุงูุฉ ุงูุฐูููุฉ.", is_system=True); return
        for option_config in ms_options:
            if option_config.get("value") == "": continue
            btn = ttk.Button(self.eve_mcq_options_frame, text=option_config.get("text"), style="Eve.TButton", command=lambda choice_val=option_config.get("value"), choice_text=option_config.get("text"): self._process_mental_state_choice(choice_val, choice_text))
            btn.pack(fill=tk.X, pady=2)
        self._eve_manage_input_visibility(show_mcq_options=True, show_send=False, show_skip=False); self.eve_mcq_options_frame.pack(fill=tk.X, pady=(5,8))

    def _process_mental_state_choice(self, choice_value: str, choice_text: str):
        self.eve_state["is_asking_mental_state"] = False; [w.destroy() for w in self.eve_mcq_options_frame.winfo_children()]; self.eve_mcq_options_frame.pack_forget()
        self.current_mental_state_cache = choice_value; self._eve_speak(f"ุฃูุช: ุงุฎุชุฑุช '{choice_text}' ูุญุงูุชู ุงูุฐูููุฉ.", is_user=True)
        if not self.loaded_ucp_data: self.loaded_ucp_data = {"sections": []} # Safety, should exist
        ms_section_def = SECTION_TYPE_DATA.get("mental_state",{}) # Get static definition
        ms_section_list = self.loaded_ucp_data.setdefault("sections", [])
        ms_section_data = next((s for s in ms_section_list if s.get("id") == "mental_state"), None)
        if not ms_section_data: ms_section_data = {"id": "mental_state", "title": ms_section_def.get("title", "๐ง ุงูุญุงูุฉ ุงูุฐูููุฉ"), "items": [{}]}; ms_section_list.append(ms_section_data)
        elif not ms_section_data.get("items") or not isinstance(ms_section_data.get("items"), list) or len(ms_section_data.get("items")) == 0: ms_section_data["items"] = [{}]
        elif not isinstance(ms_section_data["items"][0], dict): ms_section_data["items"][0] = {} # If item exists but not a dict
        ms_section_data["items"][0]["selectedMentalState"] = choice_value
        if "mentalStateNotes" not in ms_section_data["items"][0]: ms_section_data["items"][0]["mentalStateNotes"] = ""
        self._set_data_changed(True); self.eve_state["current_mode"] = "PROCESSING_PROTOCOL"
        greeting_phrases_map = EVE_MENTAL_STATE_PHRASES.get(self.current_mental_state_cache, EVE_MENTAL_STATE_PHRASES["not_specified"])
        adaptive_greeting = random.choice(greeting_phrases_map["greetings"]).format(name=self.eve_preferred_name_cache); self._eve_speak(adaptive_greeting)
        self.ask_next_eve_question()

    def _get_current_mental_state_from_data(self) -> Optional[str]:
        if not self.loaded_ucp_data or not self.loaded_ucp_data.get("sections"): return None
        ms_section = next((s for s in self.loaded_ucp_data["sections"] if s.get("id") == "mental_state"), None)
        if ms_section and ms_section.get("items") and isinstance(ms_section.get("items"),list) and len(ms_section.get("items")) > 0 and isinstance(ms_section.get("items")[0],dict): return ms_section["items"][0].get("selectedMentalState")
        return None

    def _update_current_mental_state_cache_from_data(self):
        self.current_mental_state_cache = self._get_current_mental_state_from_data() or "not_specified"

    def get_eve_greeting(self):
        hour = datetime.datetime.now().hour;
        if hour < 12: return "ุตุจุงุญ ุงูุฎูุฑ"
        if hour < 18: return "ููุงุฑู ุณุนูุฏ"
        return "ูุณุงุก ุงูุฎูุฑ"

    def _eve_manage_input_visibility(self, show_entry=False, show_text=False, show_select=False, show_mcq_options=False, show_tf_options=False, show_templates_combobox=False, show_send=True, show_skip=True, show_add_another=False, show_done_section=False, show_summary_confirm_buttons=False, show_analysis_display=False, show_analysis_confirm_buttons=False):
        self.eve_reply_entry.pack_forget(); self.eve_reply_text.pack_forget(); self.eve_reply_combobox.pack_forget()
        self.eve_summary_confirm_frame.pack_forget(); [w.destroy() for w in self.eve_summary_confirm_frame.winfo_children()]
        self.eve_analysis_display_text.pack_forget(); self.eve_analysis_confirm_frame.pack_forget(); [w.destroy() for w in self.eve_analysis_confirm_frame.winfo_children()]
        self.eve_add_another_button.pack_forget(); self.eve_done_section_button.pack_forget()
        self.eve_templates_combobox.pack_forget(); self.eve_template_select_var.set("")
        if show_templates_combobox: self.eve_templates_combobox.pack(side=tk.TOP, fill=tk.X, pady=(0,5), in_=self.eve_template_combobox_frame)
        if show_mcq_options or show_tf_options: self.eve_mcq_options_frame.pack(fill=tk.X, pady=(5,8))
        if show_entry: self.eve_reply_entry.pack(fill=tk.X, expand=True, pady=(0,3)); self.eve_reply_entry.focus_set()
        if show_text: self.eve_reply_text.pack(fill=tk.X, expand=True, pady=(0,3)); self.eve_reply_text.focus_set()
        if show_select: self.eve_reply_combobox.pack(fill=tk.X, expand=True, pady=(0,3)); self.eve_reply_combobox.focus_set()
        self.eve_send_button.config(state=tk.NORMAL if show_send else tk.DISABLED)
        self.eve_skip_button.config(state=tk.NORMAL if show_skip else tk.DISABLED)
        if show_add_another: self.eve_add_another_button.pack(side=tk.LEFT, padx=2, expand=True, fill=tk.X, in_=self.eve_multi_action_frame)
        if show_done_section: self.eve_done_section_button.pack(side=tk.LEFT, padx=2, expand=True, fill=tk.X, in_=self.eve_multi_action_frame)
        if show_summary_confirm_buttons:
            self.eve_summary_confirm_frame.pack(fill=tk.X, pady=(8,0))
            yes_btn = ttk.Button(self.eve_summary_confirm_frame, text="โ ูุนูุ ูุฐุง ุตุญูุญ. ููููู!", style="Eve.TButton", command=lambda: self.process_eve_reply(mcq_choice="summary_yes"))
            yes_btn.pack(side=tk.LEFT, padx=5, expand=True, fill=tk.X)
            no_btn = ttk.Button(self.eve_summary_confirm_frame, text="โ ูุงุ ุฃุฑูุฏ ุงูุชูุถูุญ/ุงูุชุนุฏูู.", command=lambda: self.process_eve_reply(mcq_choice="summary_no"))
            no_btn.pack(side=tk.LEFT, padx=5, expand=True, fill=tk.X)
        if show_analysis_display:
            self.eve_analysis_display_text.pack(fill=tk.BOTH, expand=True, pady=(5,10))
            self.eve_analysis_display_text.config(state=tk.NORMAL); self.eve_analysis_display_text.delete("1.0", tk.END)
            analysis_content = self.eve_state.get("api_analysis_result", "ูู ูุชู ุงุณุชูุงู ุชุญููู.")
            self.eve_analysis_display_text.insert(tk.END, analysis_content); self.eve_analysis_display_text.config(state=tk.DISABLED)
        if show_analysis_confirm_buttons:
            self.eve_analysis_confirm_frame.pack(fill=tk.X, pady=(8,0))
            save_analysis_btn = ttk.Button(self.eve_analysis_confirm_frame, text="๐พ ุญูุธ ูุฐุง ุงูุชุญููู ูู ุงูุจุฑูุชูููู", style="Eve.TButton", command=lambda: self.process_eve_reply(mcq_choice="analysis_save"))
            save_analysis_btn.pack(side=tk.LEFT, padx=5, expand=True, fill=tk.X)
            discard_analysis_btn = ttk.Button(self.eve_analysis_confirm_frame, text="๐๏ธ ุชุฌุงูู ูุฐุง ุงูุชุญููู ูุงููุชุงุจุนุฉ", command=lambda: self.process_eve_reply(mcq_choice="analysis_discard"))
            discard_analysis_btn.pack(side=tk.LEFT, padx=5, expand=True, fill=tk.X)

    def _on_template_selected_from_combobox(self, event=None):
        sel_template = self.eve_template_select_var.get(); prompt_text = "[ุงุฎุชุฑ ุงูุชุฑุงุญูุง ุฃู ุงูุชุจ ุฃุฏูุงู]"
        if sel_template and sel_template != prompt_text:
            ctx = self.eve_state["current_question_context"]
            if ctx and ctx["type"] == "direct":
                f_type = ctx["field_def"]["type"]; target_widget = self.eve_reply_text if f_type == "textarea" else (self.eve_reply_entry if f_type == "text" else None)
                if target_widget:
                    if isinstance(target_widget, tk.Text): target_widget.delete("1.0",tk.END); target_widget.insert("1.0",sel_template)
                    elif isinstance(target_widget, ttk.Entry): target_widget.delete(0,tk.END); target_widget.insert(0,sel_template)
                    target_widget.focus_set()
        self.eve_template_select_var.set(prompt_text)

    def _eve_show_input_type(self, field_def: Optional[Dict], iq_config: Optional[Dict], is_asking_add_another:bool=False, is_session_end:bool=False):
        self.eve_reply_entry.delete(0, tk.END); self.eve_reply_text.delete("1.0", tk.END)
        if hasattr(self.eve_reply_text,'tag_remove'): self.eve_reply_text.tag_remove("placeholder_italic", "1.0", tk.END)
        self.eve_reply_select_var.set(""); self.eve_reply_combobox.set(""); self.eve_reply_combobox['values'] = []
        self.eve_templates_combobox['values'] = []; self.eve_template_select_var.set("")
        [w.destroy() for w in self.eve_mcq_options_frame.winfo_children()]; show_templates_cb = False # Clear first
        if is_session_end: self._eve_manage_input_visibility(show_send=False, show_skip=False, show_analysis_display=False, show_analysis_confirm_buttons=False); self.eve_current_question_label.config(text="ุงูุชูู ุงูุชูุงุนู!"); self._eve_speak("ููููู ุงูุญูุธ ุฃู ุจุฏุก ุชูุงุนู ุฌุฏูุฏ.",is_system=True); return
        if is_asking_add_another: self._eve_manage_input_visibility(show_send=False,show_skip=False,show_add_another=True,show_done_section=True); return
        default_template_prompt = "[ุงุฎุชุฑ ุงูุชุฑุงุญูุง ุฃู ุงูุชุจ ุฃุฏูุงู]"
        if field_def and (field_def["type"] == "text" or field_def["type"] == "textarea") and field_def.get("templates"): templates = [default_template_prompt] + field_def.get("templates", []); self.eve_templates_combobox['values'] = templates; self.eve_template_select_var.set(templates[0]); show_templates_cb = True
        if iq_config:
            self.eve_state["current_question_context"] = {"type": "invented", "iq_config": iq_config}; iq_type = iq_config["type"]
            if iq_type == "mc": [ttk.Button(self.eve_mcq_options_frame, text=opt_text, style="Eve.TButton" if len(opt_text)<35 else "TButton", command=lambda c=opt_text: self.process_eve_reply(mcq_choice=c)).pack(side=tk.TOP, fill=tk.X, pady=2) for opt_text in iq_config["options"]]; self._eve_manage_input_visibility(show_mcq_options=True, show_send=False, show_skip=True, show_templates_combobox=show_templates_cb)
            elif iq_type == "tf": ttk.Button(self.eve_mcq_options_frame, text="โ ุตุญูุญ/ูุนู", style="Eve.TButton", command=lambda: self.process_eve_reply(mcq_choice="True")).pack(side=tk.LEFT, fill=tk.X, expand=True, padx=2, pady=2); ttk.Button(self.eve_mcq_options_frame, text="โ ุฎุทุฃ/ูุง", style="Eve.TButton", command=lambda: self.process_eve_reply(mcq_choice="False")).pack(side=tk.LEFT, fill=tk.X, expand=True, padx=2, pady=2); self._eve_manage_input_visibility(show_tf_options=True, show_send=False, show_skip=True, show_templates_combobox=show_templates_cb)
            elif iq_type == "textarea": self._eve_manage_input_visibility(show_text=True, show_templates_combobox=show_templates_cb); self.eve_reply_text.insert("1.0",iq_config.get("placeholder",""),"placeholder_italic")
            else: self._eve_manage_input_visibility(show_entry=True, show_templates_combobox=show_templates_cb); self.eve_reply_entry.insert(0,iq_config.get("placeholder",""))
        elif field_def:
            sec_key = self.eve_state["section_keys_order"][self.eve_state["current_section_key_index"]]; item_idx = self.eve_state["current_item_count_for_section"] -1 if self.eve_state["current_item_count_for_section"] > 0 else 0; self.eve_state["current_question_context"] = {"type": "direct", "section_key": sec_key, "field_def": field_def, "item_index": item_idx}; curr_val = self._get_eve_current_field_value(sec_key, item_idx, field_def["jsonKey"])
            if field_def["type"] == "textarea": self._eve_manage_input_visibility(show_text=True, show_templates_combobox=show_templates_cb); self.eve_reply_text.insert("1.0",str(curr_val) if curr_val is not None else (field_def.get("placeholder_text_area","") if show_templates_cb else ""),"placeholder_italic" if curr_val is None and show_templates_cb and field_def.get("placeholder_text_area") else "")
            elif field_def["type"] == "select":
                opts_display = [opt['text'] for opt in field_def.get("options",[]) if opt.get('text')]; self.eve_reply_combobox['values']=opts_display; sel_found=False
                if curr_val is not None:
                    for opt_cfg in field_def.get("options",[]):
                        if opt_cfg.get('value')==curr_val: self.eve_reply_select_var.set(opt_cfg.get('text')); sel_found=True; break
                if not sel_found and opts_display:
                    try: self.eve_reply_combobox.current(0)
                    except tk.TclError: pass
                self._eve_manage_input_visibility(show_select=True,show_templates_combobox=False)
            else: self._eve_manage_input_visibility(show_entry=True, show_templates_combobox=show_templates_cb); self.eve_reply_entry.insert(0,str(curr_val) if curr_val is not None else "")
        else: self._eve_manage_input_visibility(show_send=False,show_skip=False); self.eve_current_question_label.config(text="ุฃูุง ูุฑุชุจูุฉ. ููุฌุฑุจ ูุฌุฏุฏูุง."); self.master.after(1000,self.start_eve_interaction)
        if hasattr(self.eve_reply_text,'tag_configure'): self.eve_reply_text.tag_configure("placeholder_italic", foreground="grey", font=(self.eve_bubble_font[0], self.eve_bubble_font[1], "italic"))

    def _get_eve_current_field_value(self, section_key, item_idx, json_key_to_check):
        if not self.loaded_ucp_data or not self.loaded_ucp_data.get("sections"): return None
        target_section = next((s for s in self.loaded_ucp_data["sections"] if s.get("id") == section_key), None)
        if target_section and "items" in target_section and isinstance(target_section["items"], list) and 0 <= item_idx < len(target_section["items"]):
            if isinstance(target_section["items"][item_idx], dict): return target_section["items"][item_idx].get(json_key_to_check)
        return None

    def ask_next_eve_question(self):
        if self.eve_state["current_mode"] == "AWAITING_SUMMARY_CONFIRMATION" or self.eve_state["is_asking_mental_state"] or self.eve_state["is_waiting_for_api_response"]: return

        current_section_key_completed = None
        if self.eve_state["current_mode"] == "PROCESSING_PROTOCOL":
            # Determine if a section was just completed (i.e., current_field_index is 0 AND we are not at the very start)
            if self.eve_state["current_field_index"] == 0 and self.eve_state["current_item_count_for_section"] <= 1 : # If single item section or first item of multi-item section
                 if self.eve_state["current_section_key_index"] > 0 : # Ensure we are not at the beginning of the first section
                    current_section_key_completed = self.eve_state["section_keys_order"][self.eve_state["current_section_key_index"] -1]

        summary_key_to_trigger = None
        summary_points = self.eve_state["summary_points"]
        if current_section_key_completed:
            if current_section_key_completed == summary_points["summary_1_after"] and self.eve_state["last_summary_point_triggered"] != "summary_1": summary_key_to_trigger = "summary_1"
            elif current_section_key_completed == summary_points["summary_2_after"] and self.eve_state["last_summary_point_triggered"] != "summary_2": summary_key_to_trigger = "summary_2"
            elif current_section_key_completed == summary_points["summary_3_after"] and self.eve_state["last_summary_point_triggered"] != "summary_3": summary_key_to_trigger = "summary_3"
        
        if summary_key_to_trigger:
            self.eve_state["last_summary_point_triggered"] = summary_key_to_trigger
            self._eve_present_summary_and_ask_confirmation(summary_key_to_trigger); return

        if self.eve_state["current_mode"] != "PROCESSING_PROTOCOL" and self.eve_state["current_mode"] != "PROCESSING_INVENTED":
            if self.eve_state["current_mode"] == "AWAITING_INITIAL_CHOICE": self.start_eve_interaction()
            return
        if self.eve_state["is_asking_to_add_another"]: return

        section_key = self.get_current_eve_section_key()
        if section_key:
            section_def_data = SECTION_TYPE_DATA.get(section_key)
            if not section_def_data: self._eve_speak(f"ุฎุทุฃ: ูุง ููุฌุฏ ุชุนุฑูู ูููุณู {section_key}. ุฌุงุฑู ุงูุชุฎุทู.", is_system=True); self.move_to_next_eve_direct_section_or_invented(); return
            is_multi_item = section_def_data.get("maxItems", 1) > 1 or section_def_data.get("maxItems") is None
            field_def = self.get_current_eve_field_def()
            if field_def:
                item_num_access = self.eve_state["current_item_count_for_section"] or 1; data_item_idx = item_num_access - 1; should_skip = False
                if self.eve_state["initial_data_loaded_for_eve"] and not self.eve_state["is_editing_specific_section_now"]:
                    existing_val = self._get_eve_current_field_value(section_key, data_item_idx, field_def["jsonKey"]);
                    if existing_val is not None:
                        is_empty_skip = (field_def["type"]=="select" and (not bool(existing_val) or (field_def.get("options") and existing_val==field_def.get("options",[{}])[0].get("value")))) or \
                                        (isinstance(existing_val,str) and not bool(existing_val.strip()))
                        if not is_empty_skip: should_skip=True
                if should_skip: self.eve_state["current_field_index"] +=1; self.master.after(10,self.ask_next_eve_question); return
                proto_sec = next((s for s in self.loaded_ucp_data.get("sections",[]) if s.get("id")==section_key),None)
                if not proto_sec: proto_sec={"id":section_key, "title":section_def_data["title"], "items":[]}; self.loaded_ucp_data.setdefault("sections",[]).append(proto_sec)
                eff_item_num_user = self.eve_state["current_item_count_for_section"] or 1; self.eve_state["current_item_count_for_section"]=eff_item_num_user
                items_list = proto_sec.setdefault("items",[]); [items_list.append({}) for _ in range(eff_item_num_user - len(items_list))]
                item_indicator = f" (ุงูุนูุตุฑ {eff_item_num_user})" if is_multi_item and eff_item_num_user > 0 else ""
                clean_title = section_def_data['title'].strip().lstrip('๐ค๐๐๐ง๐กโ๏ธ๐๏ธ๐๏ธ๐๐ง๐๐งช๐๐ญ๐๐ฌโ๏ธ๐งญ๐ฃ๏ธ๐ซ๐พ๐ค๐๐ ')
                question_text_main = f"ุจุงููุณุจุฉ ูู '{clean_title}{item_indicator}'ุ ูุงุฐุง ุนู: {field_def['label']}ุ ๐"
                self._eve_speak(question_text_main); self.eve_current_question_label.config(text=field_def['label'] + ":"); self._eve_show_input_type(field_def, None)
            else: # Finished fields for item
                if self.eve_state["is_editing_specific_section_now"]: self._eve_speak(f"ุฃููููุง ูุฑุงุฌุนุฉ ูุณู '{section_def_data['title'].strip().lstrip('๐ค๐๐๐ง๐กโ๏ธ๐๏ธ๐๏ธ๐๐ง๐๐งช๐๐ญ๐๐ฌโ๏ธ๐งญ๐ฃ๏ธ๐ซ๐พ๐ค๐๐ ')}'.", is_system=True); self.eve_state["is_editing_specific_section_now"]=False
                max_items=section_def_data.get("maxItems", float('inf')); curr_item_num = self.eve_state["current_item_count_for_section"] or 1
                if not is_multi_item or curr_item_num >= max_items : self.move_to_next_eve_direct_section_or_invented() # Summary will be checked inside move_to_next
                else: self.eve_state["is_asking_to_add_another"]=True; self._eve_speak(f"ูู ุชูุฏ ุฅุถุงูุฉ ุนูุตุฑ ุขุฎุฑ ุฅูู '{section_def_data['title'].strip().lstrip('๐ค๐๐๐ง๐กโ๏ธ๐๏ธ๐๏ธ๐๐ง๐๐งช๐๐ญ๐๐ฌโ๏ธ๐งญ๐ฃ๏ธ๐ซ๐พ๐ค๐๐ ')}'?"); self.eve_current_question_label.config(text=f"ุฅุถุงูุฉ ุงููุฒูุฏุ"); self._eve_show_input_type(None,None,is_asking_add_another=True)
        else: # All direct sections done
            if self.eve_state["is_editing_specific_section_now"]: self._eve_speak("ุฃููููุง ูุฑุงุฌุนุฉ ุฌููุน ุงูุฃูุณุงู.", is_system=True); self.eve_state["is_editing_specific_section_now"]=False
            if self.eve_state["summary_points"]["summary_4_before_invented"] and self.eve_state["last_summary_point_triggered"] != "summary_4":
                self.eve_state["last_summary_point_triggered"] = "summary_4"; self._eve_present_summary_and_ask_confirmation("summary_4"); return
            if self.eve_state["current_mode"] != "PROCESSING_INVENTED": self.eve_state["current_mode"] = "PROCESSING_INVENTED"
            self.eve_state["current_invented_question_index"] +=1; idx = self.eve_state["current_invented_question_index"]
            if 0 <= idx < len(EVE_INVENTED_QUESTIONS):
                iq = EVE_INVENTED_QUESTIONS[idx]; should_skip_iq=False
                if self.eve_state["initial_data_loaded_for_eve"] and not self.eve_state["is_editing_specific_section_now"]:
                    notes_sec_def = SECTION_TYPE_DATA.get("additional_notes"); notes_text_content=""
                    if notes_sec_def and self.loaded_ucp_data:
                        data_notes_sec = next((s for s in self.loaded_ucp_data.get("sections",[]) if s.get("id")=="additional_notes"), None)
                        if data_notes_sec and data_notes_sec.get("items") and isinstance(data_notes_sec["items"],list) and data_notes_sec["items"] and notes_sec_def.get("fields"):
                            notes_json_key_field = notes_sec_def["fields"][0].get("jsonKey")
                            if isinstance(data_notes_sec["items"][0],dict): notes_text_content=data_notes_sec["items"][0].get(notes_json_key_field,"")
                    normalized_iq_question_for_search = iq['question'].replace('"', "'")
                    q_identifier = f"Eve ๐ง (Q: \"{normalized_iq_question_for_search}\"):"
                    if q_identifier in notes_text_content: should_skip_iq=True
                if should_skip_iq: self.master.after(10, self.ask_next_eve_question); return
                self._eve_speak(iq["question"]); self.eve_current_question_label.config(text="ุณุคุงู ุฅุจุฏุงุนู ูู ุฅููู ๐ง:"); self._eve_show_input_type(None, iq)
            else: # All invented questions done
                self.eve_state["current_mode"] = "AWAITING_API_ANALYSIS_CHOICE"
                self._eve_speak(f"ุฑุงุฆุน ูุง {self.eve_preferred_name_cache}! โจ ููุฏ ุงุณุชููููุง ูู ุดูุก. ุจุฑูุชููููู ุฌุงูุฒ!"); self._eve_speak("ูู ุชุฑุบุจ ูู ุฃู ุฃููู ุจุฅุฑุณุงู ูุฐุง ุงูุจุฑูุชูููู ุฅูู ูููุฐุฌ ูุบูู ุฎุงุฑุฌู ูุชุญูููู ูุชูุฏูู ููุฎุต ูุฑุคู ุญูู ุดุฎุตูุชู ูุฃููุงุทูุ ูุฐุง ุงูุชุญููู ุณููุถุงู ุฅูู ุจุฑูุชููููู.")
                self.eve_current_question_label.config(text="ูู ุชูุฏ ุฅุฌุฑุงุก ุชุญููู ุฎุงุฑุฌู ุงูุขูุ"); self._eve_manage_input_visibility(show_send=False, show_skip=False); [w.destroy() for w in self.eve_mcq_options_frame.winfo_children()]
                yes_btn = ttk.Button(self.eve_mcq_options_frame, text="โ ูุนูุ ูู ุจุงูุชุญููู ุงูุชููุงุฆู ุงูุขู", style="Eve.TButton", command=lambda: self.process_eve_reply(mcq_choice="api_analyze_yes")); yes_btn.pack(side=tk.LEFT, fill=tk.X, expand=True, padx=5, pady=3)
                no_btn = ttk.Button(self.eve_mcq_options_frame, text="โ ูุงุ ุดูุฑูุง (ุณุฃููู ุงูุฌูุณุฉ)", style="TButton", command=lambda: self.process_eve_reply(mcq_choice="api_analyze_no")); no_btn.pack(side=tk.LEFT, fill=tk.X, expand=True, padx=5, pady=3)
                self.eve_mcq_options_frame.pack(fill=tk.X, pady=(5,8))

    def get_current_eve_section_key(self) -> Optional[str]:
        idx = self.eve_state["current_section_key_index"]; keys = self.eve_state["section_keys_order"]; return keys[idx] if 0 <= idx < len(keys) else None

    def get_current_eve_field_def(self) -> Optional[Dict]:
        sec_key = self.get_current_eve_section_key()
        if sec_key: sec_def = SECTION_TYPE_DATA.get(sec_key)
        if sec_key and sec_def: fields = sec_def.get("fields",[]); field_idx = self.eve_state["current_field_index"]; return fields[field_idx] if 0 <= field_idx < len(fields) else None
        return None

    def move_to_next_eve_direct_section_or_invented(self):
        self.eve_state["current_section_key_index"] +=1
        self.eve_state["current_field_index"] = 0; self.eve_state["current_item_count_for_section"] = 0
        # Check for summary AFTER incrementing index, to summarize section just left
        completed_section_index = self.eve_state["current_section_key_index"] -1 # Index of the section we just finished
        if completed_section_index >= 0:
            completed_section_key = self.eve_state["section_keys_order"][completed_section_index]
            summary_key_to_trigger = None
            summary_points = self.eve_state["summary_points"]
            if completed_section_key == summary_points["summary_1_after"] and self.eve_state["last_summary_point_triggered"] != "summary_1": summary_key_to_trigger = "summary_1"
            elif completed_section_key == summary_points["summary_2_after"] and self.eve_state["last_summary_point_triggered"] != "summary_2": summary_key_to_trigger = "summary_2"
            elif completed_section_key == summary_points["summary_3_after"] and self.eve_state["last_summary_point_triggered"] != "summary_3": summary_key_to_trigger = "summary_3"
            if summary_key_to_trigger:
                self.eve_state["last_summary_point_triggered"] = summary_key_to_trigger
                self._eve_present_summary_and_ask_confirmation(summary_key_to_trigger)
                return # Wait for summary confirmation before asking next actual question
        self.ask_next_eve_question()


    def eve_handle_add_another(self):
        self.eve_state["is_asking_to_add_another"]=False; self.eve_state["current_field_index"]=0; self.eve_state["current_item_count_for_section"] +=1; self.eve_state["initial_data_loaded_for_eve"]=False
        self._eve_speak("ุญุณูุงูุ ููุถู ุนูุตุฑุงู ุขุฎุฑ!", is_user=True); self.ask_next_eve_question()

    def eve_handle_done_with_section(self): # Modified to integrate summary check
        self.eve_state["is_asking_to_add_another"]=False
        completed_section_key = self.get_current_eve_section_key()
        summary_key_to_trigger = None
        summary_points = self.eve_state["summary_points"]
        if completed_section_key == summary_points["summary_1_after"] and self.eve_state["last_summary_point_triggered"] != "summary_1": summary_key_to_trigger = "summary_1"
        elif completed_section_key == summary_points["summary_2_after"] and self.eve_state["last_summary_point_triggered"] != "summary_2": summary_key_to_trigger = "summary_2"
        elif completed_section_key == summary_points["summary_3_after"] and self.eve_state["last_summary_point_triggered"] != "summary_3": summary_key_to_trigger = "summary_3"

        if summary_key_to_trigger:
            self.eve_state["last_summary_point_triggered"] = summary_key_to_trigger
            self._eve_present_summary_and_ask_confirmation(summary_key_to_trigger)
            # After confirmation, if user says yes, process_eve_reply will call ask_next_eve_question,
            # which will then effectively call move_to_next_eve_direct_section_or_invented to move to next actual section.
        else:
             self._eve_speak("ููุงููุ ููุชูู ูููุณู ุงูุชุงูู.", is_user=True)
             self.move_to_next_eve_direct_section_or_invented()


    def _eve_generate_summary(self, summary_config_key: str) -> str:
        summary_parts = []; summary_configs = {
            "summary_1": [ ("personal", "preferredName", "direct", "ุงุณูู ุงูููุถู ููุชูุงุนู ูู: {value}."), ("social", "socialFamilyDetails", "mention_if_filled", "ููุฏ ุดุงุฑูุช ุจุนุถ ุงูุชูุงุตูู ุญูู ูุถุนู ุงูุงุฌุชูุงุนู."), ("educational_professional", "educationalBackground", "first_n_words(20)", "ูููุง ูุชุนูู ุจุฎูููุชู ุงูุชุนููููุฉุ ุฐูุฑุชู: '{value}...'.") , ("educational_professional", "professionalExperience", "first_n_words(20)", "ููููุง ูุฎุต ุฎุจุฑุงุชู ุงูููููุฉุ ุฃุดุฑุชู ุฅูู: '{value}...'.") ],
            "summary_2": [ ("thinking_reference", "coreThinkingReferenceDescription", "direct", "ูุฑุฌุนูุชู ุงูููุฑูุฉ ูู: {value}."), ("cognitive_passion", "cognitivePassionName", "first_item_direct", "ูู ุงูุชูุงูุงุชู ุงููุนุฑููุฉ: {value}."), ("ethical_values", "ethicalValueName", "first_item_direct", "ูู ูููู ุงูุฃุณุงุณูุฉ: {value}."), ("concepts_perspective", "coreConceptName", "first_item_direct", "ูุฏูู ููุธูุฑ ุฎุงุต ุชุฌุงู ููููู: {value}.") ],
            "summary_3": [ ("cognitive_tools_methodology", "cognitiveToolName", "first_item_direct", "ูู ุงูุฃุฏูุงุช ุงููุนุฑููุฉ ุงูุชู ุชุณุชุฎุฏููุง: {value}."), ("inspiring_figures", "inspiringFigureName", "first_item_direct", "ูู ุงูุดุฎุตูุงุช ุงูููููุฉ ูู: {value}."), ("projects", "projectOrObjectiveTitle", "first_item_direct", "ุฃุญุฏ ูุดุงุฑูุนู ุงูุญุงููุฉ ูู: '{value}'."), ("projects", "projectDetailedGoals", "first_item_first_n_words(15)", "ูููุฏู ุจุดูู ุฑุฆูุณู ุฅูู: '{value}...'.") ],
            "summary_4": [ ("role", "llmPrimaryRole", "direct", "ูุจุฏู ุฃูู ุชูุถู ุฃู ูููู ุฏูุฑู ูู: {value}."), ("interaction_style", "preferredResponseStyle", "first_n_words(15)", "ูุชูุถู ุฃู ูููู ุฃุณููุจ ุชูุงุนูู ูุนู: '{value}...'.") , ("memory_management_directives", "contextMaintenanceDirective", "first_n_words(15)", "ููููุง ูุชุนูู ุจุฅุฏุงุฑุฉ ุงูุฐุงูุฑุฉุ ุฃุดุฑุช ุฅูู: '{value}...'.")] }; current_config = summary_configs.get(summary_config_key, [])
        for section_id, json_key, process_method, template_str in current_config:
            section_data = next((s for s in self.loaded_ucp_data.get("sections", []) if s.get("id") == section_id), None); value_to_display = None
            if section_data and section_data.get("items"):
                items = section_data.get("items", []); target_item = items[0] if items and isinstance(items[0],dict) else None
                if target_item:
                    raw_value = target_item.get(json_key)
                    if raw_value is not None and str(raw_value).strip():
                        if process_method == "direct" or process_method == "first_item_direct": value_to_display = str(raw_value)
                        elif process_method == "mention_if_filled": value_to_display = "ูุนู"
                        elif "first_n_words" in process_method or "first_item_first_n_words" in process_method: n_str = process_method.split("(")[1].split(")")[0] if "(" in process_method else "15"; n = int(n_str) if n_str.isdigit() else 15; value_to_display = " ".join(str(raw_value).split()[:n])
            if value_to_display:
                if process_method == "mention_if_filled": summary_parts.append(template_str.split(":")[0].strip() + ".")
                else: summary_parts.append(template_str.format(value=value_to_display))
        if not summary_parts: return "ูุจุฏู ุฃููุง ูู ูุบุท ุงููุซูุฑ ูู ุงูุชูุงุตูู ุจุนุฏ ูู ูุฐู ุงูุฃูุณุงู."
        final_summary_text = "\n- " + "\n- ".join(summary_parts); return final_summary_text

    def _eve_present_summary_and_ask_confirmation(self, summary_config_key: str):
        self.eve_state["current_mode"] = "AWAITING_SUMMARY_CONFIRMATION"; self.eve_state["current_question_context"] = {"type": "summary_confirm", "summary_key": summary_config_key}
        summary_text_core = self._eve_generate_summary(summary_config_key); mental_state_phrases_map = EVE_MENTAL_STATE_PHRASES.get(self.current_mental_state_cache, EVE_MENTAL_STATE_PHRASES["not_specified"])
        adaptive_summary_intro = mental_state_phrases_map.get("summary_intro", "ุฏุนูุง ูุชุฃูุฏ ุฃููู ูููุชู ุจุดูู ุตุญูุญ:") + f" ูุง {self.eve_preferred_name_cache}!"; full_summary_message = adaptive_summary_intro + summary_text_core
        self._eve_speak(full_summary_message); self.eve_current_question_label.config(text="ูู ูุฐุง ุงูููุฎุต ุตุญูุญ ููุนูุณ ูุง ุฐูุฑุชูุ"); self._eve_manage_input_visibility(show_send=False, show_skip=False, show_summary_confirm_buttons=True)

    def process_eve_reply(self, mcq_choice: Optional[str] = None):
        # --- Summary Confirmation Logic ---
        if self.eve_state["current_mode"] == "AWAITING_SUMMARY_CONFIRMATION":
            ctx = self.eve_state["current_question_context"]
            if ctx and ctx["type"] == "summary_confirm":
                self._eve_manage_input_visibility(show_send=False, show_skip=False, show_summary_confirm_buttons=False)
                if mcq_choice == "summary_yes":
                    self._eve_speak("ุฑุงุฆุน! ูุณุนุฏูู ุฃููุง ูุชูููู. ูููุงุตู.", is_user=True)
                    next_mode_after_summary = "PROCESSING_PROTOCOL"
                    if ctx.get("summary_key") == "summary_4": # Summary before Invented Questions or API
                        # Check if we need to go to Invented Questions or directly to API choice
                        if self.eve_state.get("current_invented_question_index", -1) < len(EVE_INVENTED_QUESTIONS) -1 :
                             next_mode_after_summary = "PROCESSING_INVENTED"
                        else: # All IQs are done or skipped, move to API choice
                             next_mode_after_summary = "AWAITING_API_ANALYSIS_CHOICE" # Placeholder until API mode fully decided

                    self.eve_state["current_mode"] = next_mode_after_summary
                    
                    # Logic to correctly advance after summary
                    if ctx.get("summary_key") != "summary_4" and next_mode_after_summary == "PROCESSING_PROTOCOL":
                         # This means we summarized mid-protocol sections.
                         # The current_section_key_index was already advanced before summary was triggered
                         # OR if triggered by eve_handle_done_with_section, then move_to_next will advance.
                         # A safer bet is to just call ask_next_eve_question which will pick up
                         # from the current_section_key_index and current_field_index.
                         # If a section just finished and triggered a summary, process_eve_reply for that summary's 'yes'
                         # should correctly allow ask_next_eve_question to proceed to the *next* section's first question.
                         self.ask_next_eve_question()
                    elif next_mode_after_summary == "PROCESSING_INVENTED":
                         self.ask_next_eve_question() # Will start asking IQs
                    elif next_mode_after_summary == "AWAITING_API_ANALYSIS_CHOICE":
                         # Directly trigger the API choice logic as all IQs are done
                         self.eve_state["current_invented_question_index"] = len(EVE_INVENTED_QUESTIONS) # Mark IQs as done
                         self.ask_next_eve_question() # This should now lead to API choice
                    else:
                         self.ask_next_eve_question()


                elif mcq_choice == "summary_no":
                    self._eve_speak("ุฃุชููู ุฐูู. ูุง ูุดููุฉ.", is_user=True)
                    self._eve_speak("ููููู ุงุณุชุฎุฏุงู ุฎูุงุฑ 'โ๏ธ Edit Specific Section...' ูู ูุงุฆูุฉ 'Eve' ูุชุนุฏูู ุงูุฃูุณุงู.")
                    self.eve_current_question_label.config(text="ููููู ุชุนุฏูู ุงูุฃูุณุงู ูู ูุงุฆูุฉ 'Eve'.")
                    self.eve_state["current_mode"] = "USER_CORRECTING_SUMMARY" # Halt Eve's automatic progression
                return # Crucial return for summary handling
        
        # --- API Analysis Choice Logic ---
        elif self.eve_state["current_mode"] == "AWAITING_API_ANALYSIS_CHOICE":
            self._eve_manage_input_visibility(show_mcq_options=False, show_send=False, show_skip=False) # Hide choice buttons
            if mcq_choice == "api_analyze_yes":
                self._eve_speak("ุทูุจุช ุฅุฌุฑุงุก ุชุญููู ุฎุงุฑุฌู ุชููุงุฆู.", is_user=True)
                self.trigger_external_analysis() # This will change mode to WAITING_FOR_API_RESPONSE
            elif mcq_choice == "api_analyze_no":
                self._eve_speak("ุงุฎุชุฑุช ุนุฏู ุฅุฌุฑุงุก ุชุญููู ุฎุงุฑุฌู ุงูุขู.", is_user=True)
                self.eve_state["current_mode"] = "SESSION_COMPLETE"
                self._eve_speak("ุจุฑูุชููููู ุฌุงูุฒ. ููููู ุญูุธู ุงูุขู ูู ูุงุฆูุฉ 'File'. ุดูุฑูุง ูู!", is_system=True)
                self.eve_current_question_label.config(text="ุงูุชููุช ุงูุฌูุณุฉ!")
                self._eve_manage_input_visibility(show_send=False, show_skip=False)
            return # Crucial return for API choice handling

        # --- API Analysis Save/Discard Choice Logic ---
        elif self.eve_state["current_mode"] == "AWAITING_API_ANALYSIS_SAVE_CHOICE":
             self._eve_manage_input_visibility(show_analysis_display=False, show_analysis_confirm_buttons=False, show_send=False, show_skip=False) # Hide all

             if mcq_choice == "analysis_save":
                self._eve_speak("ุทูุจุช ุญูุธ ุงูุชุญููู ูู ุงูุจุฑูุชูููู.", is_user=True)
                if self.eve_state.get("api_analysis_result"):
                    self._save_external_analysis_to_protocol(self.eve_state["api_analysis_result"])
                    self._eve_speak("ุชู ุญูุธ ููุฎุต ุงูุชุญููู ุงูุฎุงุฑุฌู ุจูุฌุงุญ ูู ูุณู ุงูููุงุญุธุงุช ุงูุฅุถุงููุฉ.", is_system=True)
                else:
                    self._eve_speak("ูู ูุชู ุงูุนุซูุฑ ุนูู ูุชูุฌุฉ ุชุญููู ูุญูุธูุง.", is_system=True)
             elif mcq_choice == "analysis_discard":
                self._eve_speak("ุงุฎุชุฑุช ุชุฌุงูู ูุฐุง ุงูุชุญููู.", is_user=True)
             
             self.eve_state["current_mode"] = "SESSION_COMPLETE"
             self.eve_state["api_analysis_result"] = None # Clear result
             self._eve_speak("ุจุฑูุชููููู ุฌุงูุฒ (ูุน ุฃู ุจุฏูู ุงูุชุญููู ุงููุถุงู). ููููู ุญูุธู ุงูุขู ูู ูุงุฆูุฉ 'File'. ุดูุฑูุง ูู!", is_system=True)
             self.eve_current_question_label.config(text="ุงูุชููุช ุงูุฌูุณุฉ!")
             # Ensure no inputs are visible:
             self._eve_manage_input_visibility(show_entry=False, show_text=False, show_select=False, 
                                              show_mcq_options=False, show_tf_options=False, 
                                              show_templates_combobox=False, show_send=False, show_skip=False,
                                              show_add_another=False, show_done_section=False,
                                              show_summary_confirm_buttons=False,
                                              show_analysis_display=False, show_analysis_confirm_buttons=False)
             return # Crucial return for save/discard analysis choice

        # --- Regular Question Reply Processing (the part you highlighted) ---
        context = self.eve_state.get("current_question_context") # Use .get for safety

        if not context:
            self._eve_speak("ุฎุทุฃ: ุงูุณูุงู ุงูุญุงูู ููุณุคุงู ุบูุฑ ูุญุฏุฏ. ุณุฃุญุงูู ุฅุนุงุฏุฉ ุชุญููู ุงูุณุคุงู ุงูุฃุฎูุฑ ุฃู ุจุฏุก ุงูุชูุงุนู ูู ุฌุฏูุฏ.", is_system=True)
            # Decide recovery strategy
            if self.eve_state["current_mode"] in ["PROCESSING_PROTOCOL", "PROCESSING_INVENTED"] and self.eve_state["current_section_key_index"] < len(self.eve_state["section_keys_order"]):
                self.ask_next_eve_question() # Try to re-ask
            else:
                self.start_eve_interaction() # Fallback to full restart
            return

        reply_val_store = ""
        display_reply_bubble = ""
        source_widget = None

        if context.get("type") == "invented":
            iq_config = context.get("iq_config", {})
            if iq_config.get("type") == "textarea":
                current_text_content = self.eve_reply_text.get("1.0", tk.END).strip()
                placeholder_text = iq_config.get("placeholder", "")
                if placeholder_text and current_text_content == placeholder_text:
                    self.eve_reply_text.delete("1.0", tk.END)
                    if hasattr(self.eve_reply_text, 'tag_remove'): # Ensure tag_remove exists
                         self.eve_reply_text.tag_remove("placeholder_italic", "1.0", tk.END) # Corrected END usage

        # Determine reply_val_store and display_reply_bubble based on context and mcq_choice
        if mcq_choice is not None: # Handles MCQ, TF, and template button clicks for select type fields
            reply_val_store = mcq_choice
            display_reply_bubble = mcq_choice
            if context.get("type") == "direct":
                field_def = context.get("field_def", {})
                if field_def.get("type") == "select": # This is for protocol's own select (dropdown)
                    # For protocol selects, mcq_choice would be the display text from a button (less likely now with combobox)
                    # Or, if we adapt MCQ buttons for protocol selects.
                    # Here, assume mcq_choice *is* the value if this path is taken for a select.
                    # For safety, ensure it's one of the valid values.
                    options_list = field_def.get("options", [])
                    # This part might need more refinement if MCQ buttons are truly used for protocol 'select'
                    # but with eve_reply_combobox, this direct mcq_choice for 'select' fields is less likely.
                    # For now, we assume if mcq_choice comes for a select, it's the *value*.
                    pass # reply_val_store is already mcq_choice
        
        elif context.get("type") == "direct":
            field_def = context.get("field_def", {})
            field_type = field_def.get("type")

            if field_type == "textarea":
                reply_val_store = self.eve_reply_text.get("1.0", tk.END).strip()
                source_widget = self.eve_reply_text
            elif field_type == "select": # Protocol's own select fields (using self.eve_reply_combobox)
                display_text_selected = self.eve_reply_select_var.get()
                reply_val_store = display_text_selected # Default to display text if no mapping
                for opt_cfg in field_def.get("options", []):
                    if opt_cfg.get("text") == display_text_selected:
                        reply_val_store = opt_cfg.get("value", display_text_selected)
                        break
                source_widget = self.eve_reply_combobox
            else: # text type for protocol field
                reply_val_store = self.eve_reply_entry.get().strip()
                source_widget = self.eve_reply_entry
            
            display_reply_bubble = reply_val_store
            if field_type == "select": # For display, always use the selected text from combobox
                display_reply_bubble = self.eve_reply_select_var.get()

        elif context.get("type") == "invented": # For invented text/textarea questions
            iq_config = context.get("iq_config", {})
            iq_type = iq_config.get("type")
            if iq_type == "textarea":
                reply_val_store = self.eve_reply_text.get("1.0", tk.END).strip()
                source_widget = self.eve_reply_text
            elif iq_type == "text":
                reply_val_store = self.eve_reply_entry.get().strip()
                source_widget = self.eve_reply_entry
            # MCQ/TF for invented are handled if mcq_choice is not None (top of function)
            display_reply_bubble = reply_val_store
        
        # --- Now, save the data and proceed ---
        # This 'if' condition checks if there's actually something to process and speak about
        data_to_log = (reply_val_store or (mcq_choice is not None) or 
                      (context.get("type") == "direct" and context.get("field_def", {}).get("type") == "select" and self.eve_reply_select_var.get()))

        if data_to_log:
            self._eve_speak(f"ุฃูุช: {display_reply_bubble}", is_user=True)
            data_updated_by_this_reply = False # Flag to track if actual data changed

            if context.get("type") == "direct":
                # ... (Logic to save to self.loaded_ucp_data for direct questions) ...
                # This part needs to be robust to missing keys/items.
                section_key = context.get("section_key")
                field_def = context.get("field_def",{})
                json_key = field_def.get("jsonKey")
                item_idx = context.get("item_index", 0)

                if section_key and json_key is not None : # item_idx can be 0
                    sections_list = self.loaded_ucp_data.setdefault("sections", [])
                    target_section_data = next((s for s in sections_list if s.get("id") == section_key), None)
                    
                    if not target_section_data: # If section doesn't exist, create it
                        target_section_data = {"id": section_key, "title": SECTION_TYPE_DATA.get(section_key,{}).get("title","Unknown Section"), "items": []}
                        sections_list.append(target_section_data)

                    items_list = target_section_data.setdefault("items", [])
                    while len(items_list) <= item_idx: # Ensure item at item_idx exists
                        items_list.append({})
                    
                    if not isinstance(items_list[item_idx], dict): # Ensure item is a dict
                        items_list[item_idx] = {}

                    if items_list[item_idx].get(json_key) != reply_val_store:
                        items_list[item_idx][json_key] = reply_val_store
                        data_updated_by_this_reply = True
                    
                    if json_key == "preferredName" and section_key == "personal":
                        self.eve_preferred_name_cache = reply_val_store or "ุตุฏููู"
                        if not data_updated_by_this_reply and (items_list[item_idx].get(json_key) != reply_val_store) : # ensure change flag if name changes
                             data_updated_by_this_reply = True


            elif context.get("type") == "invented":
                # ... (Logic to save to additional_notes for invented questions) ...
                # This also needs to be robust.
                notes_section_id = "additional_notes"
                notes_section_def = SECTION_TYPE_DATA.get(notes_section_id)
                if notes_section_def and notes_section_def.get("fields"):
                    notes_json_key = notes_section_def["fields"][0].get("jsonKey")
                    
                    sections_list = self.loaded_ucp_data.setdefault("sections", [])
                    notes_section_data = next((s for s in sections_list if s.get("id") == notes_section_id), None)

                    if not notes_section_data:
                        notes_section_data = {"id": notes_section_id, "title": notes_section_def.get("title", "ููุงุญุธุงุช ุฅุถุงููุฉ"), "items": [{notes_json_key: ""}]}
                        sections_list.append(notes_section_data)
                    elif not notes_section_data.get("items") or not isinstance(notes_section_data.get("items"), list) or not notes_section_data["items"] or not isinstance(notes_section_data["items"][0], dict):
                        notes_section_data["items"] = [{notes_json_key: ""}] # Ensure item[0] exists and is a dict

                    current_notes = notes_section_data["items"][0].get(notes_json_key, "")
                    iq_config = context.get("iq_config", {})
                    original_iq_question = iq_config.get("question", "ุณุคุงู ุบูุฑ ูุนุฑูู")
                    
                    # Consistent quote normalization for saving IQ
                    normalized_iq_question_for_saving = original_iq_question.replace('"', "'")
                    
                    eve_note_entry = f"Eve ๐ง (Q: \"{normalized_iq_question_for_saving}\"):\nYour Answer: {reply_val_store}\n-----\n"
                    
                    new_notes_content = current_notes
                    if current_notes and current_notes.strip() and not current_notes.strip().endswith("-----"):
                        new_notes_content += "\n\n" # Add separator if notes are not empty and don't end with separator
                    new_notes_content += eve_note_entry.strip() # Add new entry, stripping its trailing newline for now

                    if notes_section_data["items"][0].get(notes_json_key) != new_notes_content:
                        notes_section_data["items"][0][notes_json_key] = new_notes_content
                        data_updated_by_this_reply = True
                else:
                    self._eve_speak("ุฎุทุฃ ูู ุงูุฅุนุฏุงุฏ: ูุณู 'ุงูููุงุญุธุงุช ุงูุฅุถุงููุฉ' ูุฃุณุฆูุฉ ุฅููู ุบูุฑ ูููุฃ ุจุดูู ุตุญูุญ.", is_system=True)

            if data_updated_by_this_reply:
                self._set_data_changed(True) # Mark protocol as changed
        else:
            self._eve_speak("(ุชุฎุทูุช ุฃู ุฃุฑุณูุช ุฑุฏุงู ูุงุฑุบุงู.)", is_user=True)

        # Clear the input widget from which the reply was taken
        if source_widget:
            if isinstance(source_widget, tk.Text):
                source_widget.delete("1.0", tk.END)
            elif isinstance(source_widget, ttk.Entry):
                source_widget.delete(0, tk.END)
            # For ttk.Combobox (protocol select), it's handled by eve_reply_select_var.set("") in _eve_show_input_type
        
        # Advance to next question
        if context.get("type") == "direct":
            self.eve_state["current_field_index"] += 1
        
        # Call ask_next_eve_question to determine the next step
        # This will handle moving to next field, next section, summaries, IQs, or API analysis choice
        self.master.after(100, self.ask_next_eve_question)
    def trigger_external_analysis(self):
        if not self.loaded_ucp_data: self._eve_speak("ูุง ููุฌุฏ ุจุฑูุชูููู ูุชุญูููู.", is_system=True); self.eve_state["current_mode"] = "SESSION_COMPLETE"; self.ask_next_eve_question(); return
        if not self.groq_api_key_cache or self.groq_api_key_cache == "gsk_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx": # REPLACE placeholder too
            self._eve_speak("ูู ูุชู ุฅุนุฏุงุฏ ููุชุงุญ Groq API. ูุง ูููู ุฅุฌุฑุงุก ุงูุชุญููู.", is_system=True); messagebox.showwarning("ููุชุงุญ API ุบูุฑ ููุฌูุฏ", "ูุฑุฌู ุฅุนุฏุงุฏ ููุชุงุญ Groq API."); self.eve_state["current_mode"] = "SESSION_COMPLETE"; self.ask_next_eve_question(); return
        self._eve_speak("ุฌุงุฑู ุฅุนุฏุงุฏ ุงูุจูุงูุงุช ูุฅุฑุณุงููุง ููุชุญููู ุงูุฎุงุฑุฌู... ูุฏ ูุณุชุบุฑู ูุฐุง ุจุนุถ ุงูููุช.", is_system=True)
        self.eve_current_question_label.config(text="โณ ุฌุงุฑู ุชุญููู ุงูุจุฑูุชูููู ุจูุงุณุทุฉ Groq API...")
        self.eve_state["is_waiting_for_api_response"] = True; self._eve_manage_input_visibility(show_send=False, show_skip=False)
        full_protocol_text = self._generate_protocol_text_content(for_preview=False)
        analysis_prompt_template_v2 = """
<<< ุจุฏุงูุฉ ุงูููุฌู ุฅูู ุงููููุฐุฌ ุงููุบูู ุงููุจูุฑ ุงูุฎุงุฑุฌู (ุงููุณุฎุฉ ุงููุญุณูุฉ v2) >>>
ุฃูุช ูููุฐุฌ ูุบูู ูุจูุฑ ููุญูู ุจูุงูุงุช ูุชุฎุตุต ูู ููู ูุชุญููู ุงูุดุฎุตูุงุช ูุงูุฃููุงุท ุงูุณููููุฉ ูุงูููุฑูุฉุ ูุน ุงูุชุฑููุฒ ุนูู ุงูุงุณุชูุชุงุฌ ุงููุจูู ุนูู ุงูุฃุฏูุฉุ ุงูุชูููุฑ ุงูููุฏูุ ูุงุณุชูุนุงุจ ุงูุณูุงูุงุช ุงููุนูุฏุฉ ูุงููุชุนุฏุฏุฉ ุงูุทุจูุงุช. ูููุชู ููุณุช ูุฌุฑุฏ ุชูุฎูุต ุงููุนูููุงุชุ ุจู ุชูุฏูู ุชุญููู ุนููู ูุฑุคู ุงุณุชูุชุงุฌูุฉ.
ูููุชู ูู ุชุญููู "ุจุฑูุชูููู ุงูุณูุงู ุงูุดุฎุตู (UCP-LLM)" ุงูุชุงูู ูููุณุชุฎุฏูุ ูุงูุฐู ุชู ุฌูุนู ุนุจุฑ ุฃุฏุงุฉ ูุชุฎุตุตุฉ ูุตููุฉ ูุงุณุชุฎูุงุต ูุนูููุงุช ุนูููุฉ ููุชููุนุฉ. ูุฐุง ุงูุจุฑูุชูููู ูุชุถูู ูุนูููุงุช ููุตูุฉ ูุฏููุง ุงููุณุชุฎุฏู ุนู ููุณูุ ููุธูุฑู ููุนุงููุ ููููุ ุฃูุฏุงููุ ุจุงูุฅุถุงูุฉ ุฅูู ุฅุฌุงุจุงุชู ุนูู ูุฌููุนุฉ ูุงุณุนุฉ ูู ุงูุฃุณุฆูุฉ ุงูุฅุจุฏุงุนูุฉ ูุงูุงุณุชููุงููุฉ.
ุงูุจุฑูุชูููู ููุณู (ููุง ูู ูุฑูู ุฃุฏูุงู) ูุญุชูู ุนูู "ููุฏูุฉ (Preamble)" ู "ุฎุงุชูุฉ (Postamble)" ุชูุฌูุงู ุงููููุฐุฌ ุงููุบูู (ูุซูู) ุญูู ููููุฉ ุชูุณูุฑ ุงูุจูุงูุงุช ูุงูุจุฑูุชูููู ุจุดูู ุนุงูุ ุจุงูุฅุถุงูุฉ ุฅูู ุงูุขููุงุช ุงูุชู ููุถู ุงููุณุชุฎุฏู ุฃู ูุชูุงุนู ุจูุง ุงููููุฐุฌ ูุนู. ูุฑุฌู ุฃุฎุฐ ูุฐู ุงูุชูุฌููุงุช ุงููููููุฉ ุจุนูู ุงูุงุนุชุจุงุฑ ูุฃุณุงุณ ููููู ูุฏูุฑ ูุฐุง ุงูุจุฑูุชูููู ูู ุชูุฌูู ุชูุงุนูุงุช ุงูููุงุฐุฌ ุงููุบููุฉ ูุน ุงููุณุชุฎุฏู.
**ุงูุจูุงูุงุช ุงูุชู ุณุชููู ุจุชุญููููุง ูู ูู ูุง ูุฑุฏ ุจุนุฏ ูุฐุง ุงูููุฌู ูุญุชู ููุงูุฉ ูุต ุงูุจุฑูุชูููู ุงููุฑูู.**
**ุงููุทููุจ ููู:**
1.  **ุงููุฑุงุกุฉ ูุงูููู ุงูููุฏู ูุงูุชุญูููู (Critical and Analytical Comprehension):**
    *   ูู ุจูุฑุงุกุฉ ูููู ุงูุจุฑูุชูููู ุงููุฑูู ุจุงููุงูู ุจุนูุงูุฉ ูุงุฆูุฉ ูุชุฃูู. ูุฐุง ูุดูู ุฌููุน ุงูุฃูุณุงู ุงูู 25 ุงูุชู ููุฏู ูููุง ุงููุณุชุฎุฏู ุจูุงูุงุช ููุธูุฉ ุนู ููุณูุ ุจุงูุฅุถุงูุฉ ุฅูู ูุณู "ุงูููุงุญุธุงุช ุงูุฅุถุงููุฉ" (ุงูุฐู ูุฏ ูุชุถูู ุชุญูููุงู ุฐุงุชููุง ูู ุงููุณุชุฎุฏู ููุณู ู/ุฃู ุฅุฌุงุจุงุช ุงููุณุชุฎุฏู ุนูู ุฃุณุฆูุฉ "ุฅููู" ุงูุฅุจุฏุงุนูุฉ).
    *   **ูููุชู ููุณุช ููุท ุงุณุชุฎูุงุต ุงููุนูููุงุชุ ุจู ุงูุจุญุซ ุนู ุงูุฑูุงุจุทุ ุงูุฃููุงุทุ ุงูุชูุงูุถุงุช ุงููุญุชููุฉุ ูุงูุชุฌููุงุช ุงููุชุนุฏุฏุฉ ูููุจุงุฏุฆ ุฃู ุงูููู ุงูุฃุณุงุณูุฉ ูููุณุชุฎุฏู ุนุจุฑ ูุฎุชูู ุฃุฌุฒุงุก ุงูุจุฑูุชูููู.**
2.  **ุชูุฏูู "ููุฎุต ุชุญูููู ุดุงูู ูุดุฎุตูุฉ ุงููุณุชุฎุฏูุ ุฃููุงุทู ุงูููุฑูุฉุ ููููู ุงูุฃุณุงุณูุฉ":**
    *   **ุงููุฏู:** ุฅูุดุงุก ุชุญููู ุงุณุชูุชุงุฌู ุนูููุ ุบูู ุจุงูุฑุคูุ ููุถูุนูุ ููุจูู ุนูู ุงูุฃุฏูุฉ ุงููููุฉ ูู ุงููุต. ูุฌุจ ุฃู ูุชุฌุงูุฒ ุงูููุฎุต ูุฌุฑุฏ ุฅุนุงุฏุฉ ุตูุงุบุฉ ุงูุจูุงูุงุช.
    *   **ุงูุทูู ุงูููุชุฑุญ:** ุญูุงูู 700 ุฅูู 1000 ูููุฉุ ูุถูุงู ุนูู ุงูุชุญููู.
    *   **ุงููููู ุงูููุชุฑุญ ููููุฎุต ุงูุชุญูููู (ูุน ุงูุชุฑููุฒ ุนูู ุงูุชุญููู ูููุณ ููุท ุงูุณุฑุฏ):**
        *   ุฃ. ุงูููุฏูุฉ ุงูุชุญููููุฉ (ููุฌุฒุฉ ุฌุฏุงู)
        *   ุจ. ุงููููุฉ ุงููุชูุงููุฉ: ุฑุจุท ุงูุดุฎุตูุฉุ ุงูุงุฌุชูุงุนูุฉุ ุงูุชุนููููุฉุ ูุงูููููุฉ
        *   ุฌ. ุงูููุงุฉ ุงูููุฑูุฉ ูุงููููุฌูุฉ (ุชุญููู ูุนูู)
        *   ุฏ. ููุธููุฉ ุงูููู ูุงููุจุงุฏุฆ ุงูุฃุฎูุงููุฉ (ุชุญููู ุชุทุจููู)
        *   ูู. ุงูููุธูุฑ ุชุฌุงู ุงูููุงููู ุงูุฌููุฑูุฉ (ุชุญููู ููุงุฑู)
        *   ู. ุงูุฃุฏูุงุช ุงููุนุฑููุฉุ ุงูููุงุฐุฌ ุงูููููุฉุ ูุงููุญุงุฐูุฑ ุงูููุฑูุฉ (ุชุญููู ูุธููู)
        *   ุฒ. ุงููุดุงุฑูุน ูุงูุฃูุฏุงู ุงูุญุงููุฉ (ุชุญููู ุงูุฏูุงูุน ูุงูุชูุฌูุงุช)
        *   ุญ. ุฃุณููุจ ุงูุชูุงุนู ูุชูุถููุงุช ุงููููุฐุฌ (ุชุญููู ูุชุทูุจุงุช ุงูุดุฑุงูุฉ)
        *   ุท. ุชุญููู ูุนูู ููุฃููุงุท ุงูุณููููุฉ ูุงูููุฑูุฉ ูู ุฅุฌุงุจุงุช "ุฃุณุฆูุฉ ุฅููู ุงูุฅุจุฏุงุนูุฉ" (ุฌุฒุก ุญููู - ุงุจุญุซ ุนู ููุท "Eve ๐ง (Q: ... Your Answer: ...") ูู "ุงูููุงุญุธุงุช ุงูุฅุถุงููุฉ". ุงุฏุนู ูู ููุท ุจู 2-3 ุฃูุซูุฉ ููุชุจุณุฉ.)
        *   ู. ูุญุงููุฉ ุชุญููู ุงูุดุฎุตูุฉ ููููุง ููููุฐุฌ ุงูุนูุงูู ุงูุฎูุณุฉ ุงููุจุฑู (Big Five Personality Traits) - ุฅุฐุง ูุงูุช ุงูุจูุงูุงุช ุชุฏุนู ุฐูู (ุงุฏุนู ุจููุฉ ุจุงูุฃุฏูุฉ).
        *   ู. ููุงุท ุงูููุฉ ุงููุญูุฑูุฉ (ุชุญููู ุงุณุชูุชุงุฌู)
        *   ู. ูุฌุงูุงุช ูุญุชููุฉ ููููู ุฃู ุงูุชุฃูู ุงูุฐุงุชู (ุจุญุฐุฑ ุดุฏูุฏุ ูุจูุงุกู ุนูู ุฅุดุงุฑุงุช ุงููุณุชุฎุฏู ููุท).
        *   ู. ุฎูุงุตุฉ ุชุญููููุฉ ุดุงููุฉ ูููุฌุฒุฉ.
3.  **ุงูุฃุณููุจ ุงููุทููุจ ูู ุงูููุฎุต ุงูุชุญูููู:**
    *   ุงูุชุญููู ุงูููุฏู ูุงูุงุณุชูุชุงุฌู. ุงูููุถูุนูุฉ ูุงูุฏุนู ุจุงูุฃุฏูุฉ. ุงูุงุญุชุฑุงู ูุงูุชูุฏูุฑ. ุงููุถูุญ ูุงููุบุฉ ุงูุงุญุชุฑุงููุฉ. ุงูุชูุงูู ูุงูุฑุจุท. ุชุฌูุจ ุงูุงูุชุฑุงุถุงุช ุบูุฑ ุงููุจุฑุฑุฉ.
**ุงูุจูุงูุงุช ุงููุฑููุฉ ูุชุญููููุง ูู ุงูุชุงููุฉ:**
"""
        full_request_content = analysis_prompt_template_v2.strip() + "\n\n" + full_protocol_text
        api_thread = threading.Thread(target=self._send_request_to_groq_api_threaded, args=(full_request_content,), daemon=True); api_thread.start()

    def _send_request_to_groq_api_threaded(self, request_content: str):
        try:
            client = Groq(api_key=self.groq_api_key_cache)
            chat_completion = client.chat.completions.create(
                messages=[ {"role": "system", "content": "ุฃูุช ูุญูู ุจูุงูุงุช ูุชุฎุตุต. ุงุชุจุน ุงูุชุนูููุงุช ุจุฏูุฉ."}, {"role": "user", "content": request_content} ],
                model=self.groq_model_name_cache, temperature=0.3, max_tokens=3000 # Increased max_tokens for detailed analysis
            )
            result = chat_completion.choices[0].message.content
            self.api_result_queue.put({"status": "success", "data": result})
        except RateLimitError as e: print(f"Groq API Rate Limit Error: {e}"); self.api_result_queue.put({"status": "error", "data": f"ุฎุทุฃ ูู ุญุฏูุฏ ุงุณุชุฎุฏุงู Groq API: {e.status_code}\n{e.message}"})
        except APIError as e: print(f"Groq API Error: {e}"); self.api_result_queue.put({"status": "error", "data": f"ุฎุทุฃ ูู Groq API: {e.status_code}\n{e.message}"})
        except Exception as e: print(f"Unexpected error during Groq API call: {e}"); self.api_result_queue.put({"status": "error", "data": f"ุฎุทุฃ ุบูุฑ ูุชููุน: {type(e).__name__} - {e}"})

    def _check_api_queue(self):
        try:
            result = self.api_result_queue.get_nowait()
            self.eve_state["is_waiting_for_api_response"] = False
            if result["status"] == "success":
                self.eve_state["api_analysis_result"] = result["data"]
                self._eve_speak("ููุฏ ุนุงุฏ ุงูุชุญููู ูู ุงููููุฐุฌ ุงููุบูู ุงูุฎุงุฑุฌู (Groq). ุฅููู ุงูููุฎุต:", is_system=True)
                self.eve_current_question_label.config(text="ูุชูุฌุฉ ุงูุชุญููู ูู Groq:")
                self._eve_manage_input_visibility(show_send=False, show_skip=False, show_analysis_display=True, show_analysis_confirm_buttons=True)
                self.eve_state["current_mode"] = "AWAITING_API_ANALYSIS_SAVE_CHOICE"
            else:
                error_message = result["data"]; self._eve_speak(f"ุนุฐุฑูุงุ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุชุญููู ุงูุฎุงุฑุฌู: {error_message}", is_system=True)
                self.eve_current_question_label.config(text="ูุดู ุงูุชุญููู ุงูุฎุงุฑุฌู."); self._eve_manage_input_visibility(show_send=False, show_skip=False); self.eve_state["current_mode"] = "SESSION_COMPLETE"
        except queue.Empty: pass
        finally:
            if self.master.winfo_exists(): self.master.after(200, self._check_api_queue)

    def _save_external_analysis_to_protocol(self, analysis_text: str):
        if not self.loaded_ucp_data: return
        notes_id="additional_notes"; notes_sec_data = next((s for s in self.loaded_ucp_data.get("sections", []) if s.get("id") == notes_id), None)
        if not notes_sec_data: notes_sec_data = {"id": notes_id, "title": SECTION_TYPE_DATA[notes_id]["title"], "items": [{}]}; self.loaded_ucp_data.setdefault("sections", []).append(notes_sec_data)
        elif not notes_sec_data.get("items") or not isinstance(notes_sec_data.get("items"),list) or not notes_sec_data.get("items"): notes_sec_data["items"] = [{}]
        elif not isinstance(notes_sec_data.get("items")[0], dict): notes_sec_data["items"][0] = {}
        if not notes_sec_data.get("items"): notes_sec_data["items"] = [{}] # Final safety for item[0]
        if not isinstance(notes_sec_data.get("items")[0],dict): notes_sec_data["items"][0] = {} # If it was bad
        notes_sec_data["items"][0]["externalAnalysisSummary"] = analysis_text.strip()
        if "additionalGeneralNotes" not in notes_sec_data["items"][0]: notes_sec_data["items"][0]["additionalGeneralNotes"] = "" # Ensure field for IQs exists
        self._set_data_changed(True)

    def skip_eve_question(self):
        context = self.eve_state["current_question_context"]; self._eve_speak("(ุชุฎุทูุช ุงูุณุคุงู.)", is_user=True)
        if context and context["type"] == "direct": self.eve_state["current_field_index"] += 1
        if self.eve_state["is_asking_to_add_another"]: self.eve_state["is_asking_to_add_another"]=False; self.move_to_next_eve_direct_section_or_invented(); return
        self.ask_next_eve_question()

    def prompt_edit_specific_section(self):
        if not self.loaded_ucp_data: messagebox.showinfo("ูุง ููุฌุฏ ุจุฑูุชูููู", "ูู ุจุชุญููู ุฃู ุจุฏุก ุจุฑูุชูููู ุฃููุงู."); return
        dialog = tk.Toplevel(self.master); dialog.title("โ๏ธ ุชุนุฏูู ูุณู ูุญุฏุฏ"); dialog.transient(self.master); dialog.grab_set(); dialog.resizable(False,False)
        df = ttk.Frame(dialog, padding=20, style="EvePanel.TFrame"); df.pack(fill=tk.BOTH,expand=True)
        ttk.Label(df,text="ุงุฎุชุฑ ุงููุณู ุงูุฐู ุชูุฏ ุชุนุฏููู:", font=("Segoe UI",11)).pack(pady=(0,10))
        titles = [SECTION_TYPE_DATA[k]["title"] for k in self.eve_state["section_keys_order"] if k in SECTION_TYPE_DATA] # defensive check
        if not hasattr(self,'edit_section_var'): self.edit_section_var=tk.StringVar()
        cb = ttk.Combobox(df,textvariable=self.edit_section_var,values=titles,state="readonly",width=45,font=("Segoe UI",10))
        if titles: curr_key = self.get_current_eve_section_key(); self.edit_section_var.set(SECTION_TYPE_DATA[curr_key]["title"] if curr_key and curr_key in SECTION_TYPE_DATA and SECTION_TYPE_DATA[curr_key]["title"] in titles else titles[0])
        cb.pack(pady=5); bf = ttk.Frame(df, style="EvePanel.TFrame"); bf.pack(pady=15)
        def on_edit():
            sel_title = self.edit_section_var.get(); key = next((k for k,v in SECTION_TYPE_DATA.items() if v["title"]==sel_title),None)
            if key: dialog.destroy(); self._jump_to_eve_section(key)
            else: messagebox.showerror("ุฎุทุฃ","ูู ูุชู ุงูุนุซูุฑ ุนูู ููุชุงุญ ุงููุณู.",parent=dialog)
        edit_btn = ttk.Button(bf,text="ุชุนุฏูู",command=on_edit,style="Eve.TButton"); edit_btn.pack(side=tk.LEFT,padx=10); Tooltip(edit_btn,"ุชุนุฏูู ุงููุณู ุงููุฎุชุงุฑ.")
        ttk.Button(bf,text="ุฅูุบุงุก",command=dialog.destroy).pack(side=tk.LEFT,padx=10); self.center_window(dialog,450,200)

    def _jump_to_eve_section(self, section_key: str):
        if section_key not in self.eve_state["section_keys_order"]: self._eve_speak(f"ูุง ูููู ุงูุนุซูุฑ ุนูู ุงููุณู: {section_key}",is_system=True); self.start_eve_interaction(); return
        target_idx = self.eve_state["section_keys_order"].index(section_key)
        if not self.loaded_ucp_data: self.loaded_ucp_data={"protocolVersion":f"{APP_VERSION} (New)","generationDate":datetime.datetime.now(UTC).isoformat(),"sections":[]}; self._set_data_changed(True); self.eve_preferred_name_cache="ุตุฏููู"
        self.eve_state.update({"current_mode":"PROCESSING_PROTOCOL", "current_section_key_index":target_idx, "current_field_index":0, "current_item_count_for_section":0, "is_asking_to_add_another":False, "initial_data_loaded_for_eve":True, "is_editing_specific_section_now":True, "is_asking_mental_state": False, "last_summary_point_triggered": "summary_3", "is_waiting_for_api_response": False}) # Set last_summary_point_triggered to prevent immediate re-trigger for that section
        self._eve_manage_input_visibility(show_send=False,show_skip=False); [w.destroy() for w in self.eve_mcq_options_frame.winfo_children()]
        self._clear_eve_conversation(); self._update_current_mental_state_cache_from_data()
        adaptive_greeting_list = EVE_MENTAL_STATE_PHRASES.get(self.current_mental_state_cache,EVE_MENTAL_STATE_PHRASES["not_specified"])["greetings"]
        adaptive_greeting = random.choice(adaptive_greeting_list).format(name=self.eve_preferred_name_cache)
        self._eve_speak(f"{adaptive_greeting} ููุฑุงุฌุน/ูุนุฏู ูุณู '{SECTION_TYPE_DATA[section_key]['title']}'."); self.ask_next_eve_question()

    def _on_closing(self):
        if self.eve_state.get("is_waiting_for_api_response"):
            if not messagebox.askyesno("ุชุญุฐูุฑ", "ููุฌุฏ ุชุญููู ููุฏ ุงููุนุงูุฌุฉ. ูู ุฃูุช ูุชุฃูุฏ ูู ุงูุฅุบูุงูุ", icon=messagebox.WARNING, parent=self.master): return
        if self.data_changed_since_last_save:
            res = messagebox.askyesnocancel("ุฅุบูุงู","ุชุบููุฑุงุช ุบูุฑ ูุญููุธุฉ. ูู ุชุฑูุฏ ุงูุญูุธ ูุจู ุงูุฅุบูุงูุ",parent=self.master,icon=messagebox.WARNING)
            if res is True: self.save_ucp_file_as_json(); [self.master.destroy() for _ in [] if not self.data_changed_since_last_save]
            elif res is False: self.master.destroy()
        else: self.master.destroy()

    def show_help_dialog(self):
        help_text = f"**ูุฏูุฑ ุจุฑูุชูููู UCP-LLM - ุฏููู ุงููุณุชุฎุฏู ({APP_VERSION})**\n\nุฅููู ๐ง ุฏูููู.\n\n**ุงูุชูุงุนู:**\n1. ุงุจุฏุฃ/ุญููู ุจุฑูุชูููู.\n2. ุญุฏุฏ ุญุงูุชู ุงูุฐูููุฉ.\n3. ุฃุฌุจ ุนู ุงูุฃุณุฆูุฉ. ุงุณุชุฎุฏู ุงูููุงูุจ.\n4. ุชูุฏู ุฅููู ููุฎุตุงุช ุฏูุฑูุฉ. ุฃูุฏูุง ุฃู ุนุฏูู ุงูุฃูุณุงู.\n5. **ุงูุชุญููู ุงูุชููุงุฆู:** ูู ููุงูุฉ ุฌูุน ุงูุจูุงูุงุชุ ููููู ุงูุทูุจ ูู ุฅููู ุฅุฑุณุงู ุจุฑูุชููููู ุฅูู Groq API ููุชุญููู.\n   (ููุงุญุธุฉ: ูุชุทูุจ ููุชุงุญ Groq API ุตุงูุญ).\n6. ุงุญูุธ/ุตุฏุฑ ุงูุจุฑูุชูููู.\n\nุงุณุชูุชุน!"
        self._show_info_dialog("ุฏููู ุงููุณุชุฎุฏู ๐ง",help_text,width=700,height=500)

    def show_about_dialog(self):
        about_text = f"**{APP_VERSION}**\nยฉ 2024 ุณุงูุญ ูุณ. ุฌููุน ุงูุญููู ูุญููุธุฉ.\n\n**ุงูุฌุฏูุฏ ({APP_VERSION.split('(')[0].split('v')[-1].strip()}):**\n* ุชูุงูู ูุน Groq API ููุชุญููู ุงูุชููุงุฆู.\n* ุฅุฏุฑุงุฌ ูุตูุต Preamble/Postamble.\n* ุชููู ุฅููู ูุน ุงูุญุงูุฉ ุงูุฐูููุฉ.\n* ููุฎุตุงุช ุฏูุฑูุฉุ ุชุนุฏูู ุฃูุณุงู.\n\nุดูุฑูุง!"
        self._show_info_dialog(f"ุนู {APP_VERSION}",about_text,width=600,height=450)

    def _show_info_dialog(self, title, text_content, width=500, height=400):
        dialog = tk.Toplevel(self.master); dialog.title(title); dialog.transient(self.master); dialog.grab_set(); dialog.resizable(True,True); mf = ttk.Frame(dialog,padding=15,style="EvePanel.TFrame"); mf.pack(fill=tk.BOTH,expand=True); ta = scrolledtext.ScrolledText(mf,wrap=tk.WORD,font=("Segoe UI",10),relief="solid",borderwidth=1,bg="white",padx=10,pady=10); ta.pack(fill=tk.BOTH,expand=True,pady=(0,10)); ta.insert(tk.END,text_content); ta.tag_configure("bold_display",font=("Segoe UI",10,"bold")); s_idx="1.0"
        while True:
            ms = ta.search(r"\*\*",s_idx,tk.END,regexp=True);
            if not ms: break
            cs_idx=f"{ms}+2c"; me=ta.search(r"\*\*",cs_idx,tk.END,regexp=True)
            if not me: break
            ta.tag_add("bold_display",cs_idx,me); s_idx=f"{me}+2c"
        ta.config(state=tk.DISABLED); ttk.Button(mf,text="ุฅุบูุงู",command=dialog.destroy,style="Eve.TButton").pack(pady=(5,0)); self.center_window(dialog,width,height)

class Tooltip:
    def __init__(self,widget,text):self.w=widget;self.t=text;self.tw=None;widget.bind("<Enter>",self.s);widget.bind("<Leave>",self.h)
    def s(self,e=None): # Corrected version
        if not self.t or self.tw: return
        self.tw=tk.Toplevel(self.w); self.tw.wm_overrideredirect(True); self.tw.wm_geometry("+5000+5000")
        lbl=tk.Label(self.tw,text=self.t,justify='left',bg="#ffffe0",relief='solid',bd=1,font=("Segoe UI",9),wraplength=300); lbl.pack(ipadx=2,ipady=2)
        self.w.update_idletasks(); self.tw.update_idletasks()
        tipw=self.tw.winfo_width(); tiph=self.tw.winfo_height(); fx, fy = 0, 0 # Initialize
        try: wx=self.w.winfo_rootx(); wy=self.w.winfo_rooty(); wh=self.w.winfo_height(); ww=self.w.winfo_width(); fx=wx + (ww//2) - (tipw//2); fy=wy+wh+3
        except tk.TclError: fx=self.w.winfo_pointerx()+15; fy=self.w.winfo_pointery()+10
        scrw=self.w.winfo_screenwidth(); scrh=self.w.winfo_screenheight()
        if fx+tipw > scrw: fx=scrw-tipw-5
        if fx < 0: fx=5
        if fy+tiph > scrh: fy = (self.w.winfo_rooty() if 'wy' in locals() else self.w.winfo_pointery()) - tiph - 5
        if fy < 0: fy=5
        self.tw.wm_geometry(f"+{int(fx)}+{int(fy)}"); self.tw.deiconify()
    def h(self,e=None):
        if self.tw: self.tw.destroy(); self.tw=None

def main():
    root = tk.Tk()
    app = UCPManagerApp(root)
    root.mainloop()

if __name__ == "__main__":
    main()
